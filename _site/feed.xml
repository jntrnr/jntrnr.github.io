<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
	<channel>
		<title>Jonathan Turner</title>
		<link>http://localhost:4000</link>
		<atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
		
			<item>
				<title>Creating crossplatform Rust terminal apps</title>
        <description>&lt;p&gt;&lt;img src=&quot;/images/pikachu.jpg&quot; alt=&quot;Pikachu animation in Windows&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Look Mom, Pikachu running in Windows CMD!&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;I’ve been wanting to play around with the cool &lt;a href=&quot;https://www.reddit.com/r/rust/comments/bf5uzr/update_on_my_3d_ascii_art_generator_termiontobj/&quot;&gt;spinning Pikachu demo&lt;/a&gt; everyone was talking about. Sadly, it used termion to do its magic, which meant that unfortunately it wouldn’t work for me.&lt;/p&gt;

&lt;p&gt;Termion has been a boon for Rust, with lots of folks using it to create terminal applications. Unfortunately, as a Windows user, I know there’s a good chance that if the crate depends on termion that’s the end of the line for me, as termion apps just don’t work in Windows. Surely, I thought, there must be a better way, but I never managed to find one.&lt;/p&gt;

&lt;h1 id=&quot;enter-crossterm&quot;&gt;Enter crossterm&lt;/h1&gt;

&lt;p&gt;Yesterday, I discovered a crate I have wanted for at least a year: that holy grail of something like termion that also worked crossplatform. The crate is called &lt;a href=&quot;https://github.com/TimonPost/crossterm&quot;&gt;crossterm&lt;/a&gt;, and it is exactly that. Rather than being an exact copy of termion, I’d call Crossterm a termion-like crate. The API surface feels very similar between the two crates, but it’s not identical.  That said, often, the translation is 1:1 (or close to it).&lt;/p&gt;

&lt;p&gt;In this post, I’ll detail what I had to do to port to crossterm. You can take a look at my &lt;a href=&quot;https://github.com/jonathandturner/rust-sloth/tree/crossterm-port&quot;&gt;repo&lt;/a&gt; and give it a spin.&lt;/p&gt;

&lt;h2 id=&quot;moving-to-crossterm&quot;&gt;Moving to crossterm&lt;/h2&gt;

&lt;p&gt;Like termion, crossterm is a single crate to depend on that pulls in what you need for interacting with the terminal:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-termion = &quot;1&quot;
+crossterm = &quot;0.9.3&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Next, is setting up the terminal:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-    let mut stdout = AlternateScreen::from(stdout().into_raw_mode().unwrap()); // Raw output is clean output
-    let mut stdin = async_stdin().bytes(); // Async in so input isn't blocking
+
+    let crossterm = Crossterm::new();
+    #[allow(unused)]
+    let screen = RawScreen::into_raw_mode();
+    let input = crossterm.input();
+    let mut stdin = input.read_async();
+    let cursor = cursor();
+
+    cursor.hide()?;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are a few more steps here, and I took a slightly different approach than termion. In the original, the author uses an AlternateScreen, a way to easily switch back to the previous terminal with the application exits. The crossterm package supports this, though there were is an &lt;a href=&quot;https://github.com/TimonPost/crossterm/issues/128&quot;&gt;issue&lt;/a&gt; that’s being worked on. Using an AlternateScreen is optional, so I just left it off.&lt;/p&gt;

&lt;p&gt;The next step was to set up raw mode. Raw mode lets us get user input directly without the normal terminal buffering. The order of operations in crossterm above is important.&lt;/p&gt;

&lt;p&gt;Lastly, I hide the cursor so it doesn’t mess up the animation.&lt;/p&gt;

&lt;p&gt;The event loop is similar, though a little more verbose in my version:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-        let b = stdin.next();
-        if let Some(Ok(b'q')) = b {
-            break;
+        if let Some(b) = stdin.next() {
+            match b {
+                InputEvent::Keyboard(event) =&amp;gt; match event {
+                    KeyEvent::Char('q') =&amp;gt; break,
+                    _ =&amp;gt; {}
+                },
+                _ =&amp;gt; {}
+            }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The event systems between termion and crossterm, while similar, are different enough that I preferred to do two-step match to make sure I understood it. Events for both key and mouse come in through the event stream, which is a nice benefit.&lt;/p&gt;

&lt;p&gt;Drawing colors to the screen is also very similar between termion and crossterm:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-    format!(&quot;{}{}{}{}&quot;, color::Fg(color::Rgb(bg.0, bg.1, bg.2)),
-                        color::Bg(color::Rgb(25,25,25)),
-                      src,
-                      color::Fg(color::Reset))
+                    print!(
+                        &quot;{}{}{}&quot;,
+                        Colored::Fg(Color::Rgb {
+                            r: (pixel.1).0,
+                            g: (pixel.1).1,
+                            b: (pixel.1).2
+                        }),^M
+                        Colored::Bg(Color::Rgb {
+                            r: 25,
+                            g: 25,
+                            b: 25
+                        }),
+                        pixel.0
+                    )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The change from &lt;code class=&quot;highlighter-rouge&quot;&gt;color::Fg&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;Colored::Fg&lt;/code&gt; is straightforward enough I did most of these changes with search/replace.&lt;/p&gt;

&lt;h1 id=&quot;gotchas&quot;&gt;Gotchas&lt;/h1&gt;

&lt;p&gt;The translation is not without its own set of hiccups. The main one of which you get a hint at here:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-    pub frame_buffer: Vec&amp;lt;String&amp;gt;,
+    pub frame_buffer: Vec&amp;lt;(char, (u8, u8, u8))&amp;gt;,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Originally, the whole framebuffer was turned into a vector of strings. On most Unix platforms, these would include the ANSI commands to change the color or move the cursor. It’s a powerful tool, and being text-based, you can prebuffer the whole frame via string manipulation.&lt;/p&gt;

&lt;p&gt;Unfortunately, assuming everything is string-based doesn’t work in Windows. When crossterm outputs using println!, it’s calling into the Windows Console API between each piece of the println. This allows the same code to work, assuming it doesn’t buffer the string.&lt;/p&gt;

&lt;p&gt;To work around this, I stopped buffering the string and instead stored the pixel value in the buffer. When it was time, I drew the whole frame using print! statements.&lt;/p&gt;

&lt;p&gt;When I first did this, it was noticeably slower than the termion version(roughly 5-10 fps). This is because calling into the Console API that often (once per character) is going to pull down performance.  Luckily, I could work around this by just checking if we were already using the color I wanted to render. If we were, I didn’t set the color again.&lt;/p&gt;

&lt;p&gt;Performance between the termion version and the crossterm version now look the same to me, which I call good enough :)&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;We have a way to move more of our terminal apps to being crossplatform, so that they work out-of-the-box on Windows as well as Unix-based systems. It was fun to write the port, and I did the port in a couple hours without ever having used crossterm before.&lt;/p&gt;

&lt;p&gt;Also, big thanks to &lt;a href=&quot;https://github.com/ecumene-software&quot;&gt;Mitchell Hynes&lt;/a&gt; for writing the original!&lt;/p&gt;
</description>
				<pubDate>Sat, 27 Apr 2019 00:00:00 +1200</pubDate>
				<link>http://localhost:4000/2019/04/porting-the-pikachu.html</link>
				<guid isPermaLink="true">http://localhost:4000/2019/04/porting-the-pikachu.html</guid>
			</item>
		
			<item>
				<title>The Fallow Year, my Rust2019 post</title>
        <description>&lt;p&gt;&lt;strong&gt;Definition:&lt;/strong&gt; &lt;em&gt;fallow: (of agricultural land) Ploughed but left unseeded for more than one planting season.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Rust is an amazing project. It’s unlike anything I’ve ever seen. Not only are we seeing an ever-growing number of big name users of Rust, we also continue to see leaps in productivity and functionality. Yesterday, &lt;a href=&quot;https://blog.rust-lang.org/2018/12/06/Rust-1.31-and-rust-2018.html&quot;&gt;the Rust 2018 edition shipped&lt;/a&gt;. The culmination of three years of work, it shows off what the community is capable of: new features, backwards compatibility, new ergonomics without sacrificing performance, and the list goes on and on.&lt;/p&gt;

&lt;p&gt;Which is why it might comes as a little bit of a surprise that I suggest we let the field rest for the year. More specifically, that we should let one field rest while we plant another.&lt;/p&gt;

&lt;p&gt;Rather than focusing on new designs, I suggest we turn our attention outside of RFCs to other areas of Rust.&lt;/p&gt;

&lt;h1 id=&quot;examples&quot;&gt;Examples&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;The compiler&lt;/strong&gt;: The compiler team has been understaffed while also being heavily taxed by the effort of keeping up with new designs. I think they’ve done a stellar job with the resources they have, but they need help – and lots of it. RFCs have gone unimplemented simply because not enough people are contributing. Compile times need work. The compiler team is generally too busy to implement core functionality that it hoped to get done this year, like compiler-drive IDE completions.&lt;/p&gt;

&lt;p&gt;Let’s clear through the backlog of the growing list of accepted RFCs. Let’s take the time to do the deep refactoring that we haven’t had time to do because we were stretched too thin. Let’s give ourselves space to experiment with new ways of doing things. Let’s get the compiler ready to serve both build and IDE scenarios.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;RLS and related tools&lt;/strong&gt;: We’ve had big success with projects like rustfmt, and it would be great to mirror that success in the Rust Language Server, or RLS, which powers Rust’s IDE support. Unfortunately, the current RLS has to rely on many hacks to work with what is available from the compiler. By freeing up the compiler team, we also give space to the dev tools team to collaborate and finish the RLS, removing the need for hacks that cause incomplete functionality and unpredictabilty.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The community&lt;/strong&gt;: That’s right, the community needs a pause too. Everyone loves new features, but we need a bit of time to let all the new ones sink in before we start designing more. What design patterns will arise in practice? What are the best ways to work with async code at scale? On and on. Getting all this experience will let us see more clearly where to design next.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Documentation, videos, and other materials:&lt;/strong&gt; Along with the growing knowledge the community is getting by more using the current Rust more deeply, we can also translate this knowledge into more documentation. The need is strong for mid-level Rust developer documentation. What are the Rust design patterns? How does one get the most benefit from Rust quickly? How does one translate C++ knowedge to Rust? And so on.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Libraries:&lt;/strong&gt; We can use the knowledge we have to create new and better libraries. Existing libraries could continue to mature and adopt Rust 2018 idioms. Areas like GUI development need some clear direction and focus.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Outreach:&lt;/strong&gt; We’ve worked on some outreach to companies who might be interested in Rust, but there’s more we can do here. New whitepapers, new documentation about how to use Rust in specific sub-fields, like finance, data mining, machine learning, etc.&lt;/p&gt;

&lt;h1 id=&quot;the-list&quot;&gt;The list&lt;/h1&gt;

&lt;p&gt;As it turns out, these aren’t my ideas. They’re yours.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.rust-lang.org/2018/11/27/Rust-survey-2018.html&quot;&gt;This year’s Rust survey&lt;/a&gt; results highlighted these areas of improvement (sorted by number of comments):&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;the need for better library support&lt;/li&gt;
  &lt;li&gt;a more improved IDE experience&lt;/li&gt;
  &lt;li&gt;the need for broader adoption of Rust generally&lt;/li&gt;
  &lt;li&gt;a richer ecosystem of tools and support&lt;/li&gt;
  &lt;li&gt;an improved learning curve&lt;/li&gt;
  &lt;li&gt;the need for important language features and crates to be stable and supported&lt;/li&gt;
  &lt;li&gt;support for async programming&lt;/li&gt;
  &lt;li&gt;support for GUI development&lt;/li&gt;
  &lt;li&gt;better documentation&lt;/li&gt;
  &lt;li&gt;improved compile times&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You’ll notice that only one of these, “support for async programming”, implies adding new functionality to Rust itself. Rather than asking for new features, users wanted better documentation, tools, library support, IDE support, learning materials, and overall stability.&lt;/p&gt;

&lt;h1 id=&quot;the-idea&quot;&gt;The idea&lt;/h1&gt;

&lt;p&gt;Let’s finish what we started. As much as is possible and practical this year, let’s set aside new designs and ship what we’ve already designed. Let’s tackle challenges we haven’t had time to give our full attention.&lt;/p&gt;

&lt;p&gt;In short, let’s grow Rust where it needs it most.&lt;/p&gt;

</description>
				<pubDate>Sat, 08 Dec 2018 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2018/12/the-fallow-year.html</link>
				<guid isPermaLink="true">http://localhost:4000/2018/12/the-fallow-year.html</guid>
			</item>
		
			<item>
				<title>A Snapshot of Rust's Popularity in July 2018</title>
        <description>&lt;p&gt;Talking about a language’s popularity is traditionally a tricky topic. How do you measure popularity? How do you compare one language to another when they’re focused on different styles and different audiences?  So, rather than having one or two charts, I’m going to look at a number of “slices” into Rust’s growth to see it front different angles.&lt;/p&gt;

&lt;p&gt;There are also &lt;em&gt;many&lt;/em&gt; ways we could measure popularity. For example, looking at the growth of StackOverflow, internal forums, Twitter traffic, Google Trends, or the various language popularity reports.  Each of these measures has its own strengths and trade-offs.&lt;/p&gt;

&lt;p&gt;For our purposes in this post, we’re going to focus on a set of data points that should help show growth of &lt;em&gt;usage&lt;/em&gt; rather than growth of &lt;em&gt;buzz&lt;/em&gt; (that is, the amount people talking are about Rust). If people are using a language to do real work, that’s the best indicator of a language’s success.&lt;/p&gt;

&lt;p&gt;The first of place we’ll look for Rust usage is in open source, and with that, let’s look at GitHub.&lt;/p&gt;

&lt;h1 id=&quot;growth-on-github&quot;&gt;Growth on GitHub&lt;/h1&gt;

&lt;p&gt;GitHub offers a few ways to measure how well a particular language is growing.  GitHub itself uses the number of pull requests in a given language, which it uses in the &lt;a href=&quot;https://octoverse.github.com&quot;&gt;GitHub Octoverse&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If we were to run this query for 2018 so far, the top fifteen languages (by number of PRs) would be:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;JavaScript: 1736476&lt;/li&gt;
  &lt;li&gt;Python: 804790&lt;/li&gt;
  &lt;li&gt;Java: 703649&lt;/li&gt;
  &lt;li&gt;Ruby: 560430&lt;/li&gt;
  &lt;li&gt;PHP: 359040&lt;/li&gt;
  &lt;li&gt;C++: 319324&lt;/li&gt;
  &lt;li&gt;TypeScript: 311229&lt;/li&gt;
  &lt;li&gt;Go: 258131&lt;/li&gt;
  &lt;li&gt;C#: 246513&lt;/li&gt;
  &lt;li&gt;CSS: 236795&lt;/li&gt;
  &lt;li&gt;Shell: 168301&lt;/li&gt;
  &lt;li&gt;C: 160889&lt;/li&gt;
  &lt;li&gt;Swift: 67664&lt;/li&gt;
  &lt;li&gt;Scala: 67188&lt;/li&gt;
  &lt;li&gt;Rust: 52936&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Rust comes in at 15th place as part of the group of Swift/Scala/Rust.  This is pretty good company to be in. All of the languages on this list are known for doing heavy lifting in real applications, rather than being hobby or boutique languages.&lt;/p&gt;

&lt;p&gt;Being 15th is also significant because, if the Octoverse were held today, Rust would make their top languages list for the first time.&lt;/p&gt;

&lt;p&gt;Moving on, one gotcha of focusing on PRs is that it lets a relatively small number of highly successful projects skew the results. The popularity of the projects drives high numbers of PRs, and as a result the language looks far better.  To compensate for this, let’s also look at “active projects”. For our purposes, let’s define “active projects” as the number of projects that a) are larger than a “hello world”, b) have at least 1 star, and c) have been worked on in the last 30 days:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;JavaScript: 56437&lt;/li&gt;
  &lt;li&gt;Python: 37554&lt;/li&gt;
  &lt;li&gt;Java: 27912&lt;/li&gt;
  &lt;li&gt;C++: 16787&lt;/li&gt;
  &lt;li&gt;PHP: 16451&lt;/li&gt;
  &lt;li&gt;Shell: 12245&lt;/li&gt;
  &lt;li&gt;C#: 11503&lt;/li&gt;
  &lt;li&gt;C: 10662&lt;/li&gt;
  &lt;li&gt;Go: 8816&lt;/li&gt;
  &lt;li&gt;CSS: 8781&lt;/li&gt;
  &lt;li&gt;TypeScript: 8447&lt;/li&gt;
  &lt;li&gt;Ruby: 7518&lt;/li&gt;
  &lt;li&gt;Swift: 3828&lt;/li&gt;
  &lt;li&gt;Objective-C: 3054&lt;/li&gt;
  &lt;li&gt;Rust: 2604&lt;/li&gt;
  &lt;li&gt;Kotlin: 2343&lt;/li&gt;
  &lt;li&gt;Scala: 2072&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Another respectable showing for Rust. Again, we see it as part of the languages for doing serious work.&lt;/p&gt;

&lt;p&gt;The GitHub numbers tell one story, but do we see the same story if we look in other places? With this kind of popularity, we’d expect to see visible use of Rust in industry.&lt;/p&gt;

&lt;h1 id=&quot;rusts-commercial-users&quot;&gt;Rust’s Commercial Users&lt;/h1&gt;

&lt;p&gt;Rust has seen a surprising amount of growth in commercial usage over the past year alone. Here’s a partial list of names people may know:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Amazon&lt;/strong&gt; - Building &lt;a href=&quot;https://github.com/amzn/askalono&quot;&gt;tools in Rust&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Atlassian&lt;/strong&gt; (makers of Jira) - Using &lt;a href=&quot;https://github.com/rust-lang/rust-www/pull/922&quot;&gt;Rust in the backend&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Dropbox&lt;/strong&gt; - Using Rust in &lt;a href=&quot;https://air.mozilla.org/rust-meetup-may-2017/&quot;&gt;both the frontend and backend&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Facebook&lt;/strong&gt; - Tools for &lt;a href=&quot;https://twitter.com/Sunjay03/status/1019782490800603136&quot;&gt;source control&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Google&lt;/strong&gt; - As part of the &lt;a href=&quot;https://github.com/fuchsia-mirror?utf8=✓&amp;amp;q=&amp;amp;type=&amp;amp;language=rust&quot;&gt;Fuchsia project&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Microsoft&lt;/strong&gt; - Using Rust in part of their &lt;a href=&quot;https://twitter.com/maxgortman/status/1012011425353461760&quot;&gt;new Azure IoT work&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;npm&lt;/strong&gt; - Using Rust in some of the &lt;a href=&quot;https://github.com/rust-lang/rust-www/pull/634&quot;&gt;npm core services&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Red Hat&lt;/strong&gt; - Creating a &lt;a href=&quot;https://github.com/stratis-storage&quot;&gt;new storage system&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Reddit&lt;/strong&gt; - Using Rust in its &lt;a href=&quot;https://www.reddit.com/r/rust/comments/7utj4t/reddit_is_hiring_a_senior_rust_engineer/&quot;&gt;comment processing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Twitter&lt;/strong&gt; - As part of the &lt;a href=&quot;https://twitter.com/stuhood/status/978410393944047617?s=19&quot;&gt;build team support for Twitter&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You can see even more on the &lt;a href=&quot;https://www.rust-lang.org/en-US/friends.html&quot;&gt;Friends of Rust&lt;/a&gt; that include other familiar names like Baidu, Wire, Mozilla, Samsung, Cloudflare, Chef, Canonical, and more.&lt;/p&gt;

&lt;p&gt;Across the industry, software companies are beginning to adopt Rust at some level in their organization.  As expected, these may be tentative at first, focusing on Rust for build tools, for backend processing, or targeting a specific platform like IoT.  Early adopters like Dropbox and Canonical have now grown beyond initial investments to using Rust in an increasing amount of their codebase.&lt;/p&gt;

&lt;p&gt;All told, it’s still early days for Rust. Large companies take time to try new technology before they adopt it more broadly. We’re seeing Rust in that part of the adoption curve, and it’s doing well here.  Languages – like Go and TypeScript – that saw explosive growth in recent years also saw similar patterns at this part of their lifecycle.&lt;/p&gt;

&lt;p&gt;Because of Rust’s closeness with C++, we should also look at industries that are traditionally strongly populated by C++ developers. One such industry is game development.&lt;/p&gt;

&lt;h1 id=&quot;zooming-into-games&quot;&gt;Zooming into Games&lt;/h1&gt;

&lt;p&gt;Despite the game industry’s use of established development technologies, Rust is beginning to make in-roads with game developers.  Here’s a list of usage of Rust in some familiar names among game developers:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Chucklefish Games&lt;/strong&gt; - Using Rust in &lt;a href=&quot;https://www.rust-lang.org/pdfs/Rust-Chucklefish-Whitepaper.pdf&quot;&gt;multiple upcoming games&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Electronic Arts&lt;/strong&gt; - Using Rust in &lt;a href=&quot;https://twitter.com/ZigguratVertigo/status/1021562281056980993&quot;&gt;SEED&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Frostbite Engine&lt;/strong&gt; - Using Rust in &lt;a href=&quot;https://twitter.com/Ca1ne/status/983612241235804160&quot;&gt;backend processing&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Ready at Dawn Studios&lt;/strong&gt; - &lt;a href=&quot;https://twitter.com/AndreaPessino/status/1021532074153394176&quot;&gt;All new development&lt;/a&gt; will be in Rust.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Unity&lt;/strong&gt; - Using Rust in &lt;a href=&quot;https://twitter.com/bltroutwine/status/1002234680949719040&quot;&gt;data engineering&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We’re also seeing &lt;a href=&quot;https://twitter.com/SergiusIW/status/1021236971786694656&quot;&gt;other indie developers&lt;/a&gt; beginning to use it for their titles.&lt;/p&gt;

&lt;p&gt;Just as we saw in the “big name” usage, we see a similar pattern with game developers. Initial usage is targeted, perhaps at backend or data-focused projects. After this, there’s a path to developing core technology, and even whole games, in Rust.&lt;/p&gt;

&lt;h1 id=&quot;jobs&quot;&gt;Jobs&lt;/h1&gt;

&lt;p&gt;When we ran the &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;2017 Rust survey&lt;/a&gt;, one of the big themes that came up for people not using Rust was around their companies not using it. The jobs just weren’t there.&lt;/p&gt;

&lt;p&gt;In 2018, with a growing numbers of companies and studios using Rust, has this situation improved?&lt;/p&gt;

&lt;p&gt;In short, yes, though there’s still a lot of room to grow. A quick look at LinkedIn’s job list shows a number of Rust opportunities from the likes of Amazon as well as a number of companies involved in blockchain, security, science/healthcare, and more. Still, when compared to the volume of job offerings for languages like Go or TypeScript, there’s still a gap in terms of availability.&lt;/p&gt;

&lt;p&gt;Let’s move on from Rust’s use in companies to look at the growth of the community that supports Rust.&lt;/p&gt;

&lt;h1 id=&quot;community-and-governance&quot;&gt;Community and Governance&lt;/h1&gt;

&lt;p&gt;In times past, a language could survive on being used solely for commercial development. These days, however, a language’s community forms its foundation. It offers a way to ramp up new users, support new projects, and set the tone for the project going forward.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/rust_meetups.png&quot; alt=&quot;Map showing Rust being used in over 130 meetups around the world&quot; /&gt;
&lt;em&gt;Rust meetups now total over 130 around the world&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The in-person piece of the Rust community, the Rust meetups, have seen 30% growth in the last nine months and now total over 130 around the world.  We’ve likewise seen steady growth in the number of conferences that users can attend for more training and networking.&lt;/p&gt;

&lt;p&gt;We’ve also seen some impressive growth in indicators of the online community as well since the &lt;a href=&quot;http://www.jonathanturner.org/2017/10/fun-facts-about-rust-growth.html&quot;&gt;last time I reported on them&lt;/a&gt;. For example, the Rust reddit recently passed 40k users (up from the 29k of nine months ago), the GitHub repo is nearly at 30k stars (up from 24k), and the official Rust twitter has over 31k followers (up from 24k).&lt;/p&gt;

&lt;p&gt;This enthusiasm has also translated into the teams that govern Rust itself. Combined, the governing teams have doubled in size in the last 9 months to over &lt;a href=&quot;https://www.rust-lang.org/en-US/team.html&quot;&gt;100 positions across the various teams&lt;/a&gt;. The scope has also grown in tandem, with new teams that cover infrastructure, developer experiences, and dependency management.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;These are just some data points about Rust’s use in industry and in the software development community. It’s difficult to get a complete picture, and even more difficult to predict what will come next. That said, it does seem to shine a promising ray of light on where Rust is today.&lt;/p&gt;

&lt;p&gt;Where will Rust go tomorrow?  That is anyone’s guess. I, for one, will certainly be watching and cheering it along.&lt;/p&gt;
</description>
				<pubDate>Sat, 28 Jul 2018 00:00:00 +1200</pubDate>
				<link>http://localhost:4000/2018/07/snapshot-of-rust-popularity.html</link>
				<guid isPermaLink="true">http://localhost:4000/2018/07/snapshot-of-rust-popularity.html</guid>
			</item>
		
			<item>
				<title>Starting the next thing</title>
        <description>&lt;p&gt;It’s that time again! July 31st will be my last day at Mozilla.&lt;/p&gt;

&lt;p&gt;Even though I was only at Mozilla for just under two and a half years, I had the good fortune to work on some pretty awesome projects.&lt;/p&gt;

&lt;p&gt;I joined the Rust team and worked with Niko Matsakis and Aaron Turon on where Rust could grow, building on my experience coming from TypeScript. We learned a &lt;em&gt;ton&lt;/em&gt; from each other, and I’m really grateful for all those conversations and the close friendship that resulted. I also got to roll up my sleeves and write some code. The first project was to &lt;a href=&quot;https://blog.rust-lang.org/2016/08/10/Shape-of-errors-to-come.html&quot;&gt;redesign the Rust error messages&lt;/a&gt; with Niko. The next was to create the &lt;a href=&quot;https://internals.rust-lang.org/t/introducing-rust-language-server-source-release/4209&quot;&gt;Rust Language Server&lt;/a&gt; with Nick Cameron. Both have grown a life of their own, and it’s been awesome to see!&lt;/p&gt;

&lt;p&gt;I was also lucky to help Jack Moffitt out with the Servo project. Under his guidance, it produced loads of good code and good ideas. These made their way into &lt;a href=&quot;https://hacks.mozilla.org/2017/08/inside-a-super-fast-css-engine-quantum-css-aka-stylo/&quot;&gt;Firefox&lt;/a&gt; and into the &lt;a href=&quot;https://blog.mozilla.org/blog/2018/04/03/mozilla-brings-firefox-augmented-virtual-reality/&quot;&gt;Firefox Reality&lt;/a&gt; work. Learning from Jack and connecting with the Firefox org (and some of the awesome Firefox managers) was a treat.&lt;/p&gt;

&lt;p&gt;Finally, my last seven months have been helping create and run the Developer Technology team at Mozilla, a melding of the Rust and WebAssembly efforts under one umbrella. This allowed even closer collaboration between the two projects and has already resulted in &lt;a href=&quot;https://rustwasm.github.io/&quot;&gt;lots of cool new technology, tools, and coding practices&lt;/a&gt;. I’m excited to watch what they’ll be able to come up with next.&lt;/p&gt;

&lt;p&gt;And speaking of “next”, what’s next for me?  I’m moving on to create a new company.  I don’t have a ton of details to share, yet, but I hope to do so in the coming months as the ideas and technology start to come together.  “Will it use Rust?” I can already hear many of you asking.  Most assuredly.  If there’s a better solution for efficient, write-once-and-don’t-worry-about-it software development, I’ve yet to find it.&lt;/p&gt;

&lt;p&gt;Thank you, Mozilla!  Both for the experience and for the friends I’ve made along the way.&lt;/p&gt;

&lt;p&gt;PS: I plan to continue podcasting - it’s fun :)&lt;/p&gt;
</description>
				<pubDate>Tue, 24 Jul 2018 00:00:00 +1200</pubDate>
				<link>http://localhost:4000/2018/07/starting-the-next-thing.html</link>
				<guid isPermaLink="true">http://localhost:4000/2018/07/starting-the-next-thing.html</guid>
			</item>
		
			<item>
				<title>How fast can we compile Rust hello world?</title>
        <description>&lt;p&gt;Seeing &lt;a href=&quot;https://blog.mozilla.org/nnethercote/2018/04/30/how-to-speed-up-the-rust-compiler-in-2018/&quot;&gt;Nick Nethercote’s blog post about speeding up the compiler&lt;/a&gt;, I started wondering just how fast could a Rust compiler be?  How fast could we compile a simple example?  How fast can we compile a Rust hello world?&lt;/p&gt;

&lt;h2 id=&quot;starting-out&quot;&gt;Starting out&lt;/h2&gt;

&lt;p&gt;When you do a &lt;code class=&quot;highlighter-rouge&quot;&gt;cargo new hello_rust --bin&lt;/code&gt;, you get a simple Rust hello world:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hello, world!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Awesome.  Let’s see how long this takes to build:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; time cargo build
   Compiling hello_rust v0.1.0 (file:///home/jonathan/Source/hello_rust)
    Finished dev [unoptimized + debuginfo] target(s) in 0.52 secs

real     0m0.548s
user     0m0.468s
sys      0m0.080s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Half a second on my XPS 13 9360, with a i7-7500U @ 2.70GHz with 16 gigs of RAM.  That seems, a bit long for a hello world.  Maybe cargo is doing extra work?&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; time rustc src/main.rs

real     0m0.378s
user     0m0.289s
sys      0m0.083s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That’s definitely better.  We’re just over 1/3rd of a second.&lt;/p&gt;

&lt;p&gt;What should we expect?  If only there were another language we could compile a hello world for that’s comparable…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; cat hello_c.c
#include &amp;lt;stdio.h&amp;gt;

int main() {
    puts(&quot;Hello, from C!&quot;);
    return 0;
}
&amp;gt; time clang hello_c.c

real     0m0.082s
user     0m0.021s
sys      0m0.041s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Woooaah!  Wait a second.  You’re telling me that compiling C hello world is over 4.5x faster.  That’s… that’s something.  Maybe the compiler is doing a bit too much work for this small example?  I mean, we don’t need much from the standard library, just the println macro.&lt;/p&gt;

&lt;p&gt;You know, a reasonable person would probably stop here and walk away.  Chalk it up to “Rust is more complicated” or “maybe if I knew the right commandline options”&lt;/p&gt;

&lt;p&gt;No, that’s not us.  Not today.  Today, we’re going to write our own Rust translator.  We’re going to see just how fast we can compile Rust to a working hello world.&lt;/p&gt;

&lt;h2 id=&quot;first-stop-lets-build-a-rust-c-translator&quot;&gt;First stop: let’s build a Rust-&amp;gt;C translator.&lt;/h2&gt;

&lt;p&gt;Here’s my thinking: if we write our own translator, we can translate the Rust to C ourselves, and then compile the C.  That way, we should end up with a compile time close to the C.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; cargo new rabbithole --bin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Writing a full compiler is complex work, but we’re going for speed here.  And speed means cutting corners.  To that end, we’re implementing &lt;em&gt;just enough&lt;/em&gt; of a compiler to translate our Rust to C, then we’re calling that good enough.&lt;/p&gt;

&lt;p&gt;First step, we need a parser.  Luckily, there already is a crate that can parse Rust code for us.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[dependencies]
syn = {version = &quot;0.13&quot;, features = [&quot;full&quot;, &quot;extra-traits&quot;] }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unable to open file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unable to read file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syntax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;parse_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unable to parse file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{:#?}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syntax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Please supply the file to compile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; cargo run -- hello.rs
File {
    shebang: None,
    attrs: [],
    items: [
        Fn(
            ItemFn {
                attrs: [],
                vis: Inherited,
                constness: None,
                unsafety: None,
                abi: None,
                ident: Ident {
                    term: Term {
                        sym: main
                    }
                },
                decl: FnDecl {
                    fn_token: Fn,
                    generics: Generics {
                        lt_token: None,
                        params: [],
                        gt_token: None,
                        where_clause: None
                    },
                    paren_token: Paren,
                    inputs: [],
                    variadic: None,
                    output: Default
                },
                block: Block {
                    brace_token: Brace,
                    stmts: [
                        Item(
                            Macro(
                                ItemMacro {
                                    attrs: [],
                                    ident: None,
                                    mac: Macro {
                                        path: Path {
                                            leading_colon: None,
                                            segments: [
                                                PathSegment {
                                                    ident: Ident {
                                                        term: Term {
                                                            sym: println
                                                        }
                                                    },
                                                    arguments: None
                                                }
                                            ]
                                        },
                                        bang_token: Bang,
                                        delimiter: Paren(
                                            Paren
                                        ),
                                        tts: TokenStream [
                                            Literal {
                                                lit: &quot;Hello, world!&quot;
                                            }
                                        ]
                                    },
                                    semi_token: Some(
                                        Semi
                                    )
                                }
                            )
                        )
                    ]
                }
            }
        )
    ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This might look a bit intimidating, so let’s break it down.  The top-most thing is a File.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;File&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Each File continues zero or more Items.  An Item are things like declarations.  Function declarations, for example, are one kind of Item.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;File
    &lt;ul&gt;
      &lt;li&gt;Item&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Since this file has one function, it has one item, an ItemFn.  This holds all the information about our main function.  You can see in here that we have the function’s declaration (sometimes called the function prototype, if you come from C).  This tells us how many parameters it takes, what its return type is, etc.  Luckily for us, this is all empty because main has nothing interesting here.  This lets us focus on the body of the function, here called ‘block’&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;File
    &lt;ul&gt;
      &lt;li&gt;Item (ItemFn)
        &lt;ul&gt;
          &lt;li&gt;Block&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Blocks contain statements and expressions.  This is really the meat of what actually &lt;em&gt;does&lt;/em&gt; things, and which is where we’ll actually spend our time writing the compiler.  Let’s take a closer look:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;block: Block {
    brace_token: Brace,
    stmts: [
        Item(
            Macro(
                ItemMacro {
                    attrs: [],
                    ident: None,
                    mac: Macro {
                        path: Path {
                            leading_colon: None,
                            segments: [
                                PathSegment {
                                    ident: Ident {
                                        term: Term {
                                            sym: println
                                        }
                                    },
                                    arguments: None
                                }
                            ]
                        },
                        bang_token: Bang,
                        delimiter: Paren(
                            Paren
                        ),
                        tts: TokenStream [
                            Literal {
                                lit: &quot;Hello, world!&quot;
                            }
                        ]
                    },
                    semi_token: Some(
                        Semi
                    )
                }
            )
        )
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On closer inspection we see this block has only one statement.  A something-something macro something or other.  Oh right, println is a macro!  Let’s focus on just the macro invocation itself:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mac: Macro {
    path: Path {
        leading_colon: None,
        segments: [
            PathSegment {
                ident: Ident {
                    term: Term {
                        sym: println
                    }
                },
                arguments: None
            }
        ]
    },
    bang_token: Bang,
    delimiter: Paren(
        Paren
    ),
    tts: TokenStream [
        Literal {
            lit: &quot;Hello, world!&quot;
        }
    ]
},
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now this is a little more like it.  It’s still a little cumbersome, but we can see the parts we need.  There’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;sym&lt;/code&gt; thing that says what the macro is.  Later on, we can see the string that we’re printing is a literal string.  We can ignore the rest.&lt;/p&gt;

&lt;p&gt;That’s it.  Make sure it’s invoking println, and then we’ll look for the string that’s being printed.&lt;/p&gt;

&lt;p&gt;To make things a little easier on ourselves, let’s make a quick-and-dirty intermediate representation.  This will only have one command so far, but it’ll be an easy way to de-couple the function that does the parsing from the one that does the code generation.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Command&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;PrintLn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With that, we’re ready to make our parser that can take in the &lt;code class=&quot;highlighter-rouge&quot;&gt;syn::File&lt;/code&gt; and output our Command.  There are a few ways we can do this, but to keep things pretty simple, I’m going to make a separate &lt;code class=&quot;highlighter-rouge&quot;&gt;parse&lt;/code&gt; function for each layer we talked about earlier: File, Item, and Block.  You can think of this as us unpacking the useful information from what &lt;code class=&quot;highlighter-rouge&quot;&gt;syn&lt;/code&gt; gives us into much simpler data structures.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[derive(Debug)]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;functions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[derive(Debug)]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[derive(Debug)]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Command&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;PrintLn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;vec!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.stmts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Macro&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;im&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;macro_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;im&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.mac.path.segments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.ident&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.as_ref&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;macro_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;println&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;im&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.mac.tts&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.into_iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PrintLn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()));&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                        &lt;span class=&quot;nb&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Expected argument in function&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.into&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()),&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;format!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unknown macro: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;macro_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unexpected statement in function&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.into&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()),&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ItemFn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;functions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;vec!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.items&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item_fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;functions&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;parse_fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item_fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unexpected item in file&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.into&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()),&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;functions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unable to open file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unable to read file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syntax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;syn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;parse_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unable to parse file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;syntax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{:#?}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Please supply the file to compile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which results in:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;Ok(
    File {
        functions: [
            Function {
                body: [
                    PrintLn(
                        &quot;\&quot;Hello, world!\&quot;&quot;
                    )
                ]
            }
        ]
    }
)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That’s much nicer!  It took a little work reading the &lt;code class=&quot;highlighter-rouge&quot;&gt;syn&lt;/code&gt; documentation, but once we got the hang of it, we can now work with real Rust source code and turn it into something we can use.&lt;/p&gt;

&lt;p&gt;Oh, before we go, let’s clean one thing up.  You might have noticed that extra set of quotes in the macro argument.  No problem, we’ll just turn:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PrintLn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Into:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PrintLn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;, &quot;&quot;)));
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which gives us:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;Ok(
    File {
        functions: [
            Function {
                body: [
                    PrintLn(
                        &quot;Hello, world!&quot;
                    )
                ]
            }
        ]
    }
)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Beautiful.  Now that we have it in this form, we have a much simpler form that we can hand to the other half of the translator.  In this half, we’ll be outputting the C code and compiling it.&lt;/p&gt;

&lt;p&gt;Since we only care about one function in one file, let’s just make a quick-and-dirty function to generate the C:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;compile_to_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;c_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;c_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;int main() {&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.functions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nn&quot;&gt;Command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PrintLn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;c_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;format!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;puts(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;\&lt;span class=&quot;s&quot;&gt;&quot;);&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;c_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;c_output&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s it.  Let’s call it.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;compile_to_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running it again, we get:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
int main() {
puts(&quot;Hello, world!&quot;);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Woah!  That looks like C to me.  Dare we try to compile it?&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; cargo run -- ../hello_rust/src/main.rs  &amp;gt; testme.c
&amp;gt; clang testme.c
&amp;gt; ./a.out
Hello, world!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;It… works!  We just made a compiler!&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; time ./target/release/rabbithole ../hello_rust/src/main.rs &amp;gt; testme.c

real    0m0.014s
user    0m0.010s
sys    0m0.004s
&amp;gt; time clang testme.c -o testme
real    0m0.100s
user    0m0.043s
sys    0m0.041s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nice, by cutting lots of corners and making our own translator, we got the compile times down from 0.378s to 0.114s, less than 1/3rd of where we were.&lt;/p&gt;

&lt;p&gt;Should we stop there?  Surely we can go further down the rabbit hole.  Oh right, C is not the lowest we can go&lt;/p&gt;

&lt;h2 id=&quot;deeper-down-the-rabbit-hole&quot;&gt;Deeper down the rabbit hole&lt;/h2&gt;

&lt;p&gt;Let’s cook up some assembly.  First, let’s test how fast we can assemble a hello world in assembly.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; cat hello_asm.s
 .text
 .global main
main:
 mov $hw_str, %rdi
 call puts
 mov $0, %rax
 ret

 .data
hw_str:
 .asciz &quot;hello asm&quot;
&amp;gt; time as hello_asm.s -o hello_asm.o
real    0m0.019s
user    0m0.008s
sys    0m0.011s
&amp;gt; time ld -o hello -dynamic-linker /lib64/ld-linux-x86-64.so.2 /usr/lib/x86_64-linux-gnu/crt1.o /usr/lib/x86_64-linux-gnu/crti.o -lc hello_asm.o /usr/lib/x86_64-linux-gnu/crtn.o

real    0m0.044s
user    0m0.036s
sys    0m0.008s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Wow, the assembly output cuts the compile almost in half!  If you haven’t seen x64 assembly before, that might look a little strange.  Instead of working with C code with functions, we’ve dropped down much closer to the machine itself.  The above represents the lowest we can go in Linux.  Let’s unpack what’s happening:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt; .text
 .global main
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Our assembly file starts with two things.  One, a section that we’ll be talking about the code itself (.text) and then the one symbol we’ll be making visible (main).  This will be the main function that the linker will use later.&lt;/p&gt;

&lt;p&gt;Next, main begins:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt;main:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;What follows are series of assembly commands.  The hardware keeps numbers and addresses in registers, similar to how you might store them in variables.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt;mov $hw_str, %rdi
call puts
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;With that in mind, this doesn’t seem quite so bad.  The first line is going to set up our register that we’ll use as the argument to the puts function (here, in Linux, %rdi).  After the argument is ready, we call puts.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt; mov $0, %rax
 ret
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After that, we return 0, just like we did in C.  Here, in 64-bit assembly, we’re returning the return value in %rax.&lt;/p&gt;

&lt;p&gt;That’s it.  Oh wait, one more thing.  So this was the code section, we still haven’t told it what the string is to print (which we called $hw_str earlier).&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-asm&quot;&gt; .data
hw_str:
 .asciz &quot;hello asm&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That’s not bad.  We have a data section that contains our strings.  We have one string, called &lt;code class=&quot;highlighter-rouge&quot;&gt;hw_str&lt;/code&gt;, and we give it a null-terminated string to print.&lt;/p&gt;

&lt;p&gt;You may have been wondering about our linker line, too:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; time ld -o hello -dynamic-linker /lib64/ld-linux-x86-64.so.2 /usr/lib/x86_64-linux-gnu/crt1.o /usr/lib/x86_64-linux-gnu/crti.o -lc hello_asm.o /usr/lib/x86_64-linux-gnu/crtn.o
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This bit of magic is actually the kind of tasks that your C compiler does for you behind the scenes.  In Linux, for a program to run, it needs to be able to access things like the Linux program loader, the C standard library, and the Linux subsystems.  The above takes the barebones object file we made with the assembler and gives it all it needs to be a complete Linux executable.&lt;/p&gt;

&lt;p&gt;Before we write our assembly-outputting function, let’s take a quick pause and talk about Windows.  We’ve been giving a lot of examples for Linux, but you can do the same kinds of things in Windows.  Make sure you have a 64-bit &lt;a href=&quot;https://www.nasm.us/&quot;&gt;nasm&lt;/a&gt; installed.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;C:\Users\Jonathan\source\fast_hello&amp;gt;type nasm_hello.asm
    global main
    extern puts

    section .text
main:
    push rbp
    mov rbp, rsp
    mov rcx, message
    call puts
    mov rax, 0
    pop rbp
    ret
message:
    db 'Hello, Rust!', 0
C:\Users\Jonathan\source\fast_hello&amp;gt;nasm -f win64 nasm_hello.asm -g -o nasm_hello.obj

C:\Users\Jonathan\source\fast_hello&amp;gt;link -out:b.exe -defaultlib:libcmt &quot;-libpath:C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\lib\\amd64&quot; &quot;-libpath:C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.15063.0\\ucrt\\x64&quot; &quot;-libpath:C:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.15063.0\\um\\x64&quot; -nologo nasm_hello.obj
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You can see that the assembly looks different, though it’s similar.  We do a little more setup, but the core of the work is the same.  We set up where the string is, we send it to the &lt;code class=&quot;highlighter-rouge&quot;&gt;puts&lt;/code&gt; function, and we return 0 via the &lt;code class=&quot;highlighter-rouge&quot;&gt;rax&lt;/code&gt; register.  Likewise, after we have an object file from the assembler, we have to do a similar dance with the linker in order to have a fully working Windows executable.&lt;/p&gt;

&lt;p&gt;With that, we can see all the techniques we’re using in Linux can work in Windows, too.&lt;/p&gt;

&lt;p&gt;Okay, let’s finish this up and see where we are.  Just like we wrote a C output function, we’re going to write an assembly output function.  This function will create two strings: one for the code and one for the data, and then stitch them together.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;compile_to_asm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asm_code_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asm_data_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;asm_data_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;.data&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;asm_code_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;.text&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;asm_code_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;.global main&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;asm_code_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;main:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp_num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.functions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nn&quot;&gt;Command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PrintLn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;asm_code_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;format!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mov $str_{}, &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;edi&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;asm_code_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;call puts&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;asm_data_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;format!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;str_{}:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;asm_data_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;format!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; .asciz &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;\&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;temp_num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;asm_code_output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asm_data_output&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; time ./target/release/rabbithole ../hello_rust/src/main.rs &amp;gt; hello_asm.s

real    0m0.015s
user    0m0.010s
sys    0m0.005s
&amp;gt; time as hello_asm.s -o hello_asm.o
real    0m0.022s
user    0m0.009s
sys    0m0.012s
&amp;gt; time ld -o hello -dynamic-linker /lib64/ld-linux-x86-64.so.2 /usr/lib/x86_64-linux-gnu/crt1.o /usr/lib/x86_64-linux-gnu/crti.o -lc hello_asm.o /usr/lib/x86_64-linux-gnu/crtn.o

real    0m0.043s
user    0m0.029s
sys    0m0.011s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;From 0.114s to 0.08s.  We dropped another 30% off the compile time!&lt;/p&gt;

&lt;p&gt;To recap, we started at 0.548s with Cargo, then 0.378s with rustc, 0.114 going via C, and 0.08 going via assembly.  Roughly a 6.8x speedup.  Can we squeeze anything else out?&lt;/p&gt;

&lt;p&gt;You might be wondering about keeping more things in memory and getting a bit more caching.  It’s a good hunch, let’s try it!&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;&amp;gt; time (./target/release/rabbithole ../hello_rust/src/main.rs &amp;gt; hello_asm.s &amp;amp;&amp;amp; as hello_asm.s -o hello_asm.o &amp;amp;&amp;amp; ld -o hello -dynamic-linker /lib64/ld-linux-x86-64.so.2 /usr/lib/x86_64-linux-gnu/crt1.o /usr/lib/x86_64-linux-gnu/crti.o -lc hello_asm.o /usr/lib/x86_64-linux-gnu/crtn.o)

real    0m0.048s
user    0m0.028s
sys    0m0.021s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That’s another 40% off the compile time.  We’ve now gone from 0.548s to 0.048s, a whole 11x faster.  There’s even more we can do.  For example, we can squeeze out more by writing our own parser, outputting the .o ourselves, and more.  But we’ll leave that as an exercise for the reader.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;I hope you had as much fun reading this post as I had in writing it.  There are amazing benefits to all the features that cargo and rustc provide, and the Rust ecosystem builds on those benefits.  At the same time, it’s fun to play around with compiler technology and see that when we get down to it, it’s just another Rust program that we can tune to our heart’s content.&lt;/p&gt;

&lt;p&gt;You can see the &lt;a href=&quot;https://github.com/jonathandturner/rabbithole&quot;&gt;rabbithole source&lt;/a&gt; if you want to play with it yourself.&lt;/p&gt;
</description>
				<pubDate>Thu, 03 May 2018 00:00:00 +1200</pubDate>
				<link>http://localhost:4000/2018/05/how-fast-can-we-compile-rust-hello-world.html</link>
				<guid isPermaLink="true">http://localhost:4000/2018/05/how-fast-can-we-compile-rust-hello-world.html</guid>
			</item>
		
			<item>
				<title>Talking about how we talk about Rust in 2018</title>
        <description>&lt;p&gt;&lt;em&gt;This is an entry in the #rust2018 blogging efforts to talk about Rust in 2018&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When you come to Rust, you’re bound to hear a lot of phrases.  “Wrestling with the compiler”. “Rust evangelism task force”. “Non-lexical lifetimes”. “Systems programming”.  Some seem strange. Others are a bit scary.  Some are just a common set you quickly need to learn to before you can even read the Rust news.&lt;/p&gt;

&lt;p&gt;In this post, I want to talk about how we talk about Rust in 2018.  I think there are some ways we can change what we’re saying and how we’re saying it. These changes will help Rust be more approachable for beginners and an even nicer place in general.&lt;/p&gt;

&lt;h1 id=&quot;wrestling-with-the-compiler&quot;&gt;“Wrestling with the compiler”&lt;/h1&gt;

&lt;p&gt;I think we’ve all been there. Especially when we’re starting with Rust, or trying to do something new with it we haven’t done before, we feel like the compiler is fighting us every step of the way.&lt;/p&gt;

&lt;p&gt;Sure, it’s frustrating. On a bad day, we might even say “forget it”. I wonder, though, is there a better way to talk about it? If you’re a Rust user, do you trust the compiler?  Are the error messages helping to clarify your thinking?  Is it, as some people like to say, a pair programming partner for you?&lt;/p&gt;

&lt;p&gt;I suggest in 2018, we kick the idea of wrestling with the Rust compiler to the curb and focus on how it helps us rather than the idea of it beating us down.  Niko mentioned &lt;a href=&quot;http://smallcultfollowing.com/babysteps/blog/2018/01/09/rust2018/&quot;&gt;error messages&lt;/a&gt; here to help with that, and I think we should push hard there.  While we can change how we talk about the compiler, we can also change how the compiler talks to us as well.&lt;/p&gt;

&lt;p&gt;By the end of 2018, no more wrestling.  It’s a tool to help us, and we should work hard both in how we talk and how it works to ensure this is true.&lt;/p&gt;

&lt;h1 id=&quot;rust-evangelism-task-force&quot;&gt;“Rust evangelism task force”&lt;/h1&gt;

&lt;p&gt;We’ve seen the jokes about Rust having its own task force that swoops in and says things like “you should rewrite it in Rust”.  Sometimes the swoop happens just as a new security exploit is released.  Sometimes it comes out of nowhere.&lt;/p&gt;

&lt;p&gt;Or maybe you’ve seen this: someone on a thread, maybe on reddit, posts that &lt;em&gt;maybe&lt;/em&gt; Rust isn’t doing so well in a benchmark or in a particular scenario.  Minutes later there are half a dozen comments dissecting what happened.&lt;/p&gt;

&lt;p&gt;It’s intimidating.  And really, it’s not helpful to Rust.&lt;/p&gt;

&lt;p&gt;As a community, it’s great that we have so much enthusiasm.  I just want to be sure we’re channeling that enthusiasm in a way that keeps Rust growing.  There are ways we can be courteous by not piling on or jumping in with uninvited suggestions.  That might seem like little things, but at scale I think they’ll make a big difference.&lt;/p&gt;

&lt;p&gt;Some of you may be familiar with burntsushi’s ripgrep tool.  The author of a similar tool, ack, had a &lt;a href=&quot;http://blog.petdance.com/2018/01/02/the-best-open-source-project-for-someone-might-not-be-yours-and-thats-ok/&quot;&gt;great quote&lt;/a&gt; about the other day that applies to more than just search tools:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;“If someone uses ripgrep instead of ack, it doesn’t hurt me.  It’s the difference between an abundance vs. scarcity view of the world.  I choose abundance.”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We can adopt the same way of thinking.  If someone wants to use Go or C instead of Rust, that’s great!  Perhaps that’s a better fit for what they’re working on.  Maybe they’ll try Rust again in the future.  We should make it easy to come and go.&lt;/p&gt;

&lt;h1 id=&quot;systems-programming&quot;&gt;“Systems programming”&lt;/h1&gt;

&lt;p&gt;There are a lot of terms that we use when talking about Rust that I think are simply confusing.  Have you ever had this conversation?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Person 1:&lt;/strong&gt; Have you heard of the Rust programming language?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Person 2:&lt;/strong&gt; I’m not sure, what is it?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Person 1:&lt;/strong&gt; It’s a systems programming language.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Person 2:&lt;/strong&gt; What’s a systems programming language?&lt;/p&gt;

&lt;p&gt;Rather than answering the question, we just made it seem even more complicated.  Confusingly, even among people who have used Rust for a while there isn’t even total consensus on what is meant by a systems programming language.  Doubly confusingly, Rust isn’t even &lt;em&gt;just&lt;/em&gt; a systems programming language anymore.  With the ability to create web applications and tie into other languages, it starts to feel more than just systems-level development.&lt;/p&gt;

&lt;p&gt;You can use Rust to build pretty much anything from a low-level operating system component to a JSX-like web app.  In the future, &lt;a href=&quot;https://twitter.com/marshall_law/status/944031810941603840&quot;&gt;we’ll be in space&lt;/a&gt;.  Systems is both too confusing and too limiting for what Rust will be used to do.&lt;/p&gt;

&lt;p&gt;Maybe there’s a better term that we can use, or a small phrase that captures the right feel?&lt;/p&gt;

&lt;h1 id=&quot;non-lexical-lifetimes-and-more&quot;&gt;“Non-lexical lifetimes” and more&lt;/h1&gt;

&lt;p&gt;Lots of the Rust community is pretty facile when it comes to computer science.  Some of us have dabbled in Haskell.  Others are old-hands at C++.  We’ve seen programming from different angles and have a lot of vocabulary to use to describe Rust.&lt;/p&gt;

&lt;p&gt;This started out as pretty effective short-hand.  “This is like typeclasses in Haskell” we might say.  “Lifetimes are lexically-scoped”.  “You need to use a lifetime variable, they’re just like generics…” Etc.  We can use it to communicate, but the end result can be a bit of a mouthful.&lt;/p&gt;

&lt;p&gt;I’m not going to suggest we remove these terms from our vocabulary entirely, but I want us to think about how we can improve what we write publically.  People we don’t know will come by IRC, read our blog posts, and see our forum threads.  They’ll be coming from a variety of backgrounds, many of which will be different from our own.&lt;/p&gt;

&lt;p&gt;If where we’re talking is public with a wide audience, let’s keep that in mind as we communicate.  Keep the door open for more people to join.&lt;/p&gt;

&lt;p&gt;Rust, at its heart, isn’t intimidating.  It’s a technology that a wide range of programmers can use to target a wide range of applications.  We don’t need to make it sound or feel more complicated, and those extra few minutes to reword a sentence here or there can help.&lt;/p&gt;

</description>
				<pubDate>Wed, 10 Jan 2018 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2018/01/how-we-talk-about-rust-in-2018.html</link>
				<guid isPermaLink="true">http://localhost:4000/2018/01/how-we-talk-about-rust-in-2018.html</guid>
			</item>
		
			<item>
				<title>Improving how we improve Rust in 2018</title>
        <description>&lt;p&gt;Here’s my #rust2018 post to add to the batch.&lt;/p&gt;

&lt;p&gt;The past few years, I’ve been lucky to be part of the Rust community survey process.  In 2016, this data helped show the need to improve usability.  We had good foundations, but they were too hard to get at.  In 2017, we saw a renewed need to reach out to companies, to improve documentation, and a continued importance of pushing to making Rust more usable.&lt;/p&gt;

&lt;p&gt;These surveys were a key part of seeing big issues, but it got me thinking.  Are there better ways to get and use data?  Can we see Rust more clearly – for what we do well and where we need to improve – in the future?&lt;/p&gt;

&lt;p&gt;When you do performance tuning, you benchmark and run perf profilers to get at the root of the problem.  What if we did the equivalent for Rust as a whole?&lt;/p&gt;

&lt;p&gt;We already measure through the surveys.  The problem is, we can only really measure once or twice a year.  This results in waiting long periods of time to see if we successfully addressed an issue.  The delay may mean we don’t catch new issues in time or we may fix a problem only to find out we didn’t address the underlying cause.&lt;/p&gt;

&lt;h1 id=&quot;getting-better-data-sooner&quot;&gt;Getting better data, sooner&lt;/h1&gt;

&lt;p&gt;What if we had a way to have better data sooner?  There are a few ways we could do this.&lt;/p&gt;

&lt;h2 id=&quot;smaller-surveys&quot;&gt;Smaller surveys&lt;/h2&gt;

&lt;p&gt;The first thing we could do is put out smaller surveys and use them as a quick check-in.  They might target specific features in a “did this change solve your issue?” way.  We do a bit of this in the RFC process already.  People who know about a particular RFC can jump in and comment on whether or not it the approach works for them.&lt;/p&gt;

&lt;p&gt;While we want to continue using RFCs for this feedback, we could extend what we do here.  For example, a blog post could talk about a group of RFCs working together to address one core problem. We could have a quick survey as part of the post to gather feedback on whether the combination of changes does what we hoped.&lt;/p&gt;

&lt;p&gt;This is still pretty manual, though, and is focused developers actively reading RFCs and blogs and volunteering their time, which may be limited.  Are there ways we can get more people involved across a wider range of changes?&lt;/p&gt;

&lt;h2 id=&quot;usability-studies&quot;&gt;Usability studies&lt;/h2&gt;

&lt;p&gt;There’s another avenue we could explore: usability studies.  Work on software development in the past has shown there’s naturally a distance between what people &lt;em&gt;think&lt;/em&gt; they spend the most time on and what they actually &lt;em&gt;do&lt;/em&gt; spend the most time on.  Self-reporting often misses these insights.&lt;/p&gt;

&lt;p&gt;When you actually watch someone working, issues with usability become more obvious.&lt;/p&gt;

&lt;p&gt;With the rise of coding streams, we already have some usability data already.  Perhaps there is a way to leverage the same tools so that we can perform studies remotely.  The end result of these could more directly answer how workflows improve, and give us a clearer insight into both the Rust learning process and how more experienced Rust users use Rust in their work.&lt;/p&gt;

&lt;h2 id=&quot;opt-in-statistics&quot;&gt;Opt-in statistics&lt;/h2&gt;

&lt;p&gt;What if Rust developers could opt-in to some statistics gathered from the tools themselves?  This would let Rust developers help the Rust project as part of their everyday work.&lt;/p&gt;

&lt;p&gt;So it’s clear, let me state I’m a strong privacy advocate.  I have no desire to read people’s private source code, to try to “guess” what they’re doing, or anything remotely like that.  Instead, here are some ideas we could be looking at that are helpful while not being invasive:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;What error messages are people hitting?  How often?&lt;/li&gt;
  &lt;li&gt;Roughly how much time is spent working in Rust?&lt;/li&gt;
  &lt;li&gt;How long are build times compared to the lines of code?  How much is incremental compilation helping?&lt;/li&gt;
  &lt;li&gt;Roughly how much are particular language features being used?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I believe there’s a way to we can gather data like this in a way that is both opt-in and preserves the privacy of the developer.&lt;/p&gt;

&lt;h2 id=&quot;transparency&quot;&gt;Transparency&lt;/h2&gt;

&lt;p&gt;An important aspect of “better data, sooner” is transparency.&lt;/p&gt;

&lt;p&gt;If we’re careful, we can and should make the data we gather public.  It gives contributors a window into the Rust world in more depth than we’ve previously had.&lt;/p&gt;

&lt;p&gt;Imagine a live “board” where you could go and see Rust being used in real time, seeing what errors are occuring the most or if the latest fixes to nightly improved build times in the wild.  This data could help not only people putting code in the compiler, but also folks writing RFCs, documentation, and more.&lt;/p&gt;

&lt;h1 id=&quot;measure-twice-cut-once&quot;&gt;Measure twice, cut once&lt;/h1&gt;

&lt;p&gt;When I was growing up, my dad would do various woodworking projects around the house.  When I’d help, he would remind me to “measure twice, cut once”.  You didn’t want to waste the effort it took to cut the wood if you couldn’t use the result.&lt;/p&gt;

&lt;p&gt;We can take a similar attitude for Rust in 2018.  There are a lot of things we &lt;em&gt;could&lt;/em&gt; do.  Lots of initiatives.  Lots of projects.  Can we come up with ways to measure twice before we invest the time?  I think we can, and Rust will be better for it.&lt;/p&gt;

&lt;p&gt;Here’s to a happy, successful Rust in 2018!&lt;/p&gt;
</description>
				<pubDate>Sun, 07 Jan 2018 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2018/01/rust2018-and-data.html</link>
				<guid isPermaLink="true">http://localhost:4000/2018/01/rust2018-and-data.html</guid>
			</item>
		
			<item>
				<title>Fun facts about Rust's growing popularity</title>
        <description>&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;There are now &lt;a href=&quot;https://www.rust-lang.org/en-US/friends.html&quot;&gt;100 friends of Rust&lt;/a&gt; (Be sure to hover to learn about how each company uses Rust)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There are now 3 Rust podcasts: &lt;a href=&quot;http://www.newrustacean.com/&quot;&gt;New Rustacean&lt;/a&gt;, &lt;a href=&quot;https://rusty-spike.blubrry.net/&quot;&gt;Rusty Spike&lt;/a&gt;, and &lt;a href=&quot;https://request-for-explanation.github.io/podcast/&quot;&gt;Request for Explanation&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;First year had one conference, the second year had three, and &lt;a href=&quot;https://blog.rust-lang.org/2017/07/18/conf-lineup.html&quot;&gt;this year had four&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;crates.io is not even 3 years old, but already the number of crates has &lt;a href=&quot;http://www.modulecounts.com/&quot;&gt;passed CRAN(R) and Hackage(Haskell)&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The Rust reddit is now over &lt;a href=&quot;https://www.reddit.com/r/rust/&quot;&gt;29,000 Rustaceans strong&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;the #rust irc channel has grown to over 1300 people&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The Rust gitter channel is &lt;a href=&quot;https://gitter.im/rust-lang/rust&quot;&gt;over 1800 people&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;our first Rust survey had 3,086 responses. Our second had 5,368 responses, over 2,000 more than the first year.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is a &lt;a href=&quot;https://octoverse.github.com/&quot;&gt;top 10 most discussed&lt;/a&gt; project on GitHub.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is a &lt;a href=&quot;https://octoverse.github.com/&quot;&gt;top 10 most reviewed&lt;/a&gt; project on GitHub.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is used on &lt;a href=&quot;https://air.mozilla.org/rust-meetup-may-2017/&quot;&gt;hundreds of millions of desktops&lt;/a&gt; via Dropbox.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The “impl period” now has &lt;a href=&quot;https://internals.rust-lang.org/t/the-impl-period-newsletter-2/6034&quot;&gt;at least 37 different teams&lt;/a&gt; helping implement new designs.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The popular @code, ranked 5th in this years Stack Overflow survey, &lt;a href=&quot;https://github.com/Microsoft/vscode/pull/22722&quot;&gt;powers its code search with ripgrep&lt;/a&gt;, a search tool written in Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Atlassian uses Rust in a service for analyzing petabytes of source code.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The new O’Reilly Rust book was the &lt;a href=&quot;https://twitter.com/safaribot/status/919255962120318976&quot;&gt;most popular on Safari&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There are &lt;a href=&quot;https://www.meetup.com/topics/rust/&quot;&gt;over 100 meetups&lt;/a&gt; around the world discussing Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;npm rewrote performance-critical bottlenecks in the registry service architecture with Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Popular indie game developer Chucklefish recently &lt;a href=&quot;https://www.reddit.com/r/rust/comments/78bowa/hey_this_is_kyren_from_chucklefish_we_make_and/&quot;&gt;announced their new game will be written in Rust&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The number of full-time Rust developers continues to grow. Over half are &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;working on large Rust codebases&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust was the &lt;a href=&quot;https://insights.stackoverflow.com/survey/2017#most-loved-dreaded-and-wanted&quot;&gt;most loved technology two years in a row&lt;/a&gt; in the Stack Overflow survey.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;@rustlang has &lt;a href=&quot;https://twitter.com/rustlang&quot;&gt;over 24k twitter followers&lt;/a&gt; 🎉🎉&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;367 applicants applied for the 12 spots in the &lt;a href=&quot;https://blog.rust-lang.org/2017/06/27/Increasing-Rusts-Reach.html&quot;&gt;Rust Reach initiative&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There are at least 5 Rust books in production, with releases over the next 18 monts.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Red Hat added support for Rust in their &lt;a href=&quot;https://developers.redhat.com/blog/2017/10/04/red-hat-adds-go-clangllvm-rust-compiler-toolsets-updates-gcc/&quot;&gt;recent updates&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;IntelliJ &lt;a href=&quot;https://intellij-rust.github.io/2017/07/31/changelog-47.html&quot;&gt;officially supports Rust&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust’s reddit channel hit 100,000 uniques and 1,000,000 views in July&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Amazon is hiring for &lt;a href=&quot;https://www.amazon.jobs/en/jobs/559813/sr-software-development-engineer&quot;&gt;developers with Rust experience&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Google engineers are experimenting with &lt;a href=&quot;https://chromium.googlesource.com/chromiumos/platform/crosvm/&quot;&gt;Rust for low-level system modules&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The official &lt;a href=&quot;https://www.youtube.com/channel/UCaYhcUwRBNscFNUKTjgPFiA/videos&quot;&gt;Rust YouTube channel&lt;/a&gt; has over 90 videos on Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Android Rust development grew &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;10x in 2017 (to 9.9% of devs)&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;iOS Rust development grew &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;10x in 2017 (to 5.3% of devs)&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust has seen slow, steady growth in commercial usage. Now over &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;20% of Rust devs use it at work&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;More than 75% of respondents&lt;/a&gt; said they feel comfortable in the Rust community, which includes even non-users of Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;Rust attracts about 18%&lt;/a&gt;, or roughly 1/5th, of its userbase in new users every month.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The number of Rust devs with more than a year of experience grew to &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;42% in the last year&lt;/a&gt;. That’s a lot of experience!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;More than 2% of all Rust devs work on Rust codebases totalling &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;more than 100k lines of code&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A growing number of Rust devs use Windows, which now makes up over &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;30% of all Rust users&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;This year we saw a huge increase, at &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;16% of responses&lt;/a&gt;, in the amount and style of documentation requested to cover more learning styles&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;This year we also saw a shift in non-user reasons to be &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;companies don’t use it&lt;/a&gt;. More folks now would learn it if it can pay the bills.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Speaking of module counts, at 16/day Rust is the &lt;a href=&quot;http://www.modulecounts.com/&quot;&gt;7th fastest growing package repo&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The &lt;a href=&quot;https://internals.rust-lang.org/&quot;&gt;Rust internal forum&lt;/a&gt; is a hotbed of activity, with popular posts regularly getting over 10k views.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A growing number of GNOME developers are using Rust, with ports underway for &lt;a href=&quot;https://mail.gnome.org/archives/desktop-devel-list/2017-January/msg00001.html&quot;&gt;some important libraries&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust and GNOME teams have had one hackfest with another next month&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Though early days, we’re seeing more Rust support in the  &lt;a href=&quot;https://coaxion.net/blog/2017/10/rendering-html5-video-in-servo-with-gstreamer/&quot;&gt;gstreamer media playback framework&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Canonical uses Rust in everything from server monitoring to middleware.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Lots of System 76 &lt;a href=&quot;https://github.com/system76&quot;&gt;tools and systems code&lt;/a&gt; are written in Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Principal Intel engineers are &lt;a href=&quot;https://twitter.com/agnathan/status/895461817899663360&quot;&gt;encouraging people to learn Rust&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Facebook wrote a &lt;a href=&quot;https://github.com/facebookexperimental/mononoke&quot;&gt;mercurial server in Rust&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Facebook is also a &lt;a href=&quot;https://www.rust-belt-rust.com/sponsors.html&quot;&gt;sponsor for Rust Belt Rust&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://thanks.rust-lang.org/&quot;&gt;Over 2000 people&lt;/a&gt; have contributed to Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The github repo has also gotten over 24k stars, making it one of the most popular programming language repos.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Not to be missed, even the Rust book repo had &lt;a href=&quot;https://github.com/rust-lang/book&quot;&gt;over 180 contributors&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust &lt;a href=&quot;https://hacks.mozilla.org/2016/07/shipping-rust-in-firefox/&quot;&gt;first shipped in Firefox 48&lt;/a&gt;, almost a year and a half ago.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is now used in five different modules in Firefox, with the next release having a new style system written in Rust.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://twitter.com/RustBridge&quot;&gt;Rust Bridge&lt;/a&gt; continues to be a good outreach to underrepresented  developers, now having its 7th(?) event at this week’s Rust Belt Rust&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is supported by &lt;a href=&quot;https://www.rust-lang.org/en-US/team.html&quot;&gt;11 regular subteams and 3 shepherd teams&lt;/a&gt; that help mentor and lead discussion&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Staff engineer at Tumblr mentions that &lt;a href=&quot;https://twitter.com/pearapps/status/902485357178048512&quot;&gt;Tumblr is using Rust&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is just behind Scala in active github projects (this month: &lt;a href=&quot;https://api.github.com/search/repositories?q=stars:%3E0+forks:%3E0+size:%3E10+language:rust+pushed:2017-10-01..2017-10-31&quot;&gt;1263&lt;/a&gt; vs &lt;a href=&quot;https://api.github.com/search/repositories?q=stars:%3E0+forks:%3E0+size:%3E10+language:scala+pushed:2017-10-01..2017-10-31&quot;&gt;1376&lt;/a&gt;)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;If you haven’t seen them yet, the Mozilla Hacks videos are some of Rust’s most popular (with &lt;a href=&quot;https://www.youtube.com/watch?v=8EPsnf_ZYU0&quot;&gt;one over 50k views&lt;/a&gt;)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Also in the survey, 16.8% of Rust devs are doing embedded work.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.twitter.com/japaricious&quot;&gt;Jorge Aparacio&lt;/a&gt; has been a long-time supporter for embedded and is writing a &lt;a href=&quot;https://github.com/japaric/discovery&quot;&gt;book for embedded Rust development&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust got mentioned in &lt;a href=&quot;https://twitter.com/chasinglogic/status/850115493923086336&quot;&gt;a Batgirl comic&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The new Chucklefish game is not the first in Rust.  An even earlier game was &lt;a href=&quot;https://www.twitter.com/bringershar&quot;&gt;Shar&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Between Rust’s first and second year, 56 RFCs were merged.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In the last ~3 months, 36 RFCs were merged.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust has had over 45 releases. Many since 1.0 have been well-received in programming news circles.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Another published Rust game is &lt;a href=&quot;https://m12y.com/a-snakes-tale/&quot;&gt;a Snake’s Tale&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Speaking of popular posts, one Rust project, alacritty, received &lt;a href=&quot;https://news.ycombinator.com/item?id=13338592&quot;&gt;over 1000 points on Hacker News&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;crates.io has had over 240,000,000 downloads&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;standard Rust tools are voted/promoted by the community. RLS,  rustfmt, clippy, and rustup each have over 1000 stars on GitHub.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;for a bit of history, here’s &lt;a href=&quot;https://blog.rust-lang.org/2015/04/10/Fearless-Concurrency.html&quot;&gt;a post that helped start it all&lt;/a&gt;. To this day, still a regularly referenced post.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Ever wonder about the en-US at the end of https://www.rust-lang.org/en-US/ ? The Rust homepage is in 13 different languages!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Language interop is an important piece of Rust’s growth.  We have C++ interop with &lt;a href=&quot;https://github.com/rust-lang-nursery/rust-bindgen&quot;&gt;bindgen&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There’s also node.js interop with &lt;a href=&quot;https://www.twitter.com/RustNeon&quot;&gt;Neon&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;There’s good Ruby/Rust interop with &lt;a href=&quot;https://github.com/tildeio/helix&quot;&gt;Helix&lt;/a&gt; and others&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Python and Rust also have &lt;a href=&quot;https://bheisler.github.io/post/calling-rust-in-python/&quot;&gt;on-going interop work&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In addition to interop, Rust has been an &lt;a href=&quot;https://github.com/apple/swift-evolution/blob/master/releases/swift-4_0.md&quot;&gt;influence on Swift&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust’s focus on memory safety without performance loss has helped other languages as well, &lt;a href=&quot;https://www.youtube.com/watch?v=iDFhvCkCLb4&amp;amp;list=PL3jwVPmk_PRxo23yyoc0Ip_cP3-rCm7eB&amp;amp;index=1&quot;&gt;including D&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust has also been inspired by other languages, including a &lt;a href=&quot;https://blog.rust-lang.org/2016/08/10/Shape-of-errors-to-come.html&quot;&gt;revamp of errors&lt;/a&gt; inspired by Elm.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust has also grown from a wide range of influences, including discussions with &lt;a href=&quot;https://channel9.msdn.com/Events/Lang-NEXT/Lang-NEXT-2014/Panel-Systems-Programming-Languages-in-2014-and-Beyond&quot;&gt;top language designers&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust’s 1st job was on creating browser tech.  In making Servo, Rust focused on both safety and speed, w/o one excluding the other.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust focuses on productivity also, &lt;a href=&quot;https://blog.rust-lang.org/2017/03/02/lang-ergonomics.html&quot;&gt;leaning on ergonomics&lt;/a&gt; for getting more done with fewer language rough edges.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;IEEE lists Rust as the &lt;a href=&quot;https://spectrum.ieee.org/static/interactive-the-top-programming-languages-2017&quot;&gt;22nd most popular programming language&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;This year, according to Redmonk, Rust &lt;a href=&quot;http://redmonk.com/sogrady/2017/03/17/language-rankings-1-17/&quot;&gt;jumped from 47th to 26th most popular programming language&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Likewise, Google trends shows Rust with (albeit a little noisy) &lt;a href=&quot;https://trends.google.com/trends/explore?date=today%205-y&amp;amp;q=%2Fm%2F0dsbpg6&quot;&gt;comfortable growth over the last 5 years&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is global, with heavy growth in the United States and Europe. These are the &lt;a href=&quot;https://twitter.com/jntrnr/status/924107142595878912&quot;&gt;meetup locations worldwide&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Google trends also shows strong activity recently in &lt;a href=&quot;https://trends.google.com/trends/explore?date=today%203-m&amp;amp;q=%2Fm%2F0dsbpg6&quot;&gt;parts of Asia&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Just noticed the Rust reddit has had 16 posts in the last 24 hours. Not bad!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust just isn’t a lang, but a community as well, with a focus on helpfulness. &lt;a href=&quot;https://medium.com/@geekytwoshoes11/once-a-rustacean-always-a-rustacean-fed0a877472f&quot;&gt;Growing this&lt;/a&gt; is also important.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In addition to community, Rust-focused contractors like &lt;a href=&quot;https://integer32.com/&quot;&gt;Integer 32&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/asquera&quot;&gt;Asquera&lt;/a&gt; have sprung up.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Speaking of, there are a number of trainers available for Rust. The &lt;a href=&quot;https://github.com/rust-community/team&quot;&gt;Rust community team&lt;/a&gt; can help connect you.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;If you can make it out to one of the conferences, there are &lt;a href=&quot;http://rustconf.com/training.html&quot;&gt;great hands-on labs&lt;/a&gt; there as well.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;We’ve seen through multiple surveys that people stick around once they get used to Rust. It’s a joy to watch.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;I forgot to mention, there’s also an &lt;a href=&quot;https://rust-slack.herokuapp.com/&quot;&gt;unofficial Rust slack&lt;/a&gt; channel.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;As well as an &lt;a href=&quot;https://discord.me/rust-lang&quot;&gt;unofficial discord server&lt;/a&gt; for Rust discussions.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is used commercially in a &lt;a href=&quot;https://internals.rust-lang.org/t/2016-rust-commercial-user-survey-results/4317&quot;&gt;wide range of areas&lt;/a&gt;, incl. embedded systems, a/v transcoding, servers, and more.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The &lt;a href=&quot;https://internals.rust-lang.org/t/announcing-the-impl-period-sep-18-dec-17/5676&quot;&gt;“impl period”&lt;/a&gt; is a reaction to Rust’s growth. Discussions were at such a high volume that focus was needed.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The Rust team at Mozilla is spread across three continents, with most hosting meetups/talks.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Speaking of meetups, if you ever have a chance to go, check out the SF Rust meetup. Lots of great talks/ideas (also free pizza!)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A core piece of Rust’s growth is a sense of courtesy. This comes from the &lt;a href=&quot;https://www.rust-lang.org/en-US/conduct.html&quot;&gt;code of conduct&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is growing into new areas. Recently, there’s been a focus on WASM support, with new tools like &lt;a href=&quot;https://lord.io/blog/2017/wargo/&quot;&gt;wargo&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Anecdotally, I can say that I see new faces on Rust twitter regularly. More people are getting excited and sharing their adventures.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A big feature for commercial adoption just landed in cargo: &lt;a href=&quot;https://boats.gitlab.io/blog/post/2017-10-28-alternative-registries/&quot;&gt;alternative registries&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The Rust community has its own poet that writes limericks on the news, &lt;a href=&quot;https://twitter.com/llogiq/status/924256412125007872&quot;&gt;including yours truly&lt;/a&gt;. 😅&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Another fun survey fact: despite more users and releases every 6 weeks, &lt;a href=&quot;https://blog.rust-lang.org/2017/09/05/Rust-2017-Survey-Results.html&quot;&gt;only ~7% of users had upgrade breakage&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.twitter.com/linclark&quot;&gt;Lin Clark&lt;/a&gt;, who makes awesome code cartoons, wrote a popular one on the upcoming &lt;a href=&quot;https://hacks.mozilla.org/2017/08/inside-a-super-fast-css-engine-quantum-css-aka-stylo/&quot;&gt;Firefox style system rewrite&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Also, speaking of, there was a followup article on WebRender, another upcoming &lt;a href=&quot;https://hacks.mozilla.org/2017/10/the-whole-web-at-maximum-fps-how-webrender-gets-rid-of-jank/&quot;&gt;update to Firefox rendering&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;While some may see Rust as largely Mozilla-driven, the Rust core team is actually made of folks from four different companies.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;On a personal note, I’ve been pleasantly surprised that each Rusty Spike episode has gotten &lt;a href=&quot;https://twitter.com/jntrnr/status/924337748047048704&quot;&gt;over 500 listens&lt;/a&gt;, even though it’s new.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;This is the place-holder for a lot of stuff we can’t talk about being done by companies you might know. Wish we could talk about it!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Outreach to companies is exclusively grass roots by engineers in those companies promoting Rust and asking people to present.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rust is growing in importance in infosec. Projects like Tor have already begun &lt;a href=&quot;https://www.bleepingcomputer.com/news/software/tor-browser-will-feature-more-rust-code/&quot;&gt;moving code to Rust&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/rust-unofficial/awesome-rust&quot;&gt;Awesome Rust&lt;/a&gt; is well worth a shout-out. If you ever wonder about what’s good in the Rust world, check it out.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
				<pubDate>Mon, 30 Oct 2017 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2017/10/fun-facts-about-rust-growth.html</link>
				<guid isPermaLink="true">http://localhost:4000/2017/10/fun-facts-about-rust-growth.html</guid>
			</item>
		
			<item>
				<title>RLS now available on nightly</title>
        <description>&lt;p&gt;We’ve got some good news for Rust IDE support.&lt;/p&gt;

&lt;p&gt;We recently hit a milestone for the Rust Language Server, a tool that combines the power of the compiler with a fast autocompletion engine.  Up to this point, if you wanted to use it you had to build it from scratch.  The process was tedious, time-consuming, and error-prone.&lt;/p&gt;

&lt;p&gt;We’re happy to report you can now install RLS from &lt;a href=&quot;https://rustup.rs/&quot;&gt;rustup&lt;/a&gt;.  Landing as a component in rustup means a few important things.&lt;/p&gt;

&lt;p&gt;First, this will make it &lt;strong&gt;easier to get up and running&lt;/strong&gt; with the RLS. You no longer have to build the RLS to use it. Getting it up and running now just takes the time to run a few rustup commands:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rustup default nightly
rustup update nightly
rustup component add rls
rustup component add rust-analysis
rustup component add rust-src
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can find more helpful tips in the &lt;a href=&quot;https://github.com/rust-lang-nursery/rls/blob/master/README.md&quot;&gt;readme&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Second, this also makes it &lt;strong&gt;easier for IDE/editor plugins to automatically install the RLS&lt;/strong&gt; and use its capabilities.  This opens up the possibility for an even smoother user experience that is driven directly by the IDE plugin.  We’re looking forward to exploring this further.&lt;/p&gt;

&lt;p&gt;Lastly, it is now &lt;strong&gt;easier to stay up-to-date&lt;/strong&gt; with the RLS as it improves.  Once you install the component, it will update alongside your compiler.  All you’ll need to do is run the &lt;code class=&quot;highlighter-rouge&quot;&gt;rustup update nightly&lt;/code&gt; command, and the RLS and its dependencies will update with it.&lt;/p&gt;

&lt;p&gt;We’ve also been hard at work fixing bugs and improving the experience of using the RLS so that it’s more stable and accurate than before.  For larger projects, you may also notice that the RLS is a bit faster as well.&lt;/p&gt;

&lt;p&gt;We’re excited to get this out to more people and hear your &lt;a href=&quot;https://github.com/rust-lang-nursery/rls/issues&quot;&gt;feedback&lt;/a&gt;.  There’s still plenty of work to do, and if you’d like to jump in and &lt;a href=&quot;https://github.com/rust-lang-nursery/rls/blob/master/contributing.md&quot;&gt;help&lt;/a&gt;, we’d love to have you.&lt;/p&gt;
</description>
				<pubDate>Tue, 18 Apr 2017 00:00:00 +1200</pubDate>
				<link>http://localhost:4000/2017/04/rls-now-in-nightly.md.html</link>
				<guid isPermaLink="true">http://localhost:4000/2017/04/rls-now-in-nightly.md.html</guid>
			</item>
		
			<item>
				<title>Using Rust in Windows</title>
        <description>&lt;p&gt;As a Rust user, I was discouraged by not having all the good tips for using Rust in Windows in one place.  This is an attempt to just that.  If you have more tips tweet them to @jntrnr, and I’ll try to add them here.&lt;/p&gt;

&lt;h1 id=&quot;getting-started&quot;&gt;Getting started&lt;/h1&gt;

&lt;h2 id=&quot;step-1-install-visual-studio-community-edition&quot;&gt;Step 1: Install Visual Studio Community edition&lt;/h2&gt;

&lt;p&gt;My recommendation for working with Rust in Windows is to first get &lt;a href=&quot;https://www.visualstudio.com/downloads/&quot;&gt;Visual Studio 2017 Community&lt;/a&gt; installed.  &lt;em&gt;Edit:&lt;/em&gt; Make sure you check the boxes to install &lt;strong&gt;C++ support&lt;/strong&gt; when you instal Visual Studio, this provides the linker. The Rust compiler will use the linker that VS provides to translate our Rust code all the way to being an application.  Having VS installed pays off in more ways than one, as we’ll see later.&lt;/p&gt;

&lt;h2 id=&quot;step-2-install-rustup&quot;&gt;Step 2: Install rustup&lt;/h2&gt;

&lt;p&gt;The Rust toolchain (including the compiler and the &lt;code class=&quot;highlighter-rouge&quot;&gt;cargo&lt;/code&gt; build tool) are managed by a tool called &lt;a href=&quot;https://rustup.rs/&quot;&gt;rustup&lt;/a&gt;.  This is the easiest way get going with Rust.  It also has a few advantages, like allowing you to more easily switch the style of compiler (stable/beta/nightly) as well as building for other targets, like embedded systems.&lt;/p&gt;

&lt;p&gt;Once Visual Studio is installed, rustup will detect it and let us install the compiler that works with the VS toolchain.  Rustup on the initial install will let you pick the compiler, and you can select working with nightly or release.  What you choose is up to you.  Nightly gives you access to new features but hasn’t been tested as thoroughly as the stable release compiler.&lt;/p&gt;

&lt;p&gt;Whether you choose Nightly or Stable, you’ll have commands available to you at the terminal.  You won’t need a separate shell to get to them.  The commands ‘rustc’ and ‘cargo’ are the Rust compiler and Rust package manager respectively.&lt;/p&gt;

&lt;h2 id=&quot;step-3-make-sure-everything-is-working&quot;&gt;Step 3: Make sure everything is working&lt;/h2&gt;

&lt;p&gt;In a source directory, you can test if Rust has been installed correctly by creating a simple project, compiling it, and running it.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cargo new hello_world --bin
cd hello_world
cargo run (or &quot;cargo build&quot; followed by &quot;cargo run&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can find out lots of helpful general &lt;a href=&quot;https://doc.rust-lang.org/book/getting-started.html&quot;&gt;getting started tips&lt;/a&gt; in the Rust documentation.&lt;/p&gt;

&lt;h1 id=&quot;writing-rust-code-in-windows&quot;&gt;Writing Rust Code in Windows&lt;/h1&gt;

&lt;p&gt;Currently, IDE support for Rust is still in its infancy.  If you don’t need fully intellisense-style IDE experience, pretty much all editors now have basic Rust support.  Pick your favorite one, install their Rust plugin or syntax highlighter, and you’re good to go.  Many of these plugins come with support for a project called ‘racer’, which provides an autocompletion.  Visual Studio users may be interested in &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=vosen.VisualRust&quot;&gt;Visual Rust&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For the more daring, there’s a project called the &lt;a href=&quot;https://github.com/rust-lang-nursery/rls&quot;&gt;Rust Language Server&lt;/a&gt;, which is based on the &lt;a href=&quot;https://github.com/Microsoft/language-server-protocol/blob/master/protocol.md&quot;&gt;Language Server Protocol&lt;/a&gt; developed for VS Code and now part of a growing number of editors and IDEs.&lt;/p&gt;

&lt;p&gt;You can find steps for how to set up the RLS and use it with VS Code on its &lt;a href=&quot;https://github.com/rust-lang-nursery/rls/blob/master/README.md&quot;&gt;readme&lt;/a&gt;.  That said, the RLS is still pre-beta quality as of the writing of this post, so please exercise caution if you go this route.&lt;/p&gt;

&lt;h1 id=&quot;debugging-with-visual-studio&quot;&gt;Debugging with Visual Studio&lt;/h1&gt;

&lt;p&gt;Earlier we installed Visual Studio.  It seems a waste to have this nice VS install sitting around and not getting more benefit from it it.  Let’s use it for debugging.&lt;/p&gt;

&lt;p&gt;Before we do some debugging, there are two steps we’ll want to do beforehand:&lt;/p&gt;

&lt;h2 id=&quot;step-1-install-rust-src&quot;&gt;Step 1: Install rust-src&lt;/h2&gt;

&lt;p&gt;When we’re debugging, VS will sometimes complain because it can’t find the source code to the standard libs.  We can remove this announce by installing the rust-src, and helping VS find the source it’s looking for (this is also a helpful step for &lt;code class=&quot;highlighter-rouge&quot;&gt;racer&lt;/code&gt; support)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rustup component add rust-src
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will let you find the source to the standard libs when you’re debugging.  After the command is run, it will be put in your .multirust directory.  For me that directory is:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Jonathan Turner\.multirust\toolchains\nightly-x86_64-pc-windows-msvc\lib\rustlib\src\rust\src
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When Visual Studio asks you for a file from the standard library source, this should give you a good place to start looking for it.&lt;/p&gt;

&lt;h2 id=&quot;step-2-add-natvis-for-rust&quot;&gt;Step 2: Add natvis for Rust&lt;/h2&gt;

&lt;p&gt;Rust has its own common structs, like String and Vec, that Visual Studio won’t understand by default currently.  To be able to view these data structures, we use native visualisation or .natvis files.  Rustup will helpfully make them available for us, we just have to copy them into our personal directory.  For me, the .natvis files are in:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Jonathan Turner\.multirust\toolchains\nightly-x86_64-pc-windows-msvc\lib\rustlib\src\rust\src\etc\natvis
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NOTE: you may need to install the &lt;code class=&quot;highlighter-rouge&quot;&gt;nightly&lt;/code&gt; toolchain to have this directory.  You don’t need to use the nightly compiler as your main compiler, though, to take advantage of them.&lt;/p&gt;

&lt;p&gt;I copy these files into:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\Jonathan Turner\Documents\Visual Studio 2017\Visualizers
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you don’t have a &lt;code class=&quot;highlighter-rouge&quot;&gt;Visualizers&lt;/code&gt; directory, go ahead and create it and then copy the files into it.  Once you start up VS, it should pick them up and give you a little better view of your Rust data.&lt;/p&gt;

&lt;p&gt;With that, debugging a Rust app works very similar to debugging other apps.  There are a few steps you need to do:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Compile your projects with debug info.  The easiest way is to build using &lt;code class=&quot;highlighter-rouge&quot;&gt;cargo build&lt;/code&gt; and NOT &lt;code class=&quot;highlighter-rouge&quot;&gt;cargo build --release&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Run your application&lt;/li&gt;
  &lt;li&gt;Attach the VS debugger using the ‘Attach…’ feature.  You should be able to find your application in the list.  Once you attach, you can hit pause, set breakpoints, and step as normal.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;debugging-with-vscode-and-msvc&quot;&gt;Debugging with VSCode and MSVC&lt;/h1&gt;

&lt;p&gt;You can also setup vscode as your development and debugging platform.  There are some good tips on how to do this in &lt;a href=&quot;https://www.brycevandyk.com/debug-rust-on-windows-with-visual-studio-code-and-the-msvc-debugger/&quot;&gt;this blog post&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;There is still plenty of room for improvement, but already there’s enough here that we can write, build, and debug Rust applications without too much fuss.  The Rust teams are working to continue to improve the experience of developing in Windows on Rust, but it’s encouraging to see the progress and where it could go in the future.&lt;/p&gt;
</description>
				<pubDate>Tue, 28 Mar 2017 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2017/03/rust-in-windows.html</link>
				<guid isPermaLink="true">http://localhost:4000/2017/03/rust-in-windows.html</guid>
			</item>
		
			<item>
				<title>Rust Language Server Alpha 2 Release</title>
        <description>&lt;p&gt;Today, we’re happy to announce the &lt;a href=&quot;https://github.com/rust-lang-nursery/rls&quot;&gt;second alpha&lt;/a&gt; for the Rust Language Server, a project build to bring high-quality Rust IDE support to any IDE or editor.  This release brings new features, better stability, and an easier installation than the first alpha.&lt;/p&gt;

&lt;h2 id=&quot;support-for-new-project-types&quot;&gt;Support for new project types&lt;/h2&gt;

&lt;p&gt;When a project first starts, it tends to begin life as a library or as an application.  As projects grow, sometimes they take on aspects of both, being both a library and an application that can be executed.&lt;/p&gt;

&lt;p&gt;With alpha 2, we add support for this hybrid project type. Why, you might ask?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/working_on_cargo.png&quot; alt=&quot;Image of Editing Cargo Source&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Editing Cargo’s source code&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;With this change we can now work on Cargo in RLS.  We’re continuing to improve the experience and take on even larger codebases, but it’s promising to see the RLS already able to work with real-world projects, like Cargo.&lt;/p&gt;

&lt;h2 id=&quot;support-for-custom-derive&quot;&gt;Support for custom derive&lt;/h2&gt;

&lt;p&gt;Rust projects that need serialisation often reach for the popular &lt;a href=&quot;https://github.com/serde-rs/serde&quot;&gt;serde&lt;/a&gt; crate to do the work.  With alpha 2, we now support the new serde annotations that are based on the new custom derive capabilities, which is sometimes called “macros 1.1”.&lt;/p&gt;

&lt;h2 id=&quot;support-for-test-code&quot;&gt;Support for test code&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/working_on_tokio.png&quot; alt=&quot;Image of tokio test code&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Editing a test in Tokio&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;With alpha 2, you’ll also be able to get intellisense for the &lt;code class=&quot;highlighter-rouge&quot;&gt;#[test]&lt;/code&gt; functions code in your project, allowing you to seamlessly switch between application and test code without having to change anything in your IDE or project.  We’d like to extend this coverage more in the future.&lt;/p&gt;

&lt;h2 id=&quot;better-stability&quot;&gt;Better stability&lt;/h2&gt;

&lt;p&gt;We’ve fixed dozens of issues in the RLS and related crates.  As a result, the experience is much more solid.  We continue to make stability a focus as we push towards the beta release, but we’re already pleased with the progress since the first alpha.&lt;/p&gt;

&lt;h2 id=&quot;easier-installation&quot;&gt;Easier installation&lt;/h2&gt;

&lt;p&gt;When you look at the &lt;a href=&quot;https://github.com/rust-lang-nursery/rls/blob/master/README.md&quot;&gt;setup instructions&lt;/a&gt; for the RLS now, you’ll see we’ve got it down to four steps.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/working_with_std_docs.png&quot; alt=&quot;Image of hover with std docs&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Standard library documentation on hover&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;We’ve also simplified getting access to the standard library documentation.  In one step, you can get now all the types and documentation for the standard library to your RLS install, allowing you to get the same IDE experience with the standard library that you do with your own code.&lt;/p&gt;

&lt;h2 id=&quot;part-of-the-rust-language-nursery&quot;&gt;Part of the Rust language nursery&lt;/h2&gt;

&lt;p&gt;The RLS, as it’s matured, has proven that it’s ready to take a step closer to being an official Rust project.  Recently, the Rust tools team voted to bring the RLS in the Rust language ‘nursery’, a set of blessed projects that are working towards becoming an officially supported part of the Rust toolchain.  We’re excited to take this step and are committed to continuing to improve it towards the eventual 1.0 release.&lt;/p&gt;

&lt;h1 id=&quot;looking-forward&quot;&gt;Looking forward&lt;/h1&gt;

&lt;p&gt;We’re hopeful this will let more people set up the RLS and get the best experience.  In the future, we hope to transition the RLS over to the rustup tool, which should allow you to add RLS support with one easy command.  This release is a stepping stone to that vision.&lt;/p&gt;

</description>
				<pubDate>Thu, 02 Mar 2017 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2017/03/rls-alpha-2.html</link>
				<guid isPermaLink="true">http://localhost:4000/2017/03/rls-alpha-2.html</guid>
			</item>
		
			<item>
				<title>Announcing Rust Language Server Alpha Release</title>
        <description>&lt;p&gt;Today, we’re announcing the first alpha release of the &lt;a href=&quot;https://github.com/jonathandturner/rls&quot;&gt;Rust Language Server (aka RLS)&lt;/a&gt;.  With this alpha release, this is the first time we’re encouraging early adopters to try on real projects and &lt;a href=&quot;https://github.com/jonathandturner/rls/issues&quot;&gt;send us feedback&lt;/a&gt;.  The RLS has now reached a level of maturity where it should be able to run against most Cargo-based Rust projects.&lt;/p&gt;

&lt;p&gt;But what exactly is the Rust Language Server?&lt;/p&gt;

&lt;h1 id=&quot;in-a-nutshell&quot;&gt;In a nutshell&lt;/h1&gt;

&lt;p&gt;The Rust Language Server is a way of providing editors and IDEs with a range of functionality.  Rather than leaving each editor plugin to have to parse and understand the types in your program and provide you with capabilities like refactoring, the RLS centralizes all this logic and provides it to the editor via a standard &lt;a href=&quot;https://github.com/Microsoft/language-server-protocol&quot;&gt;language server protocol&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In this alpha release, this allows editors and IDEs to share the following capabilities:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;auto-completion&lt;/strong&gt; - allowing you to complete symbols and press ‘.’ for member lists&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;goto definition&lt;/strong&gt; - jump to the definition of a given symbol&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;goto symbol&lt;/strong&gt; - jump to the definition of a symbol you know the name of&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;find all references&lt;/strong&gt; - show all the locations a given symbol is referenced&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;rename/refactor&lt;/strong&gt; - rename all instances of a given symbol to a new name&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;types on hover&lt;/strong&gt; - get the type of a symbol&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;show errors&lt;/strong&gt; - as the user types, get live analysis showing errors as they happen&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The alpha release of the RLS has been run successfully on Linux, Mac, and Windows.&lt;/p&gt;

&lt;h1 id=&quot;how-to-get-started&quot;&gt;How to get started&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;Step 0&lt;/strong&gt;: Make sure you have a recent &lt;a href=&quot;https://www.rust-lang.org/en-US/other-installers.html&quot;&gt;nightly rustc/cargo&lt;/a&gt;, &lt;strong&gt;git&lt;/strong&gt;, &lt;strong&gt;python&lt;/strong&gt;, &lt;strong&gt;node&lt;/strong&gt;, and &lt;strong&gt;cmake&lt;/strong&gt; installed&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Step 1&lt;/strong&gt;: Check out the RLS:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/jonathandturner/rls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Step 2&lt;/strong&gt;: Set up your editor (here we show &lt;a href=&quot;https://github.com/jonathandturner/rls_vscode&quot;&gt;VS Code plugin&lt;/a&gt;)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/jonathandturner/rls_vscode.git
cd rls_vscode
npm install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Step 3&lt;/strong&gt;: Set the RLS_ROOT environment variable to point to where you checked out the RLS:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;export RLS_ROOT=/Source/rls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At this point, you can open the project in VS Code, and when you run the project, it will open a new instance of VS Code with the RLS plugin enabled.  The plugin will build RLS for you.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; the initial analysis of a project can take quite a long time, as metadata is built for all the project dependencies.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note 2:&lt;/strong&gt; analysis currently ignores test code, so you won’t get IDE support for it.  We have a fix for this in the works.&lt;/p&gt;

&lt;h1 id=&quot;how-does-it-work&quot;&gt;How does it work&lt;/h1&gt;

&lt;p&gt;The current version of the RLS is built from a combination of two tools: &lt;a href=&quot;https://github.com/phildawes/racer&quot;&gt;racer&lt;/a&gt; and the &lt;a href=&quot;https://github.com/rust-lang/rust/&quot;&gt;Rust compiler&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Racer allows us to get quick-and-dirty completions, allow you to get completion results in sub-second times.  The trade-off this makes is that the results are not as accurate.&lt;/p&gt;

&lt;p&gt;For tasks that require higher accuracy, like safe refactoring or code navigation, the RLS uses the Rust compiler directly.  Because this type of analysis, while more accurate, takes longer to complete, the RLS will tell the editor when the analysis has successfully completed.&lt;/p&gt;

&lt;h1 id=&quot;help-it-doesnt-work&quot;&gt;Help, it doesn’t work!&lt;/h1&gt;

&lt;p&gt;The RLS is closely tied to particular versions of rustc.  If you’re a rustup user, the DLLs it needs are managed by rustup.  In this case, you’ll get an error like this if you run the rls by hand:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;jturner-23759:rls jturner$ ~/.cargo/bin/rls 
dyld: Library not loaded: @rpath/librustc_driver-6eb85298.dylib
  Referenced from: /Users/jturner/.cargo/bin/rls
  Reason: image not found
Abort trap: 6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you see an error like this, you can run the rls by instead running the command &lt;code class=&quot;highlighter-rouge&quot;&gt;cargo run&lt;/code&gt; in the rls directory.  In the future, as we improve the rls integration with the main Rust tools, this will no longer be an issue.&lt;/p&gt;

&lt;h1 id=&quot;whats-next&quot;&gt;What’s next&lt;/h1&gt;

&lt;p&gt;The RLS is still early in its life and needs to go through a stabilization period before it’s ready for 1.0.  This alpha release marks the first release in this series.&lt;/p&gt;

&lt;p&gt;The next release will be a &lt;a href=&quot;https://github.com/jonathandturner/rls/milestone/3&quot;&gt;second alpha&lt;/a&gt; that includes another set of bugfixes and polish.  This will be followed by a &lt;a href=&quot;https://github.com/jonathandturner/rls/milestone/4&quot;&gt;beta&lt;/a&gt;.  The beta will be the first that will be distributed as a binary and will be much closer to final 1.0 experience in terms of ease-of-install and ease-of-use.&lt;/p&gt;

&lt;h1 id=&quot;i-want-to-help&quot;&gt;I want to help&lt;/h1&gt;

&lt;p&gt;Great!  There are a few ways you can jump in.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Test the RLS&lt;/strong&gt; - use the RLS on your projects and tell us how it feels.  This will help us shake it out and make sure it’s ready for production.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Contribute to RLS:&lt;/strong&gt; - we’d like to add more refactorings, more Rust-centric code navigation (eg find all impls for a type), and possibly more advanced features like lifetime visualization and macro debugging.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Contribute an editor plugin&lt;/strong&gt; - there are already at least &lt;a href=&quot;http://langserver.org/&quot;&gt;six plugins&lt;/a&gt; that follow the Language Server Protocol that the RLS uses, each in its own state of completion.  If you have experience with one of those editors, or if you have a favorite editor you don’t see on the list, you can help us by improving support.  While the RLS will continue to grow and mature, it’s really the plugin where the “rubber meets the road”.  It’s the plugin that helps the developer get the most out of what the RLS provides.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Hack on the compiler&lt;/strong&gt; - ultimately, we want to drive everything in the RLS straight from the compiler.  This means being able to have sub-second response times for interactive completions as well.  The Rust compiler team has already started &lt;a href=&quot;https://github.com/rust-lang/rust/pull/37400&quot;&gt;a series of refactoring&lt;/a&gt; to make the transition to an interactive mode possible.  If you have a background in compilers, IDEs, or static analysis tools and would like to help with this work, you can contact the compiler team at #rustc on irc.mozilla.org or through the &lt;a href=&quot;https://github.com/rust-lang/rust/&quot;&gt;Rust compiler project on GitHub&lt;/a&gt;.&lt;/p&gt;
</description>
				<pubDate>Wed, 18 Jan 2017 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2017/01/rls-alpha-release.html</link>
				<guid isPermaLink="true">http://localhost:4000/2017/01/rls-alpha-release.html</guid>
			</item>
		
			<item>
				<title>Programming Language and Compilers Reading List</title>
        <description>&lt;p&gt;This week, the talented &lt;a href=&quot;https://twitter.com/_lizbaillie&quot;&gt;Liz Baillie&lt;/a&gt; (btw, you should check out her &lt;a href=&quot;https://www.youtube.com/watch?v=Ce6ppwgF4SA&quot;&gt;RustConf talk&lt;/a&gt; if you haven’t already) asked what a good list would be for people who are interested in programming languages and compilers.  I took it as a good excuse to write a blog post with some of my recommendations.  I’m going to attempt to put together a list that doesn’t require a lot of background information, but as these things go, sometimes you’ll have to re-read portions of books to get their benefit.  Also, this isn’t going to be an exhaustive list.  I have never read through an exhaustive reading list before.  Instead, this is definitely biased towards writing real code, getting things working, and learning by doing.  Without further ado, let’s get started!&lt;/p&gt;

&lt;h2 id=&quot;getting-started&quot;&gt;Getting started&lt;/h2&gt;

&lt;p&gt;To kick things off, the first thing to do is to remove any fears we have about thinking that compilers are big complicated things that are only possible by the most heroic of efforts.  Yes, some compilers can be quite complex, but that’s true of many kinds of industrial software.  At its core, though, the compiler just does a few relatively simple things.  So let’s demystify those things.&lt;/p&gt;

&lt;p&gt;First off, let’s make a small compiler.  &lt;a href=&quot;https://twitter.com/thejameskyle&quot;&gt;@thejameskyle&lt;/a&gt; has written a &lt;a href=&quot;https://github.com/thejameskyle/the-super-tiny-compiler/blob/master/the-super-tiny-compiler.js&quot;&gt;cool tutorial&lt;/a&gt; that helps take you through the steps of creating a simple compiler.  Rather than chewing your way through dusty tome after dusty tome before you write your first line of code, my suggestion would be to always have a code editor open at each step of the way.  Play with the ideas as you learn them.&lt;/p&gt;

&lt;p&gt;Alright, next, after we’ve played around with our little compiler and made a few changes and see how our changes affect the output, it’s time to start building up our knowledge.  Fundamentally, how a programming language works can be described in abstractions that build on other abstractions.  If we peel these abstractions away, we’re left with a pretty simple foundation.&lt;/p&gt;

&lt;p&gt;One of the compiler books I liked that help build up these abstractions from a simple base is &lt;a href=&quot;http://wphomes.soic.indiana.edu/jsiek/&quot;&gt;Jeremy Siek&lt;/a&gt;’s &lt;a href=&quot;http://ecee.colorado.edu/ecen4553/fall12/notes.pdf&quot;&gt;compiler course&lt;/a&gt;.  The notes are laid out by chapter, and each chapter introduces a new concept that you’ll add to the compiler.  I enjoyed the hands-on approach, since you can think about how each feature affects each part of the compiler.  It definitely gave me a “oh my god, I can’t believe this works!” moments.  You may also want to adjust to fit your particular style. For example, if something like the assembly piece feels awkward, you could instead output code to a language you’re more familiar with, and work through the other steps of the compiler.&lt;/p&gt;

&lt;p&gt;On the programming language side, probably one of the better survey books I’ve seen is &lt;a href=&quot;https://www.amazon.com/Programming-Language-Pragmatics-Fourth-Michael/dp/0124104096&quot;&gt;Programming Language Pragmatics&lt;/a&gt;.  I’d probably pair it with something like &lt;a href=&quot;https://www.amazon.com/Masterminds-Programming-Conversations-Creators-Languages/dp/0596515170&quot;&gt;Masterminds of Programming&lt;/a&gt; or &lt;a href=&quot;https://www.amazon.com/Coders-Work-Reflections-Craft-Programming/dp/1430219483&quot;&gt;Coders at Work&lt;/a&gt;.  These two books are interviews with programming language creators.  Creating programming languages is definitely equal parts art and engineering, and bouncing between the creators talking about the art and seeing how the engineering works in practice might help see parts of the picture a bit clearer.&lt;/p&gt;

&lt;h2 id=&quot;working-some-problems&quot;&gt;Working some problems&lt;/h2&gt;

&lt;p&gt;I used to hate doing homework.  I mean, who didn’t?  But getting a little older, I realize just how useful doing some of the problems in the book can be.  That’s the time where you actually are solving little puzzles.  And, if you’re lucky, it’s also a great chance to have one of those “a ha!” moments that unlock the next set of secrets.&lt;/p&gt;

&lt;p&gt;If you’re like I was at the time, you’ve heard of “functional programming” about a million times but weren’t sure why anyone should care all that much.  It wasn’t really until I was working through &lt;a href=&quot;https://www.amazon.com/Introduction-Functional-Programming-International-Computing/dp/0134841891&quot;&gt;Introduction to Functional Programming by Bird/Wadler&lt;/a&gt; that things started to click.  The problems in this book are great.  They’re juicy enough that you might have to work at them a little, but you come away with a much better sense of the concepts in each chapter.&lt;/p&gt;

&lt;p&gt;Another book I enjoyed the problems in is the &lt;a href=&quot;https://www.amazon.com/Compilers-Principles-Techniques-Tools-2nd/dp/B009TGD06W&quot;&gt;Dragon book&lt;/a&gt;.  The problem with the Dragon book, though, is that it definitely feels like a stuffy college textbook. That said, it’s worth a skim.  My favorite part about it are the problems in the earlier chapters.  Working through those gave me a bit more confidence I understood the concepts.&lt;/p&gt;

&lt;h2 id=&quot;getting-more-modern&quot;&gt;Getting more modern&lt;/h2&gt;

&lt;p&gt;Perhaps another problem with the well-known dragon book is that the dragon is a bit long in the tooth these days.  Modern techniques have moved on a bit from where they were a few decades ago.&lt;/p&gt;

&lt;p&gt;One thing to check out to see a bit more of how modern compilers work is the &lt;a href=&quot;http://www.aosabook.org/en/llvm.html&quot;&gt;LLVM chapter&lt;/a&gt; of Architecture of Open Source Applications (which may also be a fun read for someone interested in how things work generally).&lt;/p&gt;

&lt;p&gt;I don’t know of a good book on this topic, but there’s a good video that goes into some of the ways that &lt;a href=&quot;https://channel9.msdn.com/Blogs/Seth-Juarez/Anders-Hejlsberg-on-Modern-Compiler-Construction&quot;&gt;modern compilers work differently&lt;/a&gt; than those in the dragon book.&lt;/p&gt;

&lt;h1 id=&quot;for-the-brave&quot;&gt;For the brave&lt;/h1&gt;

&lt;p&gt;When you’ve worked your way to this point and are feeling pretty confident, it’s time to scale to the dizzying heights.  To get there, you’ll inevitably come across &lt;a href=&quot;https://www.amazon.com/Types-Programming-Languages-MIT-Press/dp/B00AJXZ5JE&quot;&gt;Types and Programming Languages&lt;/a&gt; (which you might hear pronounced “tapple”).  I’m not going to mince words, this book is brutal.  It took months and months of working on it to crack it.  I managed to finally get my head around it by methodically using a hands-on approach.  I went &lt;a href=&quot;https://github.com/jonathandturner/Pierce-and-Types&quot;&gt;chapter by chapter&lt;/a&gt; and implemented each new language concept the author introduced.  It took a little while, but it managed to turn the greek symbols into something a bit more concrete.&lt;/p&gt;

&lt;p&gt;At this point you have quite the toolbox.  You’ve written a few small compilers, you’ve seen how language features work and how they interact with each other, you can read academic papers (if need be), and maybe you’ve even made a programming language of your own.  Now you can branch out to almost anywhere.&lt;/p&gt;
</description>
				<pubDate>Sat, 08 Oct 2016 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2016/10/programming-language-and-compilers-reading-list.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/10/programming-language-and-compilers-reading-list.html</guid>
			</item>
		
			<item>
				<title>Helping with the Rust Errors</title>
        <description>&lt;p&gt;I recently did some work with Niko Matsakis on a new compiler error format. You can try them out
by setting &lt;code class=&quot;highlighter-rouge&quot;&gt;RUST_NEW_ERROR_FORMAT=true&lt;/code&gt;. While I put together a
blog post talking about the design for the main blog, I also wanted to open it up for people to come
help us move to the new errors. I’ve split up this post based on background for testers, doc
writers, first-time compiler hackers, and experienced compiler hackers.&lt;/p&gt;

&lt;h1 id=&quot;im-good-at-testing&quot;&gt;I’m good at testing!&lt;/h1&gt;

&lt;p&gt;Perfect! We’ve love your help to come up with tests that show where an error message is confusing or
just plain wrong. If you’d like a little help getting started, there are a bunch of unit tests for
the compiler that all fail intentionally.  You can find these in the rust-lang repo under the
&lt;code class=&quot;highlighter-rouge&quot;&gt;src/test/compile_fail&lt;/code&gt; directory. You’ll notice we’ve already started a
&lt;a href=&quot;https://github.com/rust-lang/rust/issues/35233&quot;&gt;list of errors&lt;/a&gt;, but that list is incomplete. We’d
like to make sure every error code that needs to be updated makes it onto that list so that others
can help update them.&lt;/p&gt;

&lt;p&gt;There are a &lt;em&gt;bunch&lt;/em&gt; of good examples in the &lt;code class=&quot;highlighter-rouge&quot;&gt;compile_fail&lt;/code&gt; directory that explore various error
codes. If you look around there
you can also search for error messages and see if there is already a test. Running this test will
help you see if the error has been updated to the new format.&lt;/p&gt;

&lt;p&gt;If you can find a test case that needs to be updated, file an issue like one of those listed in the
“list of errors” link and cc @jonathandturner. I can help get the error updated to the new format
and tag the error so that others can find it.&lt;/p&gt;

&lt;h1 id=&quot;i-love-writing-docs&quot;&gt;I love writing docs!&lt;/h1&gt;

&lt;p&gt;Good, we need that too. There are a couple places where doc writers can help out, especially if
if you already know a little Rust.&lt;/p&gt;

&lt;p&gt;The first place is helping us write clearer error messages. Even now, and especailly as we move to
the new format, some errors are confusing and sometimes wrong. By helping write clearer error
wording, and by experimenting with new ways to describe the error that is occuring, you can help us
further improve the errors for the next developer.&lt;/p&gt;

&lt;p&gt;If you look at the &lt;a href=&quot;https://github.com/rust-lang/rust/issues/35233&quot;&gt;list of errors&lt;/a&gt; we have so far
you can see what we’re going for. The likely need here is that errors need new labels. The general
style of the new errors:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The error message text. This describes the general problem.&lt;/li&gt;
  &lt;li&gt;The primary error label (the ‘^^^’ underline). This describes the ‘what’ of the error.
It tries to summarize what went wrong in an fairly brief, yet approachable way.&lt;/li&gt;
  &lt;li&gt;The secondary error label (the ‘—’ underline). This describes the ‘why’ of the error. By reading
these the user can see the order of operations that lead to the error.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can also explore the &lt;code class=&quot;highlighter-rouge&quot;&gt;src/test/compile-fail&lt;/code&gt; of the compiler source code for a lot of unit
tests that fail intentionally.  By looking through these, you can help find errors that aren’t
update or that use confusing notes and labels.&lt;/p&gt;

&lt;p&gt;Worth mentioning too, if you’re a writer, also keep a lookout for Stage 2 (which hopefully will be
ready in the coming weeks).  We’ll need help in the future writing helpful extended messages that
describe errors. A great place to jump into help out here and learn about other places doc writers
can help is #rust-docs on irc.mozilla.org.&lt;/p&gt;

&lt;h1 id=&quot;i-know-rust-but-ive-never-hacked-the-compiler&quot;&gt;I know Rust but I’ve never hacked the compiler!&lt;/h1&gt;

&lt;p&gt;Excellent, a first-time compiler hacker. Let’s walk through updating an error
message to the new format. You can look through the
&lt;a href=&quot;https://github.com/rust-lang/rust/issues/35233&quot;&gt;list of errors&lt;/a&gt; to see which ones need updating.&lt;/p&gt;

&lt;p&gt;Once you’ve downloaded the &lt;a href=&quot;https://github.com/rust-lang/rust&quot;&gt;Rust compiler source&lt;/a&gt;, run the
command:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt; python src/bootstrap/bootstrap.py --step libstd --stage 1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This will build “Stage 1” of the compiler. After the first compile, this saves us a &lt;em&gt;bunch&lt;/em&gt; of time
as we test our ideas as it is the minimal compiler rather than a full install.&lt;/p&gt;

&lt;p&gt;Once built, we can run this by hand using (here, I’m on OS X):&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;RUST_NEW_ERROR_FORMAT=true ./build/x86_64-apple-darwin/stage1/bin/rustc &amp;lt;rust file&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Let’s take a look at an error that needs to be updated. You can find a lot of error tests in the
&lt;code class=&quot;highlighter-rouge&quot;&gt;src/test/compile-fail&lt;/code&gt; directory in the compiler source. For this example, I’ll use
&lt;code class=&quot;highlighter-rouge&quot;&gt;src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs&lt;/code&gt;. You can also see which
error this is looking for the EXXXX number, which is the error number.  This one is E0384.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;error[E0384]: re-assignment of immutable variable `x`
  --&amp;gt; src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:50:13
   |
50 |             x += 1;
   |             ^^^^^^
   |
note: prior assignment occurs here
  --&amp;gt; src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:49:10
   |
49 |         [x,_,_] =&amp;gt; {
   |          ^
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can see that’s still using some of the old logic because the underlines don’t have a label. You
can also tell because there’s an attached note is simple enough to be that label. Let’s change
the note to be a label.&lt;/p&gt;

&lt;p&gt;To fix this, we first need to find it in the compiler source. Search tools to the rescue. I tend to
use the error number (and sometimes part of the error message text)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;jturner-23759:rust jturner$ grep -r E0384 src
src/librustc_borrowck/borrowck/mod.rs:            self.tcx.sess, span, E0384,
src/librustc_borrowck/diagnostics.rs:E0384: r##&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We now have the line that creates the error and another that lists it for us. We only need to change
the first of these.&lt;/p&gt;

&lt;p&gt;Looking at the code, sure enough, this is using the older style:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Rust&quot;&gt;struct_span_err!(
    self.tcx.sess, span, E0384,
    &quot;re-assignment of immutable variable `{}`&quot;,
    self.loan_path_to_string(lp))
    .span_note(assign.span, &quot;prior assignment occurs here&quot;)
    .emit();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is a pretty easy fix. We just move from &lt;code class=&quot;highlighter-rouge&quot;&gt;.span_note&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;.span_label&lt;/code&gt; and create a simple
label, like this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Rust&quot;&gt;struct_span_err!(
    self.tcx.sess, span, E0384,
    &quot;re-assignment of immutable variable `{}`&quot;,
    self.loan_path_to_string(lp))
    .span_label(assign.span, &amp;amp;format!(&quot;prior assignment occurs here&quot;))
    .emit();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Once we build and run the new compiler against the error message, we get something where the label
is now part of the main snippet.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;error[E0384]: re-assignment of immutable variable `x`
  --&amp;gt; src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:50:13
   |
49 |         [x,_,_] =&amp;gt; {
   |          - prior assignment occurs here
50 |             x += 1;
   |             ^^^^^^
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That looks a little better, but we’re not done. You’ll notice that we don’t have a label on our
primary span (the ^^^^ part). In the new format, we like to have a label here because it’s one of
the first places your eye will look when you see an error message.&lt;/p&gt;

&lt;p&gt;The second is that the label “prior assignment occurs here”. That feels a little awkward. Since the
label is now part of our code snippet, we can use a better wording. Let’s update the error to look
like this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;error[E0384]: re-assignment of immutable variable `x`
  --&amp;gt; src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:50:13
   |
49 |         [x,_,_] =&amp;gt; {
   |          - first assignment to `x`
50 |             x += 1;
   |             ^^^^^^ re-assignment of immutable variable
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;With a little bit of wording changes and the new primary label, that’s not bad. Of course, as you
get comfortable working with these errors you may find even better wording that’s more clear. Next,
let’s update the code to output this style:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Rust&quot;&gt;struct_span_err!(
    self.tcx.sess, span, E0384,
    &quot;re-assignment of immutable variable `{}`&quot;,
    self.loan_path_to_string(lp))
    .span_label(assign.span, &amp;amp;format!(&quot;first assignment to `{}`&quot;,
                                      self.loan_path_to_string(lp)))
    .span_label(span, &amp;amp;format!(&quot;re-assignment of immutable variable&quot;))
    .emit();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You’ll notice that I reused the same &lt;code class=&quot;highlighter-rouge&quot;&gt;span&lt;/code&gt; that the main error message uses in my new
&lt;code class=&quot;highlighter-rouge&quot;&gt;.span_label&lt;/code&gt;. When I do this, I’m telling the DiagnosticBuilder that this span_label is talking
about the primary span and is the root of what is causing the error. Other labels are secondary
spans because they’re more informational.&lt;/p&gt;

&lt;p&gt;And with that, we’re done! Well, almost. We can’t forget to update the unit tests.&lt;/p&gt;

&lt;p&gt;To quickly check the unit tests that will fail because of our changes, we can run:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python src/bootstrap/bootstrap.py --step check-cfail --stage 1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Compile-fail unit tests are set up with their own annotations that say what labels to expect and
where. As we update errors, we’ll need to also update the corresponding test the new expected
labels.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;failures:
    [compile-fail] compile-fail/asm-out-assign-imm.rs
    [compile-fail] compile-fail/assign-imm-local-twice.rs
    [compile-fail] compile-fail/borrowck/borrowck-insert-during-each.rs
    [compile-fail] compile-fail/liveness-assign-imm-local-in-loop.rs
    [compile-fail] compile-fail/liveness-assign-imm-local-in-op-eq.rs
    [compile-fail] compile-fail/liveness-assign-imm-local-with-init.rs

test result: FAILED. 2381 passed; 6 failed; 15 ignored; 0 measured
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Sure enough, we need to update some of the unit tests. Let’s run these individually. To do this, we
can use:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python src/bootstrap/bootstrap.py --step check-cfail &amp;lt;test name&amp;gt; --stage 1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;like so:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python src/bootstrap/bootstrap.py --step check-cfail asm-out-assign-imm --stage 1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;A fair amount of text comes out, but what we’re interested in is:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;error: /Users/jturner/Source/rust/src/test/compile-fail/asm-out-assign-imm.rs:21: unexpected &quot;note&quot;: 'first assignment to `x`'

error: /Users/jturner/Source/rust/src/test/compile-fail/asm-out-assign-imm.rs:24: unexpected &quot;note&quot;: 're-assignment of immutable variable'

error: /Users/jturner/Source/rust/src/test/compile-fail/asm-out-assign-imm.rs:21: expected note not found: prior assignment occurs here
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;These lines tell us what’s breaking our test case. In this example we see there are notes being
printed that it doesn’t expect and one expected note not found. This makes sense, since we changed
the wording in the error. Let’s go ahead and fix this.&lt;/p&gt;

&lt;p&gt;We can change:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Rust&quot;&gt;    x = 1; //~ NOTE prior assignment occurs here
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Rust&quot;&gt;    x = 1; //~ NOTE first assignment
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;//~&lt;/code&gt; tells the test runner what the expected message is. Here, the message is a NOTE, which
corresponds to the label we changed.&lt;/p&gt;

&lt;p&gt;One more to go. We also added a new label on the primary span. We can insert a new note where
this goes:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Rust&quot;&gt;    unsafe {
        asm!(&quot;mov $1, $0&quot; : &quot;=r&quot;(x) : &quot;r&quot;(5));
        //~^ ERROR re-assignment of immutable variable `x`
        //~| NOTE re-assignment of immutable
        //~| NOTE in this expansion of asm!
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;Notice: we use the &lt;code class=&quot;highlighter-rouge&quot;&gt;//~&lt;/code&gt; when the note is by itself, or &lt;code class=&quot;highlighter-rouge&quot;&gt;//~^&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;//~|&lt;/code&gt; when we’re looking
for multiple notes.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;With that, the test now passes:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;running 1 test
test [compile-fail] compile-fail/asm-out-assign-imm.rs ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;From there we work our way through the errors. Having these error tests failing gives us a chance
to be sure that our fix is good. Here, when we fix
&lt;code class=&quot;highlighter-rouge&quot;&gt;compile-fail/liveness-assign-imm-local-in-loop.rs&lt;/code&gt; we see that in a loop the two spans we’re using
might be the same span if the error happens in a loop. Let’s fix that:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Rust&quot;&gt;let mut err = struct_span_err!(
        self.tcx.sess, span, E0384,
        &quot;re-assignment of immutable variable `{}`&quot;,
        self.loan_path_to_string(lp));
err.span_label(span, &amp;amp;format!(&quot;re-assignment of immutable variable&quot;));
if span != assign.span {
    err.span_label(assign.span, &amp;amp;format!(&quot;first assignment to `{}`&quot;,
                                         self.loan_path_to_string(lp)));
}
err.emit();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;While we’re at it, let’s run a quick tidy to make sure our code conforms to the compiler coding
standard:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python src/bootstrap/bootstrap.py --stage 1 --step check-tidy&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Perfect.  Ship it!&lt;/p&gt;

&lt;p&gt;After we’ve finished with updating the error and the corresponding unit tests, we can create a PR.
When you file the PR, put the message “r? @jonathandturner” at the bottom of your commit
message. This will add me to do the code review.&lt;/p&gt;

&lt;h1 id=&quot;extra-credit&quot;&gt;Extra credit&lt;/h1&gt;

&lt;p&gt;A keen eye will notice that the file we’ve been working on did not show up in our failed tests.
“Why is that?” you might ask. Unit tests that look at the compiler messages work in a few different
ways. Some look at how a test looks (eg, tests in the src/test/ui directory). Others make sure the
content is there, like the unit tests we just fixed. Because there is a lot of content to look for
there are two kinds of “look for content” error test cases. The first kind will only look at the
main message. You can see that this is the case because these test cases have no indicators to look
for NOTE or HELP, only ERROR and WARN.&lt;/p&gt;

&lt;p&gt;Watch what happens if we add a single NOTE to our original test case:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:25: unexpected &quot;note&quot;: 'first assignment to `x`'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:32: unexpected &quot;note&quot;: 'first assignment to `x`'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:33: unexpected &quot;note&quot;: 're-assignment of immutable variable'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:38: unexpected &quot;note&quot;: 'first assignment to `x`'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:39: unexpected &quot;note&quot;: 're-assignment of immutable variable'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:44: unexpected &quot;note&quot;: 'first assignment to `x`'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:45: unexpected &quot;note&quot;: 're-assignment of immutable variable'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:50: unexpected &quot;note&quot;: 'first assignment to `x`'

error: /Users/jturner/Source/rust/src/test/compile-fail/borrowck/borrowck-match-binding-is-assignment.rs:51: unexpected &quot;note&quot;: 're-assignment of immutable variable'
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That’s more like it! Now, we can continue fixing this unit test like we did the others.&lt;/p&gt;

&lt;h2 id=&quot;tips&quot;&gt;Tips&lt;/h2&gt;

&lt;p&gt;As you convert errors you may need to change &lt;code class=&quot;highlighter-rouge&quot;&gt;span_err&lt;/code&gt; (or &lt;code class=&quot;highlighter-rouge&quot;&gt;span_err!&lt;/code&gt;)
to &lt;code class=&quot;highlighter-rouge&quot;&gt;struct_span_err&lt;/code&gt; (or &lt;code class=&quot;highlighter-rouge&quot;&gt;struct_span_err!&lt;/code&gt;), add new .span_labels, or tweak the wording for the
error message to feel right.&lt;/p&gt;

&lt;h1 id=&quot;im-an-experienced-rust-compiler-hacker&quot;&gt;I’m an experienced Rust compiler hacker!&lt;/h1&gt;

&lt;p&gt;Perfect! There are a few hairy things we need to figure out, still, and they may require the keen
eye of a compiler hacker. In the &lt;a href=&quot;https://github.com/rust-lang/rust/issues/35233&quot;&gt;list of errors&lt;/a&gt;
there is a second list of issues for experienced compiler hackers. Additionally, there are areas
that need a bit more work to make them feel like the new messages.&lt;/p&gt;

&lt;h2 id=&quot;region-errors&quot;&gt;Region errors&lt;/h2&gt;

&lt;p&gt;Regions errors currently provide a decent amount of information, but unfortunately to understand it
you currently need a pretty decent understanding of Rust already. Ideally, these messages would get
a similar treatment to the borrowck errors mentioned above.&lt;/p&gt;

&lt;p&gt;Something like:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-term&quot;&gt;error[E0495]: cannot infer an appropriate lifetime for lifetime parameter 'r in function call due to conflicting requirements
  --&amp;gt; src/test/compile-fail/regions-infer-call-3.rs:18:24
   |
18 |     let z = with(|y| { select(x, y) });
   |                        ^^^^^^^^^^^^
   |
note: first, the lifetime cannot outlive the anonymous lifetime #1 defined on the block at 18:21...
  --&amp;gt; src/test/compile-fail/regions-infer-call-3.rs:18:22
   |
18 |     let z = with(|y| { select(x, y) });
   |                      ^^^^^^^^^^^^^^^^
note: ...so that reference does not outlive borrowed content
  --&amp;gt; src/test/compile-fail/regions-infer-call-3.rs:18:34
   |
18 |     let z = with(|y| { select(x, y) });
   |                                  ^
note: but, the lifetime must be valid for the call at 18:12...
  --&amp;gt; src/test/compile-fail/regions-infer-call-3.rs:18:13
   |
18 |     let z = with(|y| { select(x, y) });
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
note: ...so type `&amp;amp;isize` of expression is valid during the expression
  --&amp;gt; src/test/compile-fail/regions-infer-call-3.rs:18:13
   |
18 |     let z = with(|y| { select(x, y) });
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You can see that we say things like “for the call at 18:12” or “on the block at 18:21”. The span
information is available but we’re not really using it well. Instead of saying this, we may want to
calculate the actual span that relates to “the call at 18:12” or the end point of “the block at
18:21”.&lt;/p&gt;

&lt;h2 id=&quot;macro-errors&quot;&gt;Macro errors&lt;/h2&gt;

&lt;p&gt;I’ve started a thread on
&lt;a href=&quot;https://internals.rust-lang.org/t/improving-macro-errors/3809&quot;&gt;improving macro errors&lt;/a&gt; on the Rust
internals list. The hope is to look at a better overall design for macro errors that fits better
with the new error style.&lt;/p&gt;

&lt;h1 id=&quot;thanks&quot;&gt;Thanks!&lt;/h1&gt;

&lt;p&gt;Thanks for wanting to jump in and help! You can find me on irc.mozilla.org as jntrnr and on
github.com as jonathandturner. If you have any questions, please ask. You can also get lots of good
help in #rust-internals and #rustc on irc.mozilla.org.&lt;/p&gt;

</description>
				<pubDate>Wed, 03 Aug 2016 00:00:00 +1200</pubDate>
				<link>http://localhost:4000/2016/08/helping-out-with-rust-errors.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/08/helping-out-with-rust-errors.html</guid>
			</item>
		
			<item>
				<title>Rhai 0.2 release</title>
        <description>&lt;p&gt;I’ve just updated &lt;a href=&quot;https://github.com/jonathandturner/rhai&quot;&gt;Rhai&lt;/a&gt; to 0.2.  This release focuses on improving the interaction between Rhai and Rust.  The result is a cleaner, easier-to-use API.  This new API does mean some API breakages, so you’ll need to update your code to work with 0.2.&lt;/p&gt;

&lt;p&gt;With this release, Rhai also now has arrays as a built-in type.&lt;/p&gt;

&lt;p&gt;You can upgrade/install Rhai from &lt;a href=&quot;https://crates.io/crates/rhai&quot;&gt;cargo&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;api-improvements&quot;&gt;API improvements&lt;/h1&gt;

&lt;p&gt;Rhai 0.2 has a lot of small improvements that give it a much more natural feel in Rust.  The main three areas are function registration, getters/setter helpers, and simpler eval.&lt;/p&gt;

&lt;h2 id=&quot;function-registration&quot;&gt;Function registration&lt;/h2&gt;

&lt;p&gt;Function registration now works through method calls on the engine, and we can infer the expected function type.  The end result is generally much cleaner.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[Before]&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;add&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[Now]&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register_fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;add&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;gettersetter-helpers&quot;&gt;Getter/setter helpers&lt;/h2&gt;

&lt;p&gt;To help cut down on repetition, Rhai 0.2 has a few helpers for working with getters and setters.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[Before]&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;get$x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set_x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;set$x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[Now]&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register_get_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set_x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;simpler-eval&quot;&gt;Simpler eval&lt;/h2&gt;

&lt;p&gt;Eval will now take the expected return type as a type parameter, letting you cut out a few steps.  We’ve also moved to using &amp;amp;str rather than String for eval inputs.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[Before]&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;40 + 2&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.downcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[Now]&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;40 + 2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;new-feature-arrays&quot;&gt;New feature: arrays&lt;/h1&gt;

&lt;p&gt;In addition to the API improvements, Rhai now has a built-in array type.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 

&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;thanks&quot;&gt;Thanks!&lt;/h1&gt;

&lt;p&gt;Thanks for the feedback on Rhai’s first release.  Also, big thanks to &lt;a href=&quot;https://twitter.com/nikomatsakis&quot;&gt;@nikomatsakis&lt;/a&gt;, who gave me a few key pointers on how improve the API.&lt;/p&gt;

&lt;p&gt;Looking forward to hearing from you.&lt;/p&gt;
</description>
				<pubDate>Sat, 26 Mar 2016 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2016/03/rhai-02.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/03/rhai-02.html</guid>
			</item>
		
			<item>
				<title>Embedded scripting in Rust</title>
        <description>&lt;p&gt;For the last few weeks, I’ve been working on an embedded scripting language for Rust, based loosely on &lt;a href=&quot;http://www.chaiscript.com&quot;&gt;ChaiScript&lt;/a&gt; called &lt;a href=&quot;https://github.com/jonathandturner/rhai&quot;&gt;Rhai&lt;/a&gt;.  What’s an embedded scripting language?  While the definition might depend on who you ask, for this post embedded scripting has a few distinct features:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A language that derives all functionality from bindings to the hosting environment&lt;/li&gt;
  &lt;li&gt;As a result, it allows complete control over the API exposed to the script, letting you lock down the script to your application’s needs&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In short, it’s like the little brother of a full scripting language.  It’s smaller, thinner, but still useful for a variety of apps.&lt;/p&gt;

&lt;p&gt;Because I’m using Rust as the host language, I also put a few other constraints on the project to make it work with a wider range of use cases.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;No use of ‘unsafe’ - this lets us script where security is a concern&lt;/li&gt;
  &lt;li&gt;No additional dependencies - keeps our design small&lt;/li&gt;
  &lt;li&gt;Easy-to-use - even being safe and lightweight, it still needs to be easy to get started&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;introducing-rhai&quot;&gt;Introducing: Rhai&lt;/h1&gt;

&lt;p&gt;Let’s take a look at what Rhai looks like, then we’ll break down how it works.&lt;/p&gt;

&lt;h2 id=&quot;hello-world&quot;&gt;Hello world&lt;/h2&gt;

&lt;p&gt;As I mentioned earlier, one of the goals with Rhai was to have minimal setup to get going.  This example is a full “hello world” of scripting that evaluates some script and gives us the result:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;40 + 2&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.downcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
        &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Answer: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// prints 42&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking a little closer.  We pull in the Rhai crate and get the scripting engine into view:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Next, we create an instance of the engine:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally, we call into the engine.  Perhaps the most interesting part here is the roundtrip.  The ‘eval’ method takes a &lt;code class=&quot;highlighter-rouge&quot;&gt;String&lt;/code&gt;, and returns a &lt;code class=&quot;highlighter-rouge&quot;&gt;Result&amp;lt;Box&amp;lt;Any&amp;gt;, EvalAltResult&amp;gt;&lt;/code&gt;.  Because we’re in a scripting context, everything we’re working with is dynamically typed, so as values get passed around, we make liberal use of &lt;code class=&quot;highlighter-rouge&quot;&gt;Box&amp;lt;Any&amp;gt;&lt;/code&gt;.  Here, the expression “40 + 2” is going to evaluated to give us a Box’ed number.  Of course, we can also have errors occur during script execution, so we need to return a Result.&lt;/p&gt;

&lt;p&gt;To go from a Result to the actual numeric value, we have to take a few steps to peel away the layers.  I cheat and use ‘unwrap’ to get through the Result, then the downcast takes us from a &lt;code class=&quot;highlighter-rouge&quot;&gt;Box&amp;lt;Any&amp;gt;&lt;/code&gt; to a &lt;code class=&quot;highlighter-rouge&quot;&gt;Box&amp;lt;i32&amp;gt;&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;40 + 2&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.downcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s it.  We’ve done a full round trip of creating script and then making sense of its output.  The language, at this point, has only basic functionality because we haven’t registered anything the script can use.  So let’s fix that.&lt;/p&gt;

&lt;h2 id=&quot;registering-your-functions&quot;&gt;Registering your functions&lt;/h2&gt;

&lt;p&gt;To make your functions visible to the script, you’ll need to register them with the script engine.  Let’s do the same example, but this time we’ll create an add function in our native code and call it from script:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FnRegister&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;add&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;add(40, 2)&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.downcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
        &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Answer: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// prints 42&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The big change in this example is this line:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;add&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This uses the function registration capability taken from the FnRegister trait that we’ve added to our imports.  It’s a trait implemenented on functions which gives them a register method.  We call the method and pass into it both our engine and the name we want the function to be called in script.  With that, we’re good to go and can call the function.&lt;/p&gt;

&lt;p&gt;Let’s do two more examples so we can see how some of the other details play out.&lt;/p&gt;

&lt;h2 id=&quot;function-overloading&quot;&gt;Function overloading&lt;/h2&gt;

&lt;p&gt;Rhai also has supported for function overloading.  This gives you a way to work with generic functions (like the example below) or to register multiple functions to the same name.  During call resolution, the engine will call these functions and will fall through to the case that matches the types at runtime.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Display&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FnRegister&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;showit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;showit&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;print&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;showit&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;print&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;showit&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;print&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;working-with-custom-types&quot;&gt;Working with custom types&lt;/h2&gt;

&lt;p&gt;Finally, in addition to working with your functions, Rhai also supports working with custom types.  In this example, we introduce a few more features.  First, you can register functions that take a &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;mut&lt;/code&gt; as their first argument.  This allows them to be used as methods in the script.  Next, we register a special getter function.  This lets us read (or write, if we register a setter also) the member directly in script.&lt;/p&gt;

&lt;p&gt;You’ll notice too that we make sure our object is clone-able.  As we’ll talk about in the next section, this ends up being a requirement when working with values in the script engine.  We make sure to register our custom type with the engine to make cloning possible from inside the engine.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;rhai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FnRegister&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;#[derive(Clone)]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.register_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;new_ts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;update&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestStruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;.register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;get$x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 
        &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;var myts = new_ts(); myts.update(); myts.x&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.downcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
        &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;result: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// prints 1001&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;how-it-works&quot;&gt;How it works&lt;/h1&gt;

&lt;p&gt;Let’s take a look at how the scripting engine works.  There may be even better ways to do some of these steps, so I’m eager to hear your feedback.&lt;/p&gt;

&lt;p&gt;Without further ado, let’s jump in.&lt;/p&gt;

&lt;h2 id=&quot;function-resolution&quot;&gt;Function resolution&lt;/h2&gt;

&lt;p&gt;The heart of the system is the function resolver.  In Rhai, all function calls, even all operators like plus and minus, end up going through the resolver.  Yet, it’s a relatively simple piece of code.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;First, find all functions which match the name.  Let’s say ‘foo’&lt;/li&gt;
  &lt;li&gt;For each ‘foo’ function, try to call the function with the argument(s) given&lt;/li&gt;
  &lt;li&gt;If it succeeds, return the resulting value&lt;/li&gt;
  &lt;li&gt;If it fails, continue trying the rest of the functions registered to ‘foo’&lt;/li&gt;
  &lt;li&gt;If none succeed, error&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Going through all the functions which match a name gives us the ability to do overloaded functions.  It also lets us do operators, which themselves are commonly overloaded.&lt;/p&gt;

&lt;h2 id=&quot;function-registration&quot;&gt;Function registration&lt;/h2&gt;

&lt;p&gt;The next piece to working with functions in the engine is registering them.  There are two kinds of functions that are registered: inner functions, or those created inside the script itself, and external functions, or those created in the native code.&lt;/p&gt;

&lt;p&gt;Inner functions are relatively simple.  They work by creating a new scope, adding the function arguments to this new scope, and then executing the function body.&lt;/p&gt;

&lt;p&gt;External functions, if you will, are where the magic happens.  Here, we handle the boundary between the scripting world and the native world.&lt;/p&gt;

&lt;p&gt;Let’s look at how to register a function with one pass-by-value argument &lt;code class=&quot;highlighter-rouge&quot;&gt;fn(T)-&amp;gt;U&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;U&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Clone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FnRegister&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;U&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;        
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wrapped&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EvalAltResult&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 
            &lt;span class=&quot;nn&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inside&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.downcast_mut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inside&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                        &lt;span class=&quot;nb&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;EvalAltResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ErrorFunctionArgMismatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.fns&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.or_insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;FnType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ExternalFn1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wrapped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There’s a lot going on, so let’s break it down:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;U&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Clone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FnRegister&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;U&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As I mentioned earlier, all the types used in the scripting engine need to be clone-able.  We enforce that here as well because we’ll use the clone feature in the call.  We are implementing the FnRegister trait on all functions that match this constraint.&lt;/p&gt;

&lt;p&gt;Next, we are going to create a wrapper function which will call the function given:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wrapped&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EvalAltResult&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All functions of arity one have this internal wrapper function, regardless of if they are pass by value or reference.  This lets us work through a vector of functions easily during function resolution, without having to have too much information out the specific type of the function.&lt;/p&gt;

&lt;p&gt;Next, we have the wrapper function itself:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inside&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.downcast_mut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inside&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;EvalAltResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ErrorFunctionArgMismatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The wrapper is a closure that moves its environment. In this case, it’s moving the function we’re wrapping.  Once it has ownership, we can safely return the wrapper and complete registration.&lt;/p&gt;

&lt;p&gt;Inside the closure, we handle working with the argument.  Because we know the type of the function during registration, we use this knowledge to downcast the argument and give it the proper type.  If this succeeds, we know we have the correct function and can call it.  If it fails, we know this isn’t a match and later can try the next function in the overloads.&lt;/p&gt;

&lt;p&gt;To call the function, since we’re pass by value, we need to take the extra cloning step to get to a value rather than a reference.  This lets us respect the ownership model, albeit at the cost of the clone.&lt;/p&gt;

&lt;p&gt;That’s the heart of how the resolution system works.  Resolution works through each possible match, and registration gives us a wrapper function that can try each function against the types known at compile time.&lt;/p&gt;

&lt;h2 id=&quot;the-rest-of-the-story&quot;&gt;The rest of the story&lt;/h2&gt;

&lt;p&gt;Many of the remaining features built on these two main components.  As mentioned earlier, when you register special get and set functions for fields, the engine will use them when you work with the fields in script.&lt;/p&gt;

&lt;p&gt;The engine will register a set of basic arithmetic and comparison operators to get started with.  These also use the same function resolution mechanism.&lt;/p&gt;

&lt;p&gt;For variables, the engine works by passing a scope stack around.  For lookup, in order to follow the ownership rules (and maintain pass-by-value semantics), we clone variable values when they’re used in an expression.  During assignment, we use a mutable reference to their value in the scope stack so that it can be updated with the right-hand side of the assignment.&lt;/p&gt;

&lt;h1 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h1&gt;

&lt;p&gt;Rhai is still very young and has a bit of growing to do before it’s ready for primetime.  Parsing and error reporting are barebones and don’t have the kind of error recovery you’d expect from more industrial-strength scripting.  There are also a number of convenience features that would be relatively easy to add, like vectors, iterators, for..in.., and so on.&lt;/p&gt;

&lt;p&gt;If you’d like to help out, jump over to the &lt;a href=&quot;https://github.com/jonathandturner/rhai&quot;&gt;GitHub site&lt;/a&gt;.&lt;/p&gt;
</description>
				<pubDate>Mon, 14 Mar 2016 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2016/03/embedded-scripting-in-rust.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/03/embedded-scripting-in-rust.html</guid>
			</item>
		
			<item>
				<title>Going down the rabbit hole with Rust traits</title>
        <description>&lt;p&gt;One of the first things you might notice about Rust, if you come to it from other OOP-style languages, is that Rust separates methods from the data they work on.  You create your &lt;code class=&quot;highlighter-rouge&quot;&gt;struct&lt;/code&gt;, then you &lt;code class=&quot;highlighter-rouge&quot;&gt;impl&lt;/code&gt; a few methods on it later.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Rect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Rect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;area&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.width&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Rect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;area: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.area&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which, to me, seemed slightly awkward at first.  But, as I dug in a little futher, I started asking questions like “Can I do that to existing types?  Even basic types like the String type?”  Indeed you can.  In this post we’ll see some of what’s possible.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Warning: we’re going down a rabbit hole under the influence of the &lt;a href=&quot;https://en.wikipedia.org/wiki/Avenue_Q&quot;&gt;Bad Idea Bears&lt;/a&gt;.  I hope you have your snorkel. :)&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&quot;warming-up&quot;&gt;Warming up&lt;/h1&gt;

&lt;p&gt;We’ve talked a little about the basics already.  In Rust, &lt;code class=&quot;highlighter-rouge&quot;&gt;impl&lt;/code&gt; gives us a way to “add” methods onto types.  But, when we try to do the same thing to &lt;code class=&quot;highlighter-rouge&quot;&gt;String&lt;/code&gt;, we hit a snag:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;my length: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.my_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When we try to compile this, the compiler gives us back an error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mylen.rs:1:1: 3:2 error: cannot define inherent `impl` for a type outside of the crate where the type is defined; define and implement a trait or new type instead [E0116]
mylen.rs:1 impl String {
mylen.rs:2     fn my_len(&amp;amp;self) -&amp;gt; usize { self.len() }
mylen.rs:3 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we can’t &lt;code class=&quot;highlighter-rouge&quot;&gt;impl&lt;/code&gt; for a type outside of… oh wait.  We can do it, so long as we give it a trait to work with.&lt;/p&gt;

&lt;p&gt;Try #2:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;trait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MyLen&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MyLen&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;my_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;my length: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.my_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Woah, that worked!  With that, we peek into the rabbit hole.&lt;/p&gt;

&lt;h1 id=&quot;traits-and-extending-strings&quot;&gt;Traits and extending strings&lt;/h1&gt;

&lt;p&gt;To kick off our explorations, let’s give ourselves an example to use.  Let’s say we want to read in the contents of some file, and we get the filename for that file from the commandline.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;prelude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Wouldn’t it be nice to not mix and match helper functions and methods?  Wouldn’t it read a little nicer to have&lt;code class=&quot;highlighter-rouge&quot;&gt;fname.read_all()&lt;/code&gt;?&lt;/p&gt;

&lt;p&gt;Using the same pattern we used before, this is pretty easy to do.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;trait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReader&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;prelude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;    
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s not bad!  Go get my nth argument, check if we’re good, then read the contents.&lt;/p&gt;

&lt;p&gt;If we could stop ourselves there, we’d be mostly okay.  Our example is still pretty readable, though we might get a few dirty looks from the senior devs in the lunch line.&lt;/p&gt;

&lt;h1 id=&quot;traits-and-extending-option&quot;&gt;Traits and extending Option&lt;/h1&gt;

&lt;p&gt;The Bad Idea Bears call us deeper!  Can we play a little &lt;a href=&quot;https://en.wikipedia.org/wiki/Code_golf&quot;&gt;code “golf”&lt;/a&gt; and squeeze out using &lt;code class=&quot;highlighter-rouge&quot;&gt;Option&lt;/code&gt; in our main?  Sure!  All we need to do is create another &lt;code class=&quot;highlighter-rouge&quot;&gt;impl&lt;/code&gt; for our &lt;code class=&quot;highlighter-rouge&quot;&gt;FileReader&lt;/code&gt; trait, this time for &lt;code class=&quot;highlighter-rouge&quot;&gt;Option&lt;/code&gt; (specifically those that contain Strings):&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;trait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReader&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;prelude&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReader&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ErrorKind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nn&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;ErrorKind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NotFound&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
                &lt;span class=&quot;s&quot;&gt;&quot;No such file or directory&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;
            &lt;span class=&quot;nn&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
    
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yay!  Our main is smaller, and we’ve still managed to maintain at least a &lt;em&gt;little&lt;/em&gt; of our decency.  I mean, we could have used &lt;code class=&quot;highlighter-rouge&quot;&gt;unwrap&lt;/code&gt;, and thrown care to the wind!  Instead, we’re still doing error-checking on our contents. Albeit, our error-checking is kinda smooshed into one place.&lt;/p&gt;

&lt;p&gt;What’s that, Bad Idea Bear?  We should go further?  Okay!&lt;/p&gt;

&lt;h1 id=&quot;traits-and-extending-iterators&quot;&gt;Traits and extending iterators&lt;/h1&gt;

&lt;p&gt;We’re doing a &lt;code class=&quot;highlighter-rouge&quot;&gt;read_all()&lt;/code&gt; on the Option, but what if we go right to the arguments themselves?&lt;/p&gt;

&lt;p&gt;If we poke around in the docs, we find out that args() returns its own type, &lt;a href=&quot;https://doc.rust-lang.org/std/env/struct.Args.html&quot;&gt;Args&lt;/a&gt;. As we read on we see that Args is just an &lt;a href=&quot;https://doc.rust-lang.org/std/iter/trait.Iterator.html&quot;&gt;Iterator&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;That gives us a couple choices.  We can implement a new trait on Args:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;trait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReaderIter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReaderIter&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Args&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;    
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or, we can work with Iterator:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;trait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReaderIter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Iterator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Item&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Sized&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileReaderIter&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Args&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s actually stop here for a minute and look at this one.  We can’t extend Iterator itself.  This is a Good Thing(tm), because if we could, we would end up having to extend countless implementors of Iterator.  Instead, we need to create a new trait that extends from Iterator.&lt;/p&gt;

&lt;p&gt;Next, we need to say what &lt;em&gt;kind&lt;/em&gt; of iterator we can work on.  We know ahead of time that this works on specifically iterators over Strings.  We use the &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;Item=String&amp;gt;&lt;/code&gt; to lock that knowledge in place for the compiler.  This is called an &lt;em&gt;associated type&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;With the new trait and associated type, we’re almost done.  Lastly, we’re doing something a little different this time around.  We have a default implementation inside of the trait instead of just having a prototype.  A default implementation saves you the trouble of having to repeat yourself with each type that implements the trait, if the function is general and trivial.&lt;/p&gt;

&lt;p&gt;The gotcha is that if you use a default implementation that uses &lt;code class=&quot;highlighter-rouge&quot;&gt;self&lt;/code&gt;, the compiler needs to know how big &lt;code class=&quot;highlighter-rouge&quot;&gt;self&lt;/code&gt; will be because it will pass it by-value.  Hence, anything that implements &lt;code class=&quot;highlighter-rouge&quot;&gt;FileReaderIter&lt;/code&gt; must have a known size so the compiler knows how many bytes to copy in when &lt;code class=&quot;highlighter-rouge&quot;&gt;self&lt;/code&gt; is passed to the method.  To ensure this, we add another trait to inherit from, &lt;code class=&quot;highlighter-rouge&quot;&gt;Sized&lt;/code&gt;.  With that, we can say that Args trivially implements this trait.&lt;/p&gt;

&lt;p&gt;Phew, okay, that’s it.  What have we gotten for our effort?&lt;/p&gt;

&lt;p&gt;Both approaches give us this simple main:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At this point we’re far enough down in the rabbit hole that there’s only a pinpoint of light from the entrance.&lt;/p&gt;

&lt;p&gt;Let’s work our way back out, shall we?&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(ps: if you want to follow Bad Idea Bear further, this little nugget is hidden in the Rust docs: both Result and Option implement iterator traits and can be &lt;a href=&quot;https://play.rust-lang.org/?gist=3a890c9c2617c4f1d4f1&amp;amp;version=stable&quot;&gt;used as iterators&lt;/a&gt;)&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&quot;climbing-back-out-of-the-rabbit-hole&quot;&gt;Climbing back out of the rabbit hole&lt;/h1&gt;

&lt;p&gt;Cleverness and readability often trade off with each other.  As we tried to get more clever and squeeze our main down, the end result became more code we had to maintain.  We also increased the amount of ‘magic’ we used, whether it was treating multiple failure styles/cases as one case or the amount of additional capabilities we were giving types like String and Option.&lt;/p&gt;

&lt;p&gt;Rust’s trait system is powerful and clever.  It lets you express the algorithms that are core to your project in a way that can even extend the basic Rust API.  Indeed, that’s one reason why the Rust language and core libraries are intentionally kept pretty small and tidy: so you can make these kind of additions (using eg. modules from &lt;a href=&quot;https://crates.io/&quot;&gt;creates.io&lt;/a&gt;) and the standard library doesn’t get in your way.&lt;/p&gt;

&lt;p&gt;But, as they say, with great power comes great opportunities to follow Bad Idea Bears down rabbit holes.&lt;/p&gt;
</description>
				<pubDate>Tue, 09 Feb 2016 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2016/02/down-the-rabbit-hole-with-traits.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/02/down-the-rabbit-hole-with-traits.html</guid>
			</item>
		
			<item>
				<title>Rust quickie - matching Strings</title>
        <description>&lt;p&gt;In case you find yourself trying to match a &lt;code class=&quot;highlighter-rouge&quot;&gt;String&lt;/code&gt; (perhaps as part of an &lt;code class=&quot;highlighter-rouge&quot;&gt;Option&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;Result&lt;/code&gt;), here’s a little trick.&lt;/p&gt;

&lt;p&gt;As a concrete example, let’s say you’re working with commandline args and want to do different things if it’s there and equal to a special value (like “-“), if it’s any other filename, or if it’s not there.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Input is stdin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Open file: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;None&lt;/span&gt;          &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Open default file /foo/bar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When you try to compile this, you get:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;error: mismatched types:
 expected `collections::string::String`,
    found `&amp;amp;'static str`
(expected struct `collections::string::String`,
    found &amp;amp;-ptr) [E0308]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Bummer! At least on the surface, it looks like we don’t have an easy way to use a string constant like “-“ in our pattern match when what we’re matching against a String.&lt;/p&gt;

&lt;p&gt;Luckily, Rust pattern matching has a way to help us.  We can approximate the above by using &lt;a href=&quot;https://doc.rust-lang.org/book/patterns.html#guards&quot;&gt;match guards&lt;/a&gt;.  Match guards allow us to put an additional &lt;code class=&quot;highlighter-rouge&quot;&gt;if&lt;/code&gt; expression on the pattern.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Input is stdin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Open file: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;None&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Open default file /foo/bar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Match guards give you an extra bit of “juice” to express your logic.&lt;/p&gt;
</description>
				<pubDate>Mon, 08 Feb 2016 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2016/02/rust-quickie-matching-strings.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/02/rust-quickie-matching-strings.html</guid>
			</item>
		
			<item>
				<title>Feature Bias, or Rethinking the Blub Paradox</title>
        <description>&lt;p&gt;I got a lot of great feedback on my previous post &lt;a href=&quot;http://www.jonathanturner.org/2016/01/rust-and-blub-paradox.html&quot;&gt;“Rust and the Blub Paradox”&lt;/a&gt;, which inspired me to write a follow-up.&lt;/p&gt;

&lt;p&gt;In its original formulation, the &lt;a href=&quot;http://www.paulgraham.com/avg.html&quot;&gt;Blub Paradox&lt;/a&gt; is something of a tool for people to feel smug about their favorite language.  I heard a lot of feedback that it feels condescending.  I hadn’t realized that in my mind the Blub Paradox had morphed from its original form into something different.&lt;/p&gt;

&lt;p&gt;In this post, I’d like to break down the Blub Paradox into to what I see as its fundamental observation: that we, as programmers, can have a form of unconscious bias.  I’ll call this &lt;em&gt;Feature Bias&lt;/em&gt; so that we don’t confuse it with Paul’s original idea.&lt;/p&gt;

&lt;h1 id=&quot;there-are-no-universally-better-languages&quot;&gt;There are no universally better languages&lt;/h1&gt;

&lt;p&gt;There is no way to universally sort programming languages on a continuum that is monotonically increasing in awesomeness.  It’s impossible.  Not only are languages too complex to have any kind of universal ranking, they are tools and as tools the value is left to the tool user.  It’s like asking “is pencil better than a paint brush?”  It all depends on what you’re doing and what you’re more comfortable with.&lt;/p&gt;

&lt;p&gt;The types of languages that Paul criticizes in Beating the Averages aren’t universally worse than his favorite languages.  Taking one example, everyone loves to put Java down, but have you ever watched Notch (the creator of Minecraft) &lt;a href=&quot;http://www.twitch.tv/notch/b/302823358&quot;&gt;code in it&lt;/a&gt;?  He seems perfectly content to create with his tool of choice, and he’s certainly capable of doing so.&lt;/p&gt;

&lt;h1 id=&quot;feature-bias-happens-locally-per-feature&quot;&gt;Feature Bias happens locally per feature&lt;/h1&gt;

&lt;p&gt;Rather than trying to sort languages universally, a useful version of the Blub Paradox is a local phenomenon.  It happens on a feature by feature level.&lt;/p&gt;

&lt;p&gt;If a programmer accustomed to working with a feature sees a language that lacks the feature, they can also see the use cases where programmers in that other language might benefit from its use.&lt;/p&gt;

&lt;p&gt;If a programmer who doesn’t use a feature looks at a language with this feature, until they’ve spent time to understand it, they may see the feature as unnecessary.&lt;/p&gt;

&lt;h1 id=&quot;feature-bias-happens-to-most-programmers-even-the-best&quot;&gt;Feature Bias happens to most programmers, even the best&lt;/h1&gt;

&lt;p&gt;As a language PM at Microsoft sitting on a few programming language committees, I saw Feature Bias happen to people from junior developers to famous language designers with decades of industry experience.  The first time a developer sees a new feature, regardless of skill level, there’s a chance they may experience the bias.&lt;/p&gt;

&lt;p&gt;True story: the C# feature LINQ had to ‘bake’ for at least a year with the design committee before enough members saw its value for it to become part of the language.  All the while the champions behind it were trying to educate and get other committee members to give it a chance.&lt;/p&gt;

&lt;h1 id=&quot;features-dont-have-universal-value&quot;&gt;Features don’t have universal value&lt;/h1&gt;

&lt;p&gt;Once the developer puts in the time to understand the feature, they &lt;em&gt;still&lt;/em&gt; may not like it.  That’s not the paradox/bias anymore.  They’ve put the time in to understand the trade-offs, and they don’t feel the trade-offs are worth it.  That’s a totally acceptable response.&lt;/p&gt;

&lt;h1 id=&quot;the-root-of-the-bias&quot;&gt;The root of the bias&lt;/h1&gt;

&lt;p&gt;To summarize, just like other unconscious biases, this bias is pointing out something that’s common for people to experience and they may not realize they’re experiencing it.&lt;/p&gt;

&lt;p&gt;A lot of programmers I know, including myself on a good day, use an understanding of the bias as a way to train ourselves to take time with each feature and work through the knee-jerk “oh this is crap!” reaction.  I definitely still fall victim to it.  Just as with other biases, you have to keep working at it.&lt;/p&gt;

&lt;p&gt;In seeing the responses from people, it’s unfortunate that the original Blub Paradox has been used as a club to beat people with.  It makes it that much harder to see where it can be helpful.  In my experience, it can shine a light on an area that helps us become better programmers and teachers.&lt;/p&gt;

</description>
				<pubDate>Sat, 23 Jan 2016 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2016/01/rethinking-the-blub-paradox.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/01/rethinking-the-blub-paradox.html</guid>
			</item>
		
			<item>
				<title>Rust and the Blub Paradox</title>
        <description>&lt;p&gt;A few weeks ago, I read an &lt;a href=&quot;https://www.quora.com/Which-language-has-the-brightest-future-in-replacement-of-C-between-D-Go-and-Rust-And-Why&quot;&gt;analysis of Rust, D, and Go&lt;/a&gt; by Andrei Alexandrescu.  Andrei, a &lt;a href=&quot;http://www.amazon.com/Modern-Design-Generic-Programming-Patterns/dp/0201704315&quot;&gt;respected member of the C++ community&lt;/a&gt; and a core developer of the &lt;a href=&quot;http://dlang.org/&quot;&gt;D programming language&lt;/a&gt;, took a stab at Rust at the end of his writeup with what seems like a pretty astute observation:&lt;/p&gt;

&lt;p&gt;“Reading any amount of Rust code evokes the joke “friends don’t let friends skip leg day” and the comic imagery of men with hulky torsos resting on skinny legs. Rust puts safe, precise memory management front and center of everything. Unfortunately, that’s seldom the problem domain, which means a large fraction of the thinking and coding are dedicated to essentially a clerical job”&lt;/p&gt;

&lt;p&gt;Having met Andrei and seen a few of his talks, I know that he likes to poke fun.  Still, let’s take the bait.  Is his observation funny because it’s a funny image or is it funny because there’s an underlying truth to what he’s saying?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;EDIT:&lt;/strong&gt; thanks to all the responses to this post, I’ve written a follow-up on &lt;a href=&quot;http://www.jonathanturner.org/2016/01/rethinking-the-blub-paradox.html&quot;&gt;where the Blub Paradox is wrong and where it’s helpful&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;EDIT #2:&lt;/strong&gt; Wow, some people also seem to be taking this article as an attack on Andrei.  Not at all!  Like I said, I’ve chatted with him in person and he’s very much the type that likes to say funny things, whether about himself or the wide array of programming languages.  I just took one of his quotes about Rust as a starting point and had fun with it and looked at what might be weird about Rust coming from other languages.&lt;/p&gt;

&lt;h1 id=&quot;blub-paradox&quot;&gt;Blub paradox&lt;/h1&gt;

&lt;p&gt;Whenever I think about how useful certain language features are, I almost always come back to Paul Graham’s essay &lt;a href=&quot;http://www.paulgraham.com/avg.html&quot;&gt;“Beating the Averages”&lt;/a&gt;.  In it, he observes an interesting phenomenon among programmers he calls “the Blub Paradox”.  To recap for those who haven’t heard of it, the paradox goes something like this: let’s say there’s a programmer using a language called Blub.  Blub falls somewhere in the middle of the programming language pack in terms of capability.  It’s not the lowest, most minimal language nor is it the most powerful.&lt;/p&gt;

&lt;p&gt;When the Blub programmer looks “down” the spectrum of languages, they can easily see that those languages are less expressive than their preferred Blub language.  Unfortunately, when they look “up” the spectrum of languages, they can’t tell they’re looking up.  As Paul puts it:&lt;/p&gt;

&lt;p&gt;“What he sees are merely weird languages. He probably considers them about equivalent in power to Blub, but with all this other hairy stuff thrown in as well. Blub is good enough for him, because he thinks in Blub.”&lt;/p&gt;

&lt;p&gt;When I read that years ago, I remember thinking “wow, that’s pretty astute.”  Little did I know that years later it would become firmly ingrained as part of how I thought about teaching programming as a programming language PM.&lt;/p&gt;

&lt;p&gt;As a programming language PM at Microsoft, I worked on &lt;a href=&quot;http://www.typescriptlang.org&quot;&gt;TypeScript&lt;/a&gt;, a typed version of JavaScript.  Without fail, if I was speaking to an audience of predominantly JavaScript developers, I would get many frowns as I tried to enumerate the advantages of adding a bit of type-checking to JavaScript.  Even if it was optional.  Even if I showed half a dozen powerful advantages.  As Paul notes, it just looked “weird”.  To a JavaScript developer, TypeScript would often just seem like a language that was equally expressive with “hairy” stuff thrown in.&lt;/p&gt;

&lt;p&gt;As I talked to more language PMs, and I met more and more people at conferences, I learned that Paul’s observation was not only accurate, it was also surprisingly universal.  Most programmers will struggle when looking at a new language they don’t use.  Often, they’ll have allergic reactions to features that are foreign. It takes time to work with the features enough to understand why they aren’t just unnecessary ornamenation gumming up the works.&lt;/p&gt;

&lt;p&gt;In short, the Blub Paradox is something that as programmers we actively need to assume we’re falling into and then work to get ourselves out of.&lt;/p&gt;

&lt;p&gt;Let’s do just that.  Let’s look at a few stand-out Rust features and assume these features are weird and unnecessary.  From there, we’ll see if we can work to un-Blub ourselves.&lt;/p&gt;

&lt;h1 id=&quot;weird-feature-1-rust-style-polymorphism&quot;&gt;Weird feature #1: Rust-style polymorphism&lt;/h1&gt;

&lt;p&gt;Let’s make a Rust program that uses a bit of polymorphism to print out two different structs.  I’ll show you the code first, then break it down.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Display&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Formatter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;write!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;(x: {})&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Bar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Display&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Bar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Formatter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;write!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;(x: {}, y: {})&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;print_me&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Value: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Bar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;print_me&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;print_me&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What an eye-full!  There’s polymorphism there, but it doesn’t look anything like OO.  It’s generic, and not only generic, but it has constraints.  And what’s this &lt;code class=&quot;highlighter-rouge&quot;&gt;impl&lt;/code&gt; stuff?&lt;/p&gt;

&lt;p&gt;Let’s break it into parts.  I’m creating two structs to hold our values.  I go a step further and make sure they implement something called &lt;code class=&quot;highlighter-rouge&quot;&gt;fmt::Display&lt;/code&gt;.  In C++, you might overload the « operator for ostream.  The end result is similar in Rust.  After I have this in place, I can call print functions and pass these structs directly.&lt;/p&gt;

&lt;p&gt;With that, we’re half way through the example.&lt;/p&gt;

&lt;p&gt;Next, we have our &lt;code class=&quot;highlighter-rouge&quot;&gt;print_me&lt;/code&gt; function.  This function is generic, and will accept anything so long as what is passed in can do &lt;code class=&quot;highlighter-rouge&quot;&gt;fmt::Display&lt;/code&gt;.  Luckily, we’ve already said how both structs can do just that.&lt;/p&gt;

&lt;p&gt;The rest is straight-forward.  We create a few structs and pass them to &lt;code class=&quot;highlighter-rouge&quot;&gt;print_me&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Phew… that seemed like a bit of work.  And really, that’s how polymorphism starts in Rust.  It’s all with generics.&lt;/p&gt;

&lt;p&gt;Now, let’s switch to C++ for a minute.  Someone using C++, especially a beginner, might not go the generic route at first and might instead opt to use OO-style polymorphism:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;iostream&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Bar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;x: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Bar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;x: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; y: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;print2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;print3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Bar&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;print2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;print3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pretty easy, right?  Okay, here’s a quick quiz for you.  What does the C++ code print?&lt;/p&gt;

&lt;p&gt;If you guessed wrong, don’t worry.  You’re in good company.&lt;/p&gt;

&lt;p&gt;If you guessed right, congrats!  Now, think a minute about how much do you have to understand about C++ to know the answer.  From what I see, you need to understand the stack, how objects are copied, when they are copied, pointers, references, v-tables, and virtual dispatch. Just to do a few simple lines of OO.&lt;/p&gt;

&lt;p&gt;When I first started learning C++, I had a pretty steep hill to climb.  Luckily, &lt;a href=&quot;http://blog2.emptycrate.com/&quot;&gt;my cousin&lt;/a&gt; is an expert C++ programmer and took me under-wing to show me the ropes.  Still, I made tons of beginner mistakes like the one above.  Why?  In part, the hill is steep because of the cognitive load of learning C++.&lt;/p&gt;

&lt;p&gt;Some of that cognitive load is inherent in programming a computer at a system’s level.  You need to understand the stack.  You need to understand how pointers work.  What C++ adds is another layer of complexity around knowing when a value isn’t fully copied and when virtual dispatch is and isn’t used – all without any warning to the user if they do something that is “probably a bad idea(tm)”.&lt;/p&gt;

&lt;p&gt;This isn’t to knock on C++.  Much of Rust is based on keeping the C++ philosophy of low-level efficient abstractions intact.  In fact, you can even write code that’s &lt;a href=&quot;https://gist.github.com/jonathandturner/a182347b763398d8ea4f&quot;&gt;very similar to the Rust example&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;What Rust &lt;em&gt;does&lt;/em&gt; do in this case is to separate inheritance from polymorphism and push you towards genericity from the start.  In doing so, it gets you thinking generically from day #1.  It might seem weird to separate inheritance from polymorphism if you’re used to them being used together.&lt;/p&gt;

&lt;p&gt;That separation gives us one of our first Blub moments: what’s the advantage of separating inheritance and polymorphism?  In fact, does Rust even have inheritance?&lt;/p&gt;

&lt;p&gt;Believe it or not, at least as of Rust 1.5, Rust does not allow inheritance of structs.  Instead, we can grow the functionality of structs from outside them using a feature called ‘traits’.  Traits allow you a way to add methods, require methods, and retrofit datastructures for existing systems.  They’re also allowed to inherit, so one trait can extend another.&lt;/p&gt;

&lt;p&gt;If you poke around in the Rust, you’ll also notice something else.  We don’t have the same issues we had with C++.  There’s no worrying about what gets lost when the function is called or how virtual dispatch works.  In Rust, we’re uniform regardless of the type.  Because of this, a whole class of beginner errors vanish.&lt;/p&gt;

&lt;h1 id=&quot;weird-feature-2-what-no-exceptions&quot;&gt;Weird feature #2: what, no exceptions?&lt;/h1&gt;

&lt;p&gt;While we’re on the subject of things Rust doesn’t have, its next weird feature is that it lacks exceptions.  Isn’t that like going backwards?  How do we talk about errors that only occur sometimes?  How do we bubble out errors so we can handle them in one place?&lt;/p&gt;

&lt;p&gt;Next you’ll be saying I have to learn monads.&lt;/p&gt;

&lt;p&gt;Actually… no, just kidding, you don’t need to learn monads.  Rust’s exception-less programming is a lot more straight-forward.  Here’s an example of what this looks like in practice.  First, examples of what the functions look like:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SystemTime&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;/// Returns the system time corresponding to &quot;now&quot;.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SystemTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;/// Returns an `Err` if `earlier` is later&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;duration_from_earlier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;earlier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SystemTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SystemTimeError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice the &lt;code class=&quot;highlighter-rouge&quot;&gt;now&lt;/code&gt; function returns a SystemTime and doesn’t have any error cases, while &lt;code class=&quot;highlighter-rouge&quot;&gt;duration_from_earlier&lt;/code&gt; does have a Result that can be either a Duration or the error SystemTimeError.  At a glance, you know a function’s success and possible failure cases.&lt;/p&gt;

&lt;p&gt;But all those failure cases are bound to stack up.  Who wants to see them all over the code?  Sure, it’s good to do error checking, but the point of exceptions is to be able to handle them not only locally but also to let them bubble up and handle them in one place.&lt;/p&gt;

&lt;p&gt;Rust lets you do that, too.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Header&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load_metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Metadata&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load_audio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Audio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load_metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Audio&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While it may not look like it at first, the above example uses the “bubbling” style of exceptions.  The trick is in a Rust macro called &lt;code class=&quot;highlighter-rouge&quot;&gt;try!&lt;/code&gt;.  What it does is pretty simple.  It will call a function for you.  If that call returns with a success value, it will hand that to you.  If it instead returns an error, &lt;code class=&quot;highlighter-rouge&quot;&gt;try!&lt;/code&gt; will return from the containing function with that error.&lt;/p&gt;

&lt;p&gt;The end result means that if if &lt;code class=&quot;highlighter-rouge&quot;&gt;load_header&lt;/code&gt; ever has a problem when calling &lt;code class=&quot;highlighter-rouge&quot;&gt;file.read_u32()&lt;/code&gt;, that Error will be returned instead.  If it is, the same thing happens in &lt;code class=&quot;highlighter-rouge&quot;&gt;load_audio&lt;/code&gt;, meaning that it, too, will return the same Error.  And so on, until the calling function finally handles the error case.&lt;/p&gt;

&lt;p&gt;I wrote a &lt;a href=&quot;http://www.jonathanturner.org/2015/11/learning-to-try-things-in-rust.html&quot;&gt;post about &lt;code class=&quot;highlighter-rouge&quot;&gt;try!&lt;/code&gt;&lt;/a&gt;, if you’d like to learn more.&lt;/p&gt;

&lt;h1 id=&quot;weird-feature-3-the-borrow-checker&quot;&gt;Weird feature #3: the borrow-checker&lt;/h1&gt;

&lt;p&gt;You know, it’s funny.  Many people mention the borrow-checker as the first thing about Rust.  Often, they even rank it as &lt;em&gt;the&lt;/em&gt; thing that sets Rust apart.  To Andrei, this is the “hulky torso” part of Rust.  To me, though, the borrow-checker is just another pass in the compiler.  Just like type-checking, it helps catch a level of bugs before they happen at runtime.  That’s it.  It might seem hefty at first, but I’d argue that’s just because it’s different and learning to work with it grows a new muscle as a programmer, not unlike working with a new type system.&lt;/p&gt;

&lt;p&gt;What kinds of bugs does the borrow-checker catch, you ask?&lt;/p&gt;

&lt;h2 id=&quot;use-after-free&quot;&gt;Use-after-free&lt;/h2&gt;

&lt;p&gt;Ah yes, the classic problem of freeing memory and then trying to use it later.  Quite often, this is what makes programs crash with the dreaded “null pointer exception”.&lt;/p&gt;

&lt;p&gt;There are a good handful of C++ best practices to help avoid this (using RAII, preferring references or smart pointers over raw pointers, documenting the ownership in your API docs, etc), which is likely what Andrei referred to as “large fraction of the thinking and coding are dedicated to essentially a clerical job”.  A team of highly trained C++ programmers would see avoiding use-after-free as largely clerical because that’s about what it amounts to – so long as you obey all the best practices, never cheat, and you always only grow the team with more experts.&lt;/p&gt;

&lt;h2 id=&quot;invalid-iterator&quot;&gt;Invalid iterator&lt;/h2&gt;

&lt;p&gt;Ever modify a container you’re iterating over in C++ and then have a random crash later on?  I have.  If you managed to add or remove an item to the container that was enough to force memory reallocation, your iterator has become invalid.&lt;/p&gt;

&lt;p&gt;I don’t often make this error, but I still do from time to time.&lt;/p&gt;

&lt;h2 id=&quot;data-races&quot;&gt;Data races&lt;/h2&gt;

&lt;p&gt;In Rust, data is either shared or mutable.  If it’s mutable, it can’t be shared, so you don’t risk mutating from two threads in a race.  If it’s shared, you can’t mutate, so you can read to your heart’s content from multiple threads.&lt;/p&gt;

&lt;p&gt;If you’re coming from C++, or any other language with a set of good parallel libraries, this is going to feel overly strict to say the least.  Luckily, this isn’t the whole story, but instead the general basis that gives you a simple set of rules to build more abstractions on.  The rest of the story is still young and forming.  There are a growing number of &lt;a href=&quot;http://areweconcurrentyet.com/&quot;&gt;libraries focused on concurrency&lt;/a&gt; that you can follow if you’re interested to learn more.&lt;/p&gt;

&lt;h2 id=&quot;tracking-ownership&quot;&gt;Tracking ownership&lt;/h2&gt;

&lt;p&gt;This may seem a bit redundant, but it’s actually something that C++ struggles with.  I alluded earlier to “documenting the ownership in your API docs”.  The problem is that this information is in a comment rather than the code itself.&lt;/p&gt;

&lt;p&gt;Here’s a scenario: you’re in C++ and you need to call a library that you didn’t write.  Let’s say it’s a C-based library and takes a raw pointer.  Will it delete what you passed in?  Will it take ownership of it and put it into one of its data structures?  Maybe you’re calling into a scripting engine like Ruby.  Then who owns it?&lt;/p&gt;

&lt;p&gt;Rather than reading through docs, Rust lets you verify that your assumptions match reality when it tracks how you are using the API with the borrow-checker.&lt;/p&gt;

&lt;h2 id=&quot;and-more&quot;&gt;And more&lt;/h2&gt;

&lt;p&gt;Borrow checking helps other classes of errors.  For example, it helps improve local reasoning when you’re writing a function because you can safely assume that any mutable values coming in are disjoint and won’t interact with each other when you change them.&lt;/p&gt;

&lt;p&gt;This incidentally also opens the door for additional optimizations because the compiler can ensure that values can never be both aliased and mutable, something that is difficult to do in C-based languages with alias analysis.&lt;/p&gt;

&lt;p&gt;There’s more good info about the borrow checker and classes of errors it prevents in &lt;a href=&quot;https://twitter.com/rustlang/status/689823725219377152&quot;&gt;“You can’t spell trust without Rust”&lt;/a&gt; if you’re interested.&lt;/p&gt;

&lt;h1 id=&quot;weird-feature-4-rules-are-meant-to-be-broken&quot;&gt;Weird feature #4: rules are meant to be broken&lt;/h1&gt;

&lt;p&gt;I’d argue that one of Rust’s strongest suits is that it’s pragmatic.  Most of Rust’s stringent checks can be circumvented using features like &lt;code class=&quot;highlighter-rouge&quot;&gt;unsafe&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;mem::transmute&lt;/code&gt;, and more.  That’s right, don’t like the borrow-checker for your use case?  No problem, turn it off.&lt;/p&gt;

&lt;p&gt;Rust is made to be able to express anything you can do in a C-like systems language.  The advantage of Rust is that it’s much easier to start with safe defaults that can be pushed out of the way when needed.  It’s much more difficult to build safety on top of unsafe language features.&lt;/p&gt;

&lt;p&gt;While Rust lets you pick and choose, it biases towards not letting you shoot your foot off.&lt;/p&gt;

&lt;h1 id=&quot;did-rust-miss-leg-day&quot;&gt;Did Rust miss leg day?&lt;/h1&gt;

&lt;p&gt;Speaking of feet, did Rust miss leg day after all?  Is it lopsided?  Has it been focused on the wrong things?&lt;/p&gt;

&lt;p&gt;Rust is getting stronger, and luckily it has enough safeguards in place to know how to go into the squat without pulling its back.  This part can’t be understated.  The philosophy behind Rust is one of having good fundamentals.  As long as the good fundamentals are there, the language can grow on that foundation.&lt;/p&gt;

&lt;p&gt;But you don’t have to take my word on it.  Like any fix for the Blub Paradox, it comes down to programmers picking up Rust and seeing if the kinds of capabilities Rust gives them allows them to express themselves efficiently and in a way that avoids classes of bugs that distract from the problem at hand.&lt;/p&gt;

&lt;p&gt;It’s natural to think that some features are ornamental when you’re first coming to them.  Time and exposure are the real test.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Special thanks to Yehuda Katz and Jason Turner for reviewing this post and sending me their feedback&lt;/em&gt;&lt;/p&gt;
</description>
				<pubDate>Fri, 22 Jan 2016 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2016/01/rust-and-blub-paradox.html</link>
				<guid isPermaLink="true">http://localhost:4000/2016/01/rust-and-blub-paradox.html</guid>
			</item>
		
			<item>
				<title>Travel log (Maui)</title>
        <description>&lt;p&gt;When I left Seattle, I jokingly told my friend “the first country I’m travelling to is Hawaii”.&lt;/p&gt;

&lt;p&gt;“But it is isn’t a different country,” she replied.&lt;/p&gt;

&lt;p&gt;It is.  Oh it is.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/Maui_1.jpg&quot; alt=&quot;Image of Maui from Kula Lodge&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Looking at Maui from the Kula Lodge&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Having travelled around the United States, I can’t say there are many places even similar to Hawaii.  Or, more precisely, Maui, the island I spent most of my time on this past week.&lt;/p&gt;

&lt;p&gt;To start with many of the views look absolutely, totally fake.  Yes, the above picture was my view at lunch one day.  Only after staying in Maui for a week did I start to get used to the fact that driving around the interior of Maui, at any moment you could turn the corner and see another breath-taking view.&lt;/p&gt;

&lt;p&gt;I don’t know if I could get used to it &lt;em&gt;really&lt;/em&gt;.  Half my shots of the beach or looking out over the mountain look like they’re from a postcard.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/Maui_2.jpg&quot; alt=&quot;Image of Kamaole Beach III&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Kamaole Beach III&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Sure, I guess someone might over time get used to the amazing mixture of volcanic rock, perfect beaches, and mountain views rounded out with gorgeous weather.  Add to that easy access to a wide variety of fresh produce and fish, and you have yourself a quite literal slice of paradise.  It became quickly obvious why Hawaii has its reputation.  It is, quite simply, nothing short of amazing.&lt;/p&gt;

&lt;p&gt;To give it an even more foreign feel, I was greeted by a number of foods and plants I’d never heard of before.  Fruit that tastes like cinnamon (complete with a gritty texture), starfruit, and even the plentyful macadamia nuts used in new ways (like in the crust on Mahi Mahi, for example).&lt;/p&gt;

&lt;p&gt;Speaking of macadamia nuts…&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/Maui_5.jpg&quot; alt=&quot;Image of Spam-flavored Macademia nuts&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Like I said, a variety of foods.  The plants, too, came in all shapes and sizes.  One of the most striking is the Rainbow Eucalyptus.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/Maui_3.jpg&quot; alt=&quot;Image of Rainbow Eucalyptus&quot; /&gt;
&lt;em&gt;Rainbow Eucalyptus at Garden of Eden&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The above picture is from the &lt;a href=&quot;http://mauigardenofeden.com/&quot;&gt;Garden of Eden&lt;/a&gt; on the Road to Hana.  Both the Garden and the Road to Hana are well worth exploring.  The Road is a windy affair that takes you around through some of the various micro-climates as you traverse the island.  My friend and I explored it one day, stopping at the Garden of Eden, a nature reserve that contained many cool varieties of plants, including the Rainbow Eucalyptus above.  In addition, many varieties of bamboo, bananas, flowers of various sorts, and starfruit flourish.&lt;/p&gt;

&lt;p&gt;But you don’t really have to go very far in any direction to get the island experience.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/Maui_4.jpg&quot; alt=&quot;Image of Maui Beach&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Maui, as one may expect being a holiday spot for many, is a great reminder to take things a little slower.  Stop and look at the flowers, enjoy the views, soak in the sun, and rest up for whatever adventure might come along tomorrow.  There’s also a general friendly, caring spirit that people generally strive for called the Aloha Spirit, sharing its name with the famous greeting.  As a sense of goodwill, it carries through the island’s inhabitants and even into &lt;a href=&quot;http://www.uhcc.hawaii.edu/aloha/alohaSpirit.php&quot;&gt;governance&lt;/a&gt;.  Just as important as soaking in the sun is to soak in some of the Aloha while you’re there and take it with you.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/Maui_6.jpg&quot; alt=&quot;Image of rocks spelling Aloha&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I’m looking forward to returning to Hawaii and seeing what else it has to offer.  Like many places, it feels like I just scratched the surface.  What I found was a warm, welcoming place, both in temperature and in vibe.  Highly recommended checking it out.  It’s well-worth the flight.  Just don’t rush too much, or you’ll miss some of the best parts.&lt;/p&gt;

&lt;p&gt;Mahalo for reading!&lt;/p&gt;
</description>
				<pubDate>Tue, 15 Dec 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/12/travel-log-maui.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/12/travel-log-maui.html</guid>
			</item>
		
			<item>
				<title>HandmadeCon 2015</title>
        <description>&lt;p&gt;&lt;img src=&quot;/images/handmade1.jpg&quot; alt=&quot;Image of HandmadeCon 2015 Banner&quot; /&gt;
&lt;em&gt;HandmadeCon 2015, where even the welcome banner is handmade&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Today, I attended &lt;a href=&quot;http://mollyrocket.com/news_0002.html&quot;&gt;HandmadeCon 2015&lt;/a&gt;.  HandmadeCon is the first convention for the &lt;a href=&quot;https://handmadehero.org/&quot;&gt;Handmade Hero&lt;/a&gt; project by Casey Muratori, a game industry gun-for-hire who most recently worked on &lt;a href=&quot;http://the-witness.net/news/&quot;&gt;The Witness&lt;/a&gt;, the follow-up game for Jonathan Blow, the creator of &lt;a href=&quot;http://braid-game.com/&quot;&gt;Braid&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;key-takeaways&quot;&gt;Key takeaways&lt;/h1&gt;

&lt;p&gt;There was a &lt;em&gt;ton&lt;/em&gt; of material in the interviews.  Enough so that I suspect if two people wrote down their takeaways, they might have wildly different lists.  Still, here are the takeaways I had:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Quick iteration is king.  Working towards faster turnaround time is going to deeply impact overall quality.&lt;/li&gt;
  &lt;li&gt;Lock-in fundamental game choices as early as possible.  Examples: game controls for platforming, game speed for open-world.  These impact how you design levels, and any change may cause you to have to redo levels, puzzles, assets, etc.&lt;/li&gt;
  &lt;li&gt;To work in the game industry you need to show both self-motivated passion and curiosity. The rest can be learned.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;format&quot;&gt;Format&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/images/handmade2.jpg&quot; alt=&quot;Image of Casey and Jonathan talking&quot; /&gt;
&lt;em&gt;Casey (right) interviewing Jonathan Blow&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Casey has hand-picked a list of game developers with deep technical experience for the conference.  With each developer, he interviewed them about their strengths and would tease out the key points from the discussion, often drilling in to learn more.  I hadn’t heard of some of the people he’d picked, but I quickly realized he’d hand-selected each for their specific expertise in gaming, whether controls, code layout, networking, design, or ingenuity.&lt;/p&gt;

&lt;h2 id=&quot;tommy-refenes&quot;&gt;Tommy Refenes&lt;/h2&gt;
&lt;h2 id=&quot;super-meat-boy&quot;&gt;&lt;em&gt;Super Meat Boy&lt;/em&gt;&lt;/h2&gt;

&lt;h3 id=&quot;key-quotes&quot;&gt;Key quote(s)&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;“Best way to get the best work out of people is to give people a way to give you the best work”&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;assets-pipeline&quot;&gt;Assets pipeline&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Original asset pipeline used JSFL to output texture files with indexing from the Adobe Flash tools&lt;/li&gt;
  &lt;li&gt;Now he just works with the SWF directly.  He (&lt;em&gt;gasp&lt;/em&gt;) read the SWF manuals.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;movement&quot;&gt;Movement&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Spent three months perfecting controls using a square that jumped around the screen&lt;/li&gt;
  &lt;li&gt;Movement was built on a set of hand-coded equations whose parameters were tweaked until everything felt right.  He offhandedly called these “garbage numbers/equations”&lt;/li&gt;
  &lt;li&gt;Rather than being real-world, everything was based on how it played
    &lt;ul&gt;
      &lt;li&gt;Eg) 200ms of grace time where meat boy sticks to the wall, allowing you to press the other way and then hit the jump button, or vice versa, to initiate a wall jump&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;After the initial controls tuning, they were locked in and did not change for the rest of the development&lt;/li&gt;
  &lt;li&gt;This allowed level design to build on the controls&lt;/li&gt;
  &lt;li&gt;Explored things like analog, but ended up going digital.  Reasons: never want a “half jump” or a slow acceleration&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;testing&quot;&gt;Testing&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Fans are the best testers&lt;/li&gt;
  &lt;li&gt;PC is crazy complex, and you’re bound to bake in some hardware configuration assumptions&lt;/li&gt;
  &lt;li&gt;He’s working on crowd-sourced alpha/beta testing platform that he can ship builds out to specific testers&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;mike-acton&quot;&gt;Mike Acton&lt;/h2&gt;
&lt;h2 id=&quot;insomniac-creators-of-ratchet-and-clank&quot;&gt;&lt;em&gt;Insomniac [creators of Ratchet and Clank]&lt;/em&gt;&lt;/h2&gt;

&lt;h3 id=&quot;key-quotes-1&quot;&gt;Key quote(s)&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;“Adding stuff to the problem does not make the problem simpler”&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;“Everytime I hear ‘I can just optimize at the end’ I want to slap someone”&lt;/em&gt;  Probably a chain of failures lead to this.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;“Capture and visualize”&lt;/em&gt; your data.  Actually look at the data. eg) build tools to look at the spacial queries that developers are running.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;reaction-to-tommy&quot;&gt;Reaction to Tommy&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Mike started off with a few reactions to Tommy’s interview.&lt;/li&gt;
  &lt;li&gt;Tommy’s input style isn’t garbage, it &lt;em&gt;is&lt;/em&gt; real and it fits the input of his movements and output of “Tommy smiles”&lt;/li&gt;
  &lt;li&gt;Doing things that are “real world” may actually just be the wrong answer and move you the wrong direction&lt;/li&gt;
  &lt;li&gt;He whole-heartedly agreed about locking down controls so you can lock down how levels are made&lt;/li&gt;
  &lt;li&gt;On a related note: ovement speed, esp in an open-world game, greatly affect how the engine works because of streaming off disk, etc&lt;/li&gt;
  &lt;li&gt;Read the CPU manuals&lt;/li&gt;
  &lt;li&gt;BTW, docs are seriously important. Doc your own internal formats, too. This is your key input.&lt;/li&gt;
  &lt;li&gt;Also, focus on your own problem and your own game.  Too many indie devs mimicking other frameworks/tools.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;hiring-a-game-developer&quot;&gt;Hiring a game developer&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Main corollary for game developer success: curiosity&lt;/li&gt;
  &lt;li&gt;Demonstrate what you’ve done with your own willpower&lt;/li&gt;
  &lt;li&gt;Learn how to practice, and take practice seriously.  Anything else is an excuse. Your career is one of the most important things in your life, up there with family.&lt;/li&gt;
  &lt;li&gt;Practice with the goal of getting better/faster and solving the problem.  Throw it away rather than keeping it.  If it’s practice, it’s not a project.  You’re honing a skill rather than building a thing.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;pat-wyatt&quot;&gt;Pat Wyatt&lt;/h2&gt;
&lt;h2 id=&quot;guild-wars-diablo-starcraft-and-more&quot;&gt;&lt;em&gt;Guild Wars, Diablo, StarCraft and more&lt;/em&gt;&lt;/h2&gt;

&lt;h3 id=&quot;key-quotes-2&quot;&gt;Key quote(s)&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;“Make your iteration speed as fast as you can, because this will determine the quality of your game”&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;early-network-stacks&quot;&gt;Early network stacks&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Synchronized network models where client and server both had game state and were kept in lock-step&lt;/li&gt;
  &lt;li&gt;Warcraft: RTS are not so twitchy, don’t need to see effect simultaneously&lt;/li&gt;
  &lt;li&gt;Eg) 4 network moves per second, and a move is when you’ve heard from everyone&lt;/li&gt;
  &lt;li&gt;Starcraft similar to Warcraft&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;diablo-on-battlenet&quot;&gt;Diablo on Battle.Net&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Move from singleplayer to real-time multiplayer&lt;/li&gt;
  &lt;li&gt;First idea: Synchronized at first, to help prevent cheating&lt;/li&gt;
  &lt;li&gt;Ideally, network model should be separate from UI data, since one is updated by network, and one by the client, and they may be updated at different times&lt;/li&gt;
  &lt;li&gt;Problem with synchonized client/server: if you don’t do it perfectly, you diverge and it’s hard to debug&lt;/li&gt;
  &lt;li&gt;Diablo written too quickly to do a synchronized version&lt;/li&gt;
  &lt;li&gt;Solution: “Asynchronous loosely-coupled game”&lt;/li&gt;
  &lt;li&gt;Each level has a ‘master’, and the master is the consensus driver for world state for that level&lt;/li&gt;
  &lt;li&gt;Replayable log of state that can be given to a new master if the first one drops out&lt;/li&gt;
  &lt;li&gt;Game host declares who is master for a given level based on who first entered that level&lt;/li&gt;
  &lt;li&gt;State change happens in two steps: “I am attempting to pick up the sword” then master plays through all attempts and break ties&lt;/li&gt;
  &lt;li&gt;DON’T DO A GAME LIKE THIS.  People will cheat.
    &lt;ul&gt;
      &lt;li&gt;Griefers will take advantage&lt;/li&gt;
      &lt;li&gt;Ask yourself: “How will people hack this?” “How will people abuse others?”&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;guild-wars&quot;&gt;Guild Wars&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;All client/server, all TCP&lt;/li&gt;
  &lt;li&gt;Network functionality split across many servers&lt;/li&gt;
  &lt;li&gt;File server: handles versions and creates deltas based on what client has available, compresses, and sends update to client for assets in the manifest&lt;/li&gt;
  &lt;li&gt;Asset ids automatically assigned by perforce full path&lt;/li&gt;
  &lt;li&gt;File servers were put near users because this helps throughput.  Related: tcp window and waiting for ack for each packet&lt;/li&gt;
  &lt;li&gt;Lobby server: authentication and presence.  Arena, instance, etc all controlled through lobby server because you don’t have a persistent connection.  Helps with p2p messages, guild msgs etc, encryption&lt;/li&gt;
  &lt;li&gt;Matchmaking server: will match up servers with capacity with needs of user&lt;/li&gt;
  &lt;li&gt;Using tons of servers allows you scale up and distribute across machines&lt;/li&gt;
  &lt;li&gt;Network code is shared across all servers.  Every server is actually a generic modular server.  It just hotloads the specific module.  eg) lobby server just loads the lobby module&lt;/li&gt;
  &lt;li&gt;Need RPC protocol that supports versioning.  These days, things like &lt;a href=&quot;https://developers.google.com/protocol-buffers/?hl=en&quot;&gt;protocol buffers&lt;/a&gt; would work fine.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;udp-vs-tcp&quot;&gt;UDP vs TCP&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Mobile - UDP works great, since you’re already going to be losing packets&lt;/li&gt;
  &lt;li&gt;MMO - TCP is great because you don’t want to lose packets&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;network-game-states&quot;&gt;Network game states&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Failure is always legal. Eg) can’t load model file, you don’t crash.  Instead you get a white box&lt;/li&gt;
  &lt;li&gt;Server is authoritative and may pull players back to acceptable state.  Also, every client sees their version of the server truth, like the arrow that “bends in space” because target moved&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;best-practices&quot;&gt;Best practices&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Always simulate network jitter and latency, minimum 200ms, so you are always creating robust networking code&lt;/li&gt;
  &lt;li&gt;You will always be hacked
    &lt;ul&gt;
      &lt;li&gt;Deeply understand your interaction model&lt;/li&gt;
      &lt;li&gt;Rate limiting helps prevent abuse&lt;/li&gt;
      &lt;li&gt;Hiding IP addresses so they can’t be targetted for attacks like DDOS&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;hiring-a-game-developer-1&quot;&gt;Hiring a game developer&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Demonstrate passion&lt;/li&gt;
  &lt;li&gt;Read “cracking the coding interview”&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;jonathan-blow&quot;&gt;Jonathan Blow&lt;/h2&gt;
&lt;h2 id=&quot;braid-the-witness&quot;&gt;&lt;em&gt;Braid, The Witness&lt;/em&gt;&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Iteration is king.  More you optimize the less you can modify.&lt;/li&gt;
  &lt;li&gt;Programming for fungibility to allow for faster iteration.&lt;/li&gt;
  &lt;li&gt;Program for a decoupled system, as much as possible.  This includes game mechanics, types of puzzles, etc&lt;/li&gt;
  &lt;li&gt;Doing programming as a game designer, you can more closely point the best way forward in the game design as you know exactly what’s possible&lt;/li&gt;
  &lt;li&gt;Programming as a designer also helps you explore more of the design space than you might otherwise have.  Eg) in Braid the enemies unaffected by your time travel.&lt;/li&gt;
  &lt;li&gt;Good design can often be a search space with a seed value and things that seem like time wasted, but that’s part of the journey.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ron-gilbert&quot;&gt;Ron Gilbert&lt;/h2&gt;
&lt;h2 id=&quot;secret-of-monkey-island-creator-of-scumm&quot;&gt;&lt;em&gt;Secret of Monkey Island, creator of SCUMM&lt;/em&gt;&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;For Maniac Mansion, C64 was hooked to a Unix/Vax machine with hotloading to C64.  This is how they could swap out and do fast iterations&lt;/li&gt;
  &lt;li&gt;To learn how to do an interpreter, he banked out BASIC ROM to RAM and then manipulated it.  Cool hack.&lt;/li&gt;
  &lt;li&gt;For pathfinding, used dijkstra’s algorithm with rectangle shapes.  This evolved over time.&lt;/li&gt;
  &lt;li&gt;Later games used seamlessly stiched-together soundtracks that changed as the player progressed.&lt;/li&gt;
  &lt;li&gt;Cutscenes, which came from Lucasfilm games, were originally hand-scripted.  They had to “cheat” a little so the player couldn’t interrupt the cutscene with their own movement.  Eg) Making the character the player was following appear far enough ahead of the player so that the player couldn’t run in front and interrupt animation&lt;/li&gt;
&lt;/ul&gt;
</description>
				<pubDate>Sat, 05 Dec 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/12/handmadecon-2015.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/12/handmadecon-2015.html</guid>
			</item>
		
			<item>
				<title>Travel log (Blacksburg)</title>
        <description>&lt;p&gt;This is the first of posts detailing my current trip, which will take me around southwest Virginia, Seattle, Hawaii, Australia, New Zealand, Hong Kong, and Japan.&lt;/p&gt;

&lt;p&gt;My first stop was Blacksburg, home of Virginia Tech.  I lived in Blacksburg from 1996 - 2009, so it was both familiar and a little alien, as it hasn’t stood still since I’ve been gone.  Still, a great time to reconnect with friends that I haven’t seen in years.&lt;/p&gt;

&lt;h1 id=&quot;virginia-tech&quot;&gt;Virginia Tech&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/images/library_bridge.jpg&quot; alt=&quot;Image of Virginia Tech&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Torgersen Hall at Virginia Tech&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;It was nice to take a stroll around campus and see all the familiar buildings.  Even new building felt familiar with the use of Hokie Stone, a distinctive limestone taken from the local quarries.&lt;/p&gt;

&lt;p&gt;The students were just coming back from Thanksgiving break, so when I first got here there were very few people around, giving it a ghost town feeling.  Not in a bad way, though.  I found it peaceful and quiet.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/war_memorial.jpg&quot; alt=&quot;Image of War Memorial Chapel&quot; /&gt;
&lt;em&gt;War Memorial Chapel&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When you’re walking around the Tech campus, you can’t help but notice the Burruss Hall building.  It’s a giant building that is both familiar and imposing.  If you’ve seen any brochures about Virginia Tech, it’s likely you’ve already seen it.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/burruss_close.jpg&quot; alt=&quot;Image of Burruss Hall close-up&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Staring up at Burruss Hall&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;If you step back from Burruss Hall and look down, you’ll notice a ring of stones.  This is the memorial for those killed in the &lt;a href=&quot;https://en.wikipedia.org/wiki/Virginia_Tech_shooting&quot;&gt;shootings on April 16, 2007&lt;/a&gt;.  Each stone has a name of someone who was killed that day.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/stones.jpg&quot; alt=&quot;Image of stone in the Virginia Tech shooting memorial&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Rather than feeling overtly sad, the memorial feels more like a place to recognize and pay respect to the lost while at the same time giving the living space to move on and go about their lives.  Still, the losses are felt, and the lost remembered.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/memorial_note.jpg&quot; alt=&quot;Image of note for shooting victim&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;blacksburg&quot;&gt;Blacksburg&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/images/looking_at_blacksburg.jpg&quot; alt=&quot;Image of Blacksburg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Look out at Blackburg from the Virginia Tech library&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Virginia Tech is surrounded by the town of Blacksburg.  It’s a fairly small affair, nestled into the hills of Virginia.  Downtown Blacksburg is only a few streets wide, with a few dozen restaurants and shops packed together before the streets stretch into the neighboring residential areas.&lt;/p&gt;

&lt;p&gt;Because of its relatively small size, the student population inevitably develops a fondness for certain restaurants.  Some of these became institutions that would go on to serve each new batch of students.  One such institution is the Bollo’s cafe and bakery.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/bollos.jpg&quot; alt=&quot;Image of Bollo's coffeeshop with dog&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Bollo’s, a Blacksburg institution (with photogenic dog)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;It was good to see that it’s still around.  As an undergrad student at Virginia Tech, I spent many a night here laughing with friends, going on dates, playing games, and drinking the strongest coffee I’d ever had.  Sorry Seattle, you weren’t my first latte.&lt;/p&gt;

&lt;p&gt;Speaking of Seattle, which is currently being swallowed by the efficient apartment complex, Blacksburg still has lots of great houses in prime locations.  The house I’m staying in is rich with character, created sometime in the early 1900s.  Its heating has been modernized, but it still has the history intact.  In the basement is a shower for the field workers to wash off.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/shower.jpg&quot; alt=&quot;Image of old timey shower in the basement&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It was great to see my Blacksburg friends again.  It felt like taking a slow bath in the familiar before rising to walk off to the unknown.  A perfect way to start the trip.  I can’t wait to see what adventures lie ahead.&lt;/p&gt;
</description>
				<pubDate>Thu, 03 Dec 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/12/travel-log-blacksburg.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/12/travel-log-blacksburg.html</guid>
			</item>
		
			<item>
				<title>Building a simple JIT in Rust</title>
        <description>&lt;p&gt;The other day I threw together a simple Just-In-Time compiler (or JIT, for short), and I thought it’d be fun to show the steps I did.  With this, it should be possible to create a page of executable memory, write some machine code into it, and then treat it like a function call from Rust.&lt;/p&gt;

&lt;p&gt;Let’s get started!  You can grab my &lt;a href=&quot;https://github.com/jonathandturner/rustyjit&quot;&gt;JIT project&lt;/a&gt;, if you want to follow along.  I’ve only tested this in OS X, but it should adaptable for other platforms.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Updated 12/2/2015:&lt;/strong&gt; Thanks to some reader comments, I’ve updated the code below to not use malloc and instead use posix_memalign directly as the allocation step, which avoids leaking memory.&lt;/p&gt;

&lt;h1 id=&quot;creating-executable-memory&quot;&gt;Creating executable memory&lt;/h1&gt;

&lt;p&gt;For our JIT, we’ll need to first allocate the memory that will hold our JIT’ted code.  The most important thing here is to create a block of memory that’s executable so that we can later jump into it, run code, and then return back out.&lt;/p&gt;

&lt;p&gt;To do this, we need a few functions from the standard C library, which we can access through the &lt;code class=&quot;highlighter-rouge&quot;&gt;libc&lt;/code&gt; external module.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;// added to Cargo.toml&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;libc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;0.2.2&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// main.rs&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once we’ve pulled in libc, we need to allocated memory.  Not just any memory, we need to allocate &lt;em&gt;aligned&lt;/em&gt; memory.  Some operating systems, like OS X, require that executable code memory starts at a particular alignment.  For example, that the address is exactly a multiple of 0x1000.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4096&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;c_void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;mem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uninitialized&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;posix_memalign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once allocated, we now have memory we can safely jump to.  Well, almost.  Before we can run code in our newly-allocated memory, we need to enable executing code in this area of memory.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;mprotect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROT_EXEC&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROT_READ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROT_WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we’re ready.  We have something we can write into and then jump into.  Since running JIT code is basically “no man’s land” without any safeguards, it’s easy to get yourself in trouble.  One step that I add is to also fill the memory block with the &lt;code class=&quot;highlighter-rouge&quot;&gt;RET&lt;/code&gt; instruction, which will let us return from our function even if we happen to accidentally run other memory in the block.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;c_void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;c_void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xc3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// prepopulate with 'RET' calls (0xc3)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We’ve allocated our JIT memory, aligned it, set it as executable, and then filled it with the &lt;code class=&quot;highlighter-rouge&quot;&gt;RET&lt;/code&gt; instruction.  We’re ready to write some code into it.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; You’ll notice we don’t explicitly call &lt;code class=&quot;highlighter-rouge&quot;&gt;libc::free()&lt;/code&gt; after we allocate.  For simplicity, we treat the JIT’ed functions we create as long-lived, but a full-blown JIT would likely use better memory hygiene.&lt;/p&gt;

&lt;h1 id=&quot;getting-ready-to-write-our-first-program&quot;&gt;Getting ready to write our first program&lt;/h1&gt;

&lt;p&gt;To write our first JIT program, let’s first make a way to more easily work with our memory.  In its current state, it’s a raw C void* pointer, but this is a bit unweildy as we don’t have a lot of support to work with that in Rust.  To make something that feels more natural, we’ll create a new struct type that will hold our pointer and allow us to create indexing functions for easier access.  This will let us access the memory like &lt;code class=&quot;highlighter-rouge&quot;&gt;m[0] = 0x10&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Let’s create the struct we’ll use:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;//note: allocate 'page' as before&lt;/span&gt;
    
    &lt;span class=&quot;c&quot;&gt;//then, transmute&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;mem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;transmute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We’ve got the JitMemory struct which will hold the memory we’ve allocated, and we use the &lt;code class=&quot;highlighter-rouge&quot;&gt;mem::transmute&lt;/code&gt; call to convert our raw void pointer to a raw u8 pointer, which will be easier to work with in our next step.&lt;/p&gt;

&lt;p&gt;Now that we have the struct, let’s create some indexing functions.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IndexMut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.contents&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_index&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;isize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IndexMut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;index_mut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.contents&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_index&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;isize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With these in place, we can now more easily write instructions into memory.  Before we do, let’s put everything we’d done so far into a constructor for our struct:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num_pages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_pages&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_contents&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;c_void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;mem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uninitialized&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// avoid uninitalized warning&lt;/span&gt;
      &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;posix_memalign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;mprotect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROT_EXEC&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROT_READ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROT_WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;nf&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xc3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// for now, prepopulate with 'RET'&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;mem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;transmute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contents&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;        
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;writing-our-first-jit-program&quot;&gt;Writing our first JIT program&lt;/h1&gt;

&lt;p&gt;With our new constructor and indexing functions in place, we can write our first JIT program.  The simplest “hello world” that I use when doing JIT is a function that takes no parameters and returns a simple value.&lt;/p&gt;

&lt;p&gt;We can do this with two assembly instructions:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;MOV RAX, 0x3  ; move our return value (0x3) into RAX, 
              ; the register in x64 used for return values
RET           ; return from the function call
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Great, now we just need to write this program into our JIT memory.  But wait, we don’t have an assembler :)&lt;/p&gt;

&lt;p&gt;Not to fear, there are plenty of assemblers to get us started.  There are even &lt;a href=&quot;https://defuse.ca/online-x86-assembler.htm&quot;&gt;online assemblers&lt;/a&gt; you can use.  Let’s plug the first line &lt;code class=&quot;highlighter-rouge&quot;&gt;MOV RAX, 0x3&lt;/code&gt; into our online assembler.&lt;/p&gt;

&lt;p&gt;The top line of the result is the raw hex.  This is what we want.  These are the actual bits we’ll be writing into memory for our function: 48C7C003000000&lt;/p&gt;

&lt;p&gt;With these bytes, and the RET instruction we already filled our memory with, we now have our full function.  We can use our indexing functions to write this out:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;JitMemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// allocate a page of memory&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x48&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// mov RAX, 0x3&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xc7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xc0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x03&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;turning-our-memory-into-a-function&quot;&gt;Turning our memory into a function&lt;/h1&gt;

&lt;p&gt;We have an executable block of memory with the code for our function filled in.  The last step is to turn this into a Rust function we can call.  We do this by doing another mem::transmute:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run_jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;i64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JitMemory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;JitMemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x48&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;// mov RAX, 0x3&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xc7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0xc0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x03&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;mem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;transmute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jit&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And with that, after a few handfuls of unsafe calls and transmutes, we have our function.  The only thing left is to call it:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run_jit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fun&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;debugging&quot;&gt;Debugging&lt;/h1&gt;

&lt;p&gt;When working with a JIT, it’s inevitable at some point something will go wrong, and we’ll need to dive into the debugger.  Luckily, Rust works with LLDB out of the box.&lt;/p&gt;

&lt;p&gt;Here are some helpful LLDB commands to get you started:&lt;/p&gt;

&lt;p&gt;Start the JIT in LLDB:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;lldb target/debug/rustyjit&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Set a breakpoint for the line that contains the call into our JIT code:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt; br set -line 64&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Run to our breakpoint:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt; run&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now that we’re about to run our JIT code, there are a few things we can do.&lt;/p&gt;

&lt;p&gt;The first one is to verify the address of our code:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt; p fun&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately, that’s not the most helpful thing in the world.  What we often want is look at the memory behind the function:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt; mem read fun&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This gives us back something like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0x100804000: 48 c7 c0 03 00 00 00 c3 c3 c3 c3 c3 c3 c3 c3 c3  H??....?????????
0x100804010: c3 c3 c3 c3 c3 c3 c3 c3 c3 c3 c3 c3 c3 c3 c3 c3  ????????????????
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s better.  Now we can see if the bytes we expect to be there are in fact there.  If we wanted, we could update memory using &lt;code class=&quot;highlighter-rouge&quot;&gt;mem write&lt;/code&gt; if something was out of place.&lt;/p&gt;

&lt;p&gt;We can also use the built in disassembler to read back out what the asm instructions are for our function:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt; dis -A x64 -s fun&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Finally, we can continue with the program:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt; cont&lt;/code&gt;&lt;/p&gt;

&lt;h1 id=&quot;lots-ahead&quot;&gt;Lots ahead&lt;/h1&gt;

&lt;p&gt;Now that we have a tiny JIT and a way to debug it, the sky is the limit.  Turning source code into machine code is the heart of any compiler, and with these few additional steps that compiler could be made to output code that we can run directly.&lt;/p&gt;

</description>
				<pubDate>Tue, 01 Dec 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/12/building-a-simple-jit-in-rust.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/12/building-a-simple-jit-in-rust.html</guid>
			</item>
		
			<item>
				<title>Porting a C# NES emulator to Rust</title>
        <description>&lt;p&gt;Many years ago, I created a &lt;a href=&quot;http://jturner.tapetrade.net/sharpnes/index.html&quot;&gt;simple NES emulator in C#&lt;/a&gt; using SDL and Mono.  For fun, I wanted to see what it would be like to port that emulator to Rust.  A couple weeks later, after poking on it on and off between packing for a move, I was able to &lt;a href=&quot;https://github.com/jonathandturner/rustynes&quot;&gt;get it working&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://www.jonathanturner.org/images/smb1.png&quot; alt=&quot;Image of Super Mario Bros 1 on emulator&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;what-i-did&quot;&gt;What I did&lt;/h1&gt;

&lt;h2 id=&quot;loading-a-binary-file&quot;&gt;Loading a binary file&lt;/h2&gt;

&lt;p&gt;Loading the types of files commonly used in emulators requires us to work with binary files.  To do so, we need a way of loading the raw data both as just plain bytes and also as numbers.  Rust, by default, comes with a &lt;a href=&quot;https://doc.rust-lang.org/std/fs/struct.File.html&quot;&gt;fairly slim API&lt;/a&gt; for dealing with binary data.  No matter, Rust is also very flexible and allows you to build on additional parts to the API to suit your needs.&lt;/p&gt;

&lt;p&gt;I started there, and built out a few functions that would let me read in the numbers from the file both using big-endian and little-endian.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;trait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BitReader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_be&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BitReader&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_be&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
        &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        
        &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;    
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
        &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        
        &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;    
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once I had the trait, I could import it where I wanted to use these extra read capabilities on File.&lt;/p&gt;

&lt;p&gt;With these extra methods in place, I could plow through the binary file loading with a mix of the File read functionality and the BitReader trait.&lt;/p&gt;

&lt;p&gt;I did notice I used the odd concoction &lt;code class=&quot;highlighter-rouge&quot;&gt;buffer.iter().cloned().collect()&lt;/code&gt; to convert from an array to a Vec of the same contained type:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num_prg_pages&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4096&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;prg_rom&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.cloned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.collect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There may be a more Rust-native way of doing it.  Personally, I think it’d be nice to be able to read directly into a Vec, so you could elide that step.&lt;/p&gt;

&lt;h2 id=&quot;side-by-side-porting&quot;&gt;Side-by-side porting&lt;/h2&gt;

&lt;p&gt;One of the first things I did after I had file loading in place was to start porting over the CPU emulation.  Because I wanted the code to be fairy clean, I opted to not do a literal port.  Instead, I opened two separate editor windows: one for the original C# source, and one for the new Rust source.  Tedious, but I hoped that a port focused on what would fit better with Rust would be less error-prone.&lt;/p&gt;

&lt;p&gt;There’s another reason not to do copy/pasting of code when porting: too many little things needed to be changed to the Rust style. For example, Rust-friendly names often differ from the C# equivalent (eg the ReadChrRom method would need to be read_chr_rom to match Rust naming conventions).  Like-wise, little things that help readability in Rust, like the “no parens around if guards” means that copy/pasted code would need to be touched up.  All told, a minor frustration, but it gave ample time to make the code look a bit cleaner in the transfer so likely a net win.&lt;/p&gt;

&lt;p&gt;Feeling more comfortable with Rust’s use of expressions, I could write code in a more dense way.  For example, here is some code from the ROR or Rotate Right opcode in C#:&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valueholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;bitholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;bitholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	
&lt;span class=&quot;n&quot;&gt;valueholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valueholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;carry_flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;valueholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valueholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;carry_flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bitholder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valueholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0xff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0x0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;zero_flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;zero_flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valueholder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sign_flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sign_flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and here’s what it became in Rust:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x7f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.carry&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.carry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.zero&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.sign&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Some of these changes could have been done in the original C#, but I didn’t notice them at the time.  Still, I think the result Rust is still pretty readable, even though it’s more compact.&lt;/p&gt;

&lt;p&gt;While we’re talking about bit rotation, one of the annoyances I experienced working on bit manipulation code is that Rust is more vigilant about overflow checking.  In hindsight, this is actually a good thing, but coming from languages like C# and JavaScript that are less vigilant, it was a bit of a headache to adjust to.  I ended up doing some of my own bit masks so I didn’t have to worry about it, but I noticed that they’ve added a number of &lt;a href=&quot;https://github.com/brson/rust/blob/relnotes/RELEASES.md#libraries&quot;&gt;“wrapping” operations in Rust 1.4&lt;/a&gt; that allow you to work around the overflow checks.&lt;/p&gt;

&lt;h2 id=&quot;hitting-the-first-ownership-error&quot;&gt;Hitting the first ownership error&lt;/h2&gt;

&lt;p&gt;A few days into the port, I hit my first ownership error.  Here’s a quick rundown of the NES, so you can see why that might be so:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CPU: The CPU :)&lt;/li&gt;
  &lt;li&gt;PPU: The NES’s graphics unit&lt;/li&gt;
  &lt;li&gt;MMU: Not technically not called the MMU, but let’s call it an MMU for our purposes&lt;/li&gt;
  &lt;li&gt;Cart: The program to run&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now that we have the parts, here’s how they talk to each other:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CPU asks the MMU for an instruction, and the CPU may also write back to memory&lt;/li&gt;
  &lt;li&gt;PPU reads memory from the Cart, and can also transfer memory from MMU to graphics memory&lt;/li&gt;
  &lt;li&gt;MMU needs to read information from the Cart and can also read and write from the PPU&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All the subsystems, in essence, need to be able to talk to each other at some level.  Which is exactly how I set up the C# project.  Singleton objects with references to each other.  When I ported over to TypeScript a few years ago, similar idea.&lt;/p&gt;

&lt;p&gt;But in Rust, ownership needs to be clear.  If you call a method, you can’t also pass something you own to that method, like so:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.x&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.x.z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The net result is that I went back to the drawing board and thought long and hard about what was &lt;em&gt;actually&lt;/em&gt; necessary for each component.  After a couple of refactorings, I think I landed on a solution that’s both cleaner and clearer.  Every object has one owner, and I don’t do any ref cells or ref counting.&lt;/p&gt;

&lt;h2 id=&quot;deriving-debug&quot;&gt;Deriving debug&lt;/h2&gt;

&lt;p&gt;There are a few tricks that I loved in Haskell that I wished other languages would pick up.  One of them is the ability to automatically be able to print out objects for you.&lt;/p&gt;

&lt;p&gt;In Rust, you can do this using the ‘derive’ command:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;derive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;//...&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{:?}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By deriving Debug, you have the ability to output a debug format of that structure, which is output using {:?}.&lt;/p&gt;

&lt;p&gt;This is very handy to help bootstrap a project, when you quickly want to look at the contents of what is working so far.  After a while, I found I ended up removing these helpers and putting in my own, customized implementations.&lt;/p&gt;

&lt;h2 id=&quot;sdl&quot;&gt;SDL&lt;/h2&gt;

&lt;p&gt;Using SDL was dead simple.  I used the &lt;a href=&quot;https://github.com/AngryLawyer/rust-sdl2&quot;&gt;SDL2 Rust bindings&lt;/a&gt;.  After a few tries to follow the directions to install SDL2 carefully, I had it working in both Windows and OS X.  After it’s installed, the bindings “just work”.&lt;/p&gt;

&lt;p&gt;I’d never used SDL2 before, but after looking through the &lt;a href=&quot;https://github.com/AngryLawyer/rust-sdl2/tree/master/examples&quot;&gt;examples directory&lt;/a&gt;, especially the texture sample, I was good to go.&lt;/p&gt;

&lt;h1 id=&quot;what-i-didnt-do&quot;&gt;What I didn’t do&lt;/h1&gt;

&lt;h2 id=&quot;chase-crashing-bugs&quot;&gt;Chase crashing bugs&lt;/h2&gt;

&lt;p&gt;After wrestling a few ownership errors, I largely spent my time on correctness.  I ended up having a few hard-to-find issues where I flipped the boolean logic on a check or discovering I forgot to implement a piece of the machine that was required.  After many hours pouring over the code side by side, or looking at the output log, I finally managed to get the outputs similar.&lt;/p&gt;

&lt;p&gt;Just as in the C# and JavaScript versions of the emulator, I didn’t worry about any crashes.  A few times I had an arithmetic overflow or error accessing a vector out of bounds, but those were easy to fix.&lt;/p&gt;

&lt;h2 id=&quot;optimize&quot;&gt;Optimize&lt;/h2&gt;

&lt;p&gt;After I got the emulator working, I let it rip.  The result was something unplayably fast.  Not bad for a first try.&lt;/p&gt;

&lt;p&gt;In hindsight, this isn’t too surprising.  The CPU gets to work directly with the MMU.  Ditto with the MMU and the PPU.  The systems can call functions in each other without any abstraction, VM, or GC.  By default, the core structs sit on the stack.&lt;/p&gt;

&lt;p&gt;Using Rust had nudged me into doing what would have made sense for a decent C-based approach, without the risks.  Of course, it’s not like Rust prevents you from adding in a hefty abstraction layer, but the defaults seem to push you in the right direction.&lt;/p&gt;

&lt;h2 id=&quot;unit-test&quot;&gt;Unit test&lt;/h2&gt;

&lt;p&gt;For this to feel like a real Rust project, though, it needs some tests.  I asked &lt;a href=&quot;https://twitter.com/pcwalton&quot;&gt;Patrick Walton&lt;/a&gt;, the author of probably the &lt;a href=&quot;https://github.com/pcwalton/sprocketnes&quot;&gt;first NES emulator for Rust&lt;/a&gt;, about testing emulators with Rust unit tests, but he didn’t use them for his project either.&lt;/p&gt;

&lt;p&gt;Still, I suspect there’s a way of creating fairly testable, and still performant, parts of the emulator.  For example, opcodes could each have their own unit test if there was a way, possibly with traits, to decouple them from working so closely with the MMU.&lt;/p&gt;

&lt;h2 id=&quot;add-audio-support&quot;&gt;Add audio support&lt;/h2&gt;

&lt;p&gt;In Patrick’s &lt;a href=&quot;https://air.mozilla.org/sprocketnes-practical-systems-programming-in-rust/&quot;&gt;video about his emulator&lt;/a&gt;, he mentions that he took it on to show that Rust can do real-time processing.  For an emulator, that means that the audio is emulated properly and sounds correct.  I haven’t added any audio support, but it would be a fun project at some point.&lt;/p&gt;

&lt;h2 id=&quot;precisely-emulate-the-machine&quot;&gt;Precisely emulate the machine&lt;/h2&gt;

&lt;p&gt;The never-ending rabbit hole for any emulation project is to see just how precisely you can emulate the hardware.  There’s plenty of work here.&lt;/p&gt;

&lt;h1 id=&quot;what-ive-learned&quot;&gt;What I’ve learned&lt;/h1&gt;

&lt;p&gt;I’m getting a little more comfortable with Rust.  Thinking through an ownership refactoring can still take a while, but it’s starting to feel like the hurdle you take on so that you can worry less about safety and performance.  I still have a ways to go before it becomes second nature.&lt;/p&gt;

&lt;p&gt;Cargo shines again, and the SDL bindings were easy to put in place and worked as expected.  No complaints there.&lt;/p&gt;

&lt;p&gt;Feels like I’m still scratching the surface.  There are likely some slick spots to use traits and macros to cut down on the redundancy and coupling, repectively.  But I’m happy with the progress.&lt;/p&gt;
</description>
				<pubDate>Fri, 20 Nov 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/11/porting-csharp-nes-emu-to-rust.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/11/porting-csharp-nes-emu-to-rust.html</guid>
			</item>
		
			<item>
				<title>Steam Machines enter the market</title>
        <description>&lt;p&gt;This week marks the release of the first official &lt;a href=&quot;http://store.steampowered.com/hardware&quot;&gt;Steam Machines&lt;/a&gt;.  For the last five months, I’ve been a proud owner of the &lt;a href=&quot;http://www.alienware.com/landings/alpha/&quot;&gt;Alienware Alpha&lt;/a&gt;, one of the three Steam Machine types now available.  Knowing what could be possible, I’ve been curiously awaiting the official launch.&lt;/p&gt;

&lt;h1 id=&quot;the-plan&quot;&gt;The plan&lt;/h1&gt;

&lt;p&gt;Valve’s motivation for creating the Steam Machine seems pretty straight forward: move to the TV and compete more directly with game consoles.  Currently, that space is shared by the big three: Sony, Microsoft, and Nintendo.  Why not make that the big four instead, with Valve in the mix?&lt;/p&gt;

&lt;p&gt;To get there, Valve has started with three initial devices.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://cdn.akamai.steamstatic.com/steam/apps/353370/header.jpg?t=1447180995&quot; alt=&quot;Image of Steam Controller&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The Steam Controller is a gamepad with two round touchpads and a set of traditional gamepad buttons.  It can be configured to work as a normal gamepad for games with gamepad support.  Alternatively, the touchpads can be used just as touchpads to play games that work with a mouse instead of gamepad.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://cdn.akamai.steamstatic.com/steam/apps/353380/header.jpg?t=1447183971&quot; alt=&quot;Image of Steam Link&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The Steam Link is something of a gaming bridge between the PC and your TV, allowing you to stream games from your PC over to your TV.  At around $50, it’s pretty inexpensive.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://cdn.akamai.steamstatic.com/steam/apps/353390/header.jpg?t=1447197276&quot; alt=&quot;Image of Steam Machine&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Alienware Steam Machine&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Lastly, the Steam Machine.  The Steam Machine itself isn’t actually a thing.  Rather, it’s a PC specification that hardware vendors can build to.  Out of the gate, three hardware vendors have already produced a Steam Machine: Alienware (pictured above), Zotac, and Syber.  Steam Machines also come with a new operating system called &lt;a href=&quot;http://store.steampowered.com/steamos/&quot;&gt;SteamOS&lt;/a&gt;, a form of Linux that’s been optimized for gaming.&lt;/p&gt;

&lt;h1 id=&quot;the-right-plan&quot;&gt;The right plan?&lt;/h1&gt;

&lt;p&gt;Now that we know the plan, is that plan the right plan?  Specifically, does the Steam Machine have a home?&lt;/p&gt;

&lt;p&gt;It’s clear to me that a device like the Steam Machine has value in the market.  It’s smaller than a gaming console, more flexible, and just as powerful.  I’ve spent countless hours gaming, reading news, watching movies, and even programming on mine.  I’ve even stopped using my Playstation 4, opting instead to do all my gaming on the Alpha.&lt;/p&gt;

&lt;p&gt;But as I look at the Steam Machine release this week, I have some concerns.&lt;/p&gt;

&lt;h2 id=&quot;concern-1-no-flagship-steam-machine&quot;&gt;Concern 1: No flagship Steam Machine&lt;/h2&gt;

&lt;p&gt;The console market is notorious for razor-thin margins on release hardware. Traditionally, consoles are often sold as &lt;em&gt;loss leaders&lt;/em&gt; in their early years.  Meaning, they are &lt;a href=&quot;http://www.forbes.com/sites/timworstall/2013/09/06/microsoft-upends-the-economics-of-games-machines-with-xbox-one/&quot;&gt;sold below the manufacturing costs&lt;/a&gt;.  The thought here is the licensing profits from the games bought by initial adopters will help offset the loss.  Once the console becomes embedded in the market, manufacturing improves, and over many, many small iterations, the console itself becomes cheap enough to make a profit.&lt;/p&gt;

&lt;p&gt;Consoles are always, with rare exception, first-party.  This means that the company who built the software stack that the games run on is also the company who owns and sells the hardware.  Nintendo, Microsoft, Sony, and even previous game vendors like Atari and Sega, all made first-party consoles.&lt;/p&gt;

&lt;p&gt;Rather than being first-party, Valve has opted for an approach that’s closer to non-console markets like phones: third-party hardware.  Early software plays like Microsoft with MS-DOS and Windows, and more recent ones like Google’s Android platform are some examples here.  The gist is that the standard platform works against a standard hardware spec. It doesn’t really matter who the vendor of the hardware is, so long as it matches the spec.&lt;/p&gt;

&lt;p&gt;That might look good on paper for Valve.  Since they’re new into the hardware game, why not let the vendors who know what they’re doing do it?&lt;/p&gt;

&lt;p&gt;It’s still a risky play, and, I’d argue, one that’s potentially riskier than partnering with one vendor to create a Steam-branded first-party machine.  Some reasons why:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Third-party vendors can’t afford to sell loss leader machines.&lt;/strong&gt;  This means the machines will necessarily be lower-powered than they could be.  This narrows the performance per $ gap between this batch of Steam Machines and established consoles like Playstation 4 and Xbox One.  Which, in turn, hits customers in the wallet.  While the Steam Machines are cool pieces of technology, they are also spendy pieces of technology.  For example, the Zotac machine is $900 at the time of writing.  At that price, I could buy &lt;strong&gt;3 WiiUs&lt;/strong&gt; -or- &lt;strong&gt;an Xbox One &lt;em&gt;and&lt;/em&gt; a Playstation 4&lt;/strong&gt;, with money left over for games.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Third-party purchase experience is going to be whatever that vendor makes available.&lt;/strong&gt;  For example, this morning when looking at the new Alienware machine I got website errors on the Dell.com site.  Of course, some of this will get better over time, but it’s difficult to see how both a higher price tag and a worse purchasing experience is going to help the Steam Machine brand.&lt;/p&gt;

&lt;p&gt;As an aside, you might think that being third-party would help you create the Steam Machine of your dreams, but as of the time of this writing, you can’t even configure an Alienware machine to use SSD.  For a gaming machine.  No SSD.  What?  If you’re like me, that’s the first thing you’ll want to upgrade.  I asked the Alienware rep over Twitter about it and got:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://www.jonathanturner.org/images/alienware.png&quot; alt=&quot;Image of Alienware blaming lack of consumer choice on SKU complexity&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Again, likely something that will be fixed in time, but not the best initial experience and one that will turn-off some gamers from the Steam Machine idea.&lt;/p&gt;

&lt;p&gt;Lastly, &lt;strong&gt;Valve’s Steam brand is already better than the third-party vendor brands&lt;/strong&gt;.  Steam is &lt;strong&gt;the&lt;/strong&gt; major name in PC gaming today.  Period.  Who is Zotac or Syber?  I honestly have never heard of them.  Why play second fiddle to brands that aren’t as strong as your own?&lt;/p&gt;

&lt;h2 id=&quot;concern-2-steamos&quot;&gt;Concern 2: SteamOS&lt;/h2&gt;

&lt;p&gt;The motivations here also seem straightforward: Valve gets to create a platform that a) they control and can tweak to their hearts content, b) supports a standard set of APIs that other vendors can leverage and is possibly less of a moving target than the competing APIs, and c) is free.&lt;/p&gt;

&lt;p&gt;With c), Valve helps ensure that vendors can cut costs and deliver less-expensive Steam Machines.  But the whole play here is very confusing.&lt;/p&gt;

&lt;p&gt;Remember that a Steam Machine is a whole PC.  Unlike a game console like Playstation 4, these guys can be a full Windows 10 machine if you install Windows on them.  And Windows &lt;em&gt;already&lt;/em&gt; runs Steam.  So, in fact, a Steam Machine with SteamOS is actually a less powerful experience than taking SteamOS off and putting Windows in its place.&lt;/p&gt;

&lt;p&gt;As for the advantages, again it seems like Valve is trying to take a page from the Android playbook.&lt;/p&gt;

&lt;p&gt;Unfortunately, the current market is decidedly different than the market Android found itself in.  With the release of the iPhone, and its rise in the smartphone market, you had a gap created with a lot of phone vendors wanting an iPhone-like experience without an easy way to get it.  By creating a comparable work-alike, many vendors could sign up and build out the Android ecosystem.  Is SteamOS entering a market of hardware vendors looking to enter the game console market?  Having only one major PC brand, Dell, signing on to ship hardware with SteamOS is an indicator this may not be the case.&lt;/p&gt;

&lt;p&gt;Likewise, are game developers scrambling to get onto SteamOS?  Guessing by the size of the game lists, SteamOS has about a fifth the number of titles available for Steam on Windows.  That, by itself, is actually pretty impressive.  But, consoles really live and die on the titles themselves.  Let’s do a quick rundown of my favorite kind of game, RPGs:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Witcher III: &lt;strong&gt;no&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Final Fantasy XIV - A Realm Reborn: &lt;strong&gt;no&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Dark Souls II: &lt;strong&gt;no&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In fact, I struggled to find triple-A RPGs from the last few years that run on SteamOS.  What’s telling is that all three are available on Windows as well on consoles, where they use gamepad support.  In theory, this should be a solid group of games to show off your powerful new platform.&lt;/p&gt;

&lt;p&gt;In fact, Fallout 4, which was also released this week, &lt;strong&gt;does not have SteamOS support&lt;/strong&gt;.  Likely to be one of the biggest games of the year, and it won’t run on Valve’s newly-shipping machines.&lt;/p&gt;

&lt;p&gt;I suspect that the tech-savvy buyers will do exactly what I did when I got my machine: take out the hard drive, put in an SSD, and install Windows.&lt;/p&gt;

&lt;h2 id=&quot;concern-3-partnerships-or-lack-thereof&quot;&gt;Concern 3: Partnerships, or lack thereof&lt;/h2&gt;

&lt;p&gt;Concerns 1 &amp;amp; 2 above could be summarized as “Steam Machine lacks partnerships”.  The more high profile hardware companies competing to create the best Steam Machine, the better the end result.  The more high profile game companies making games for the Steam Machine, the more SteamOS feels like an established platform like Playstation 4 and Xbox One.&lt;/p&gt;

&lt;p&gt;Partnerships are a catch-22.  It’s difficult to get them without first showing that your platform is a big enough draw to support the investment it takes to port a game or build a machine.  Without the partnerships, the platform never grows to that size.&lt;/p&gt;

&lt;h1 id=&quot;road-ahead&quot;&gt;Road ahead&lt;/h1&gt;

&lt;p&gt;It’s too early to say whether or not Valve will be successful.  This release of the Steam Machine is muddied by a confusing story and a lack of partnerships, but there is still time to improve the experience.  When Steam first came out, it had few games and many thought it was a weak idea. It, of course, grew to the giant it is today.&lt;/p&gt;

&lt;p&gt;Like building a game distribution mechanism like Steam, a game console is also a long play.  It takes years and lots of cash to build up a brand in the console market.  Microsoft famously rumored to have spent &lt;a href=&quot;http://venturebeat.com/2011/11/15/the-making-of-the-xbox-part-2/&quot;&gt;north of a billion dollars to establish the first Xbox&lt;/a&gt;.  From outward appearances, Valve is trying to compete with the console on a fraction of that budget.&lt;/p&gt;

&lt;p&gt;Will Valve and its partners have the patience to build their own niche?  Time will tell.&lt;/p&gt;
</description>
				<pubDate>Wed, 11 Nov 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/11/steam-machines.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/11/steam-machines.html</guid>
			</item>
		
			<item>
				<title>Learning to 'try!' things in Rust</title>
        <description>&lt;p&gt;I started learning Rust in earnest a few weeks ago.  Coming from C++, a fair share of the idioms felt right at home.  There was clear memory management and an eye towards lightweight abstractions.&lt;/p&gt;

&lt;p&gt;But when I started looking around for how to do exceptions, I was surprised to find that Rust had none.  In its place were types like this:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;foo_maker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I recognized this style, having come from playing with languages like Haskell, but despite doing some functional programming before I wasn’t entirely sure how to approach it.  At first blush, the Result value seems pretty straightforward, it either returns something of Foo or an io::Error.  We know which one it returns by pattern matching out the value:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;foo_maker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Error: {:?}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// Ooops, we hit an error, tell the user&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Great, you might think, that’s cute.  Well, at least at first.  Real code tends to have a few reads in a row:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_chans&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;samples_per_sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;avg_bytes_per_sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;block_align&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits_per_sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since we’re reading from a file, any of these reads could hit an error.  Perhaps the hard drive dies, or we prematurely hit the end of the file.  Because of that, each function returns a Result that we later have to pattern match to get the value out.  This means we have to pattern match every result.  Yuck.&lt;/p&gt;

&lt;p&gt;If you poke around on the internets, you’ll find a sneaky way around this using &lt;code class=&quot;highlighter-rouge&quot;&gt;.unwrap()&lt;/code&gt;.  The &lt;code class=&quot;highlighter-rouge&quot;&gt;.unwrap()&lt;/code&gt; call does just what it name implies: it unwraps the Result and gives us the value, assuming the result is Ok.  What if it errored with an Err? Well, then the application panics.&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_chans&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;samples_per_sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;avg_bytes_per_sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;block_align&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits_per_sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.unwrap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you felt a cold shiver run down your spine looking at that, good on you :).  Now, let’s talk about how we actually fix this code.&lt;/p&gt;

&lt;h1 id=&quot;do-or-do-not-there-is-a-try&quot;&gt;Do or do not. There is a try!&lt;/h1&gt;

&lt;p&gt;Looking a bit further in Rust examples, I learned about another way to call functions using the &lt;code class=&quot;highlighter-rouge&quot;&gt;try!&lt;/code&gt; macro.  Maybe, I thought, &lt;code class=&quot;highlighter-rouge&quot;&gt;try!&lt;/code&gt; would save us.  So I tried it out:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;foo.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;…and &lt;strong&gt;BOOM&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;std macros&amp;gt;:5:8: 6:42 error: mismatched types:
 expected `()`,
    found `core::result::Result&amp;lt;_, _&amp;gt;`
(expected (),
    found enum `core::result::Result`) [E0308]
&amp;lt;std macros&amp;gt;:5 return $ crate:: result:: Result:: Err (
&amp;lt;std macros&amp;gt;:6 $ crate:: convert:: From:: from ( err ) ) } } )
read_a_file.rs:5:17: 5:44 note: in this expansion of try! (defined in &amp;lt;std macros&amp;gt;)
&amp;lt;std macros&amp;gt;:5:8: 6:42 help: run `rustc --explain E0308` to see a detailed explanation
error: aborting due to previous error
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Okay, seriously?  I feel like I jumped in the Haskell pool after drinking a C++ template error cocktail.  What &lt;em&gt;is&lt;/em&gt; that?&lt;/p&gt;

&lt;p&gt;Luckily after asking around, I was finally able to piece together what was going wrong.  The hint lies in these lines:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; expected `()`,
    found `core::result::Result&amp;lt;_, _&amp;gt;`
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ah, some type mismatch is happening.  Our main function doesn’t return anything, which is the &lt;code class=&quot;highlighter-rouge&quot;&gt;()&lt;/code&gt; in the ‘expected’ above, but &lt;code class=&quot;highlighter-rouge&quot;&gt;try!&lt;/code&gt; only works inside functions that return a &lt;code class=&quot;highlighter-rouge&quot;&gt;Result&lt;/code&gt;.  This might be the first time in my life I’ve ever seen a function in a C-style language that was callable only inside functions of a particular type.&lt;/p&gt;

&lt;p&gt;Shouldn’t be too hard to fix, just put it in a function that returns Result, right?&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;foo.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(())&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;read_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yup, that did it.  Then I promptly closed my editor and walked away.  I mean, this thing just felt &lt;em&gt;alien&lt;/em&gt;.  Unnatural.  Gross.&lt;/p&gt;

&lt;p&gt;What I didn’t realize was that a few weeks later I’d grok the genius in this approach.&lt;/p&gt;

&lt;h2 id=&quot;genius-1---unlike-trycatch-try-is-precise&quot;&gt;Genius #1 - Unlike try/catch, try! is precise&lt;/h2&gt;

&lt;p&gt;Let’s look at a real-life example from a project I’m working on:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_pages&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_u8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pages&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num_pages&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4096&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
      
      &lt;span class=&quot;n&quot;&gt;pages&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.cloned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.collect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It may take your eyes a minute to adjust to the new syntax, but knowing what we know, we can look at the code above and know exactly which functions might give us errors.  The &lt;code class=&quot;highlighter-rouge&quot;&gt;try!()&lt;/code&gt; call even works on calls that are part of an expression, like &lt;code class=&quot;highlighter-rouge&quot;&gt;try!(f.read_u8()) * 4&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Compare this to traditional try/catch blocks and how they tend to get put around whole sections of code when in reality only parts of the code blocks may throw exceptions.  The end result is code that’s very clear and doesn’t muddy exceptional code and value-based code together.&lt;/p&gt;

&lt;h2 id=&quot;genius-2---feels-like-exceptions&quot;&gt;Genius #2 - Feels like exceptions&lt;/h2&gt;

&lt;p&gt;With this little bit of syntax, we get something that is value-based, but still feels like exceptions.&lt;/p&gt;

&lt;p&gt;Let’s say your task is to write code that will load a variety of audio file formats.  In each audio format loader, you have various subsections that get loaded (eg, a header, a metadata chunk, a chunk of audio data, etc).  It’d be great if you could create specialized functions for each.  If there are any errors, you just want to bubble that back out to the original caller loading the file.  The resulting code may look something like:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Header&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load_metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Metadata&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.read_u32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load_audio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Audio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;load_metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Audio&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can refactor our file loading into helper functions, and we continue to use the same familiar &lt;code class=&quot;highlighter-rouge&quot;&gt;try!&lt;/code&gt; pattern.  How does this work?  The trick is that all the Results agree that &lt;code class=&quot;highlighter-rouge&quot;&gt;io::Error&lt;/code&gt; is the error case.  If one of my helper functions hits a bad read and has to return an error, that error naturally bubbles all the way out without calling any additional code.&lt;/p&gt;

&lt;p&gt;The end result is that we have precise syntax that is transparent about errors at every layer, stays pretty lightweight, and gives us the familiar “bubble out” feel of languages with exceptions.&lt;/p&gt;

&lt;h1 id=&quot;trade-offs&quot;&gt;Trade-offs&lt;/h1&gt;

&lt;p&gt;Of course, there are trade-offs.  We end up repeating &lt;code class=&quot;highlighter-rouge&quot;&gt;try!()&lt;/code&gt; in places we might have just wrapped in one big try/catch block.  For example, the fix to our earlier use case might look like this:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_chans&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;samples_per_sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;avg_bytes_per_sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read_u32_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;block_align&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits_per_sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;try!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read_u16_le&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Personally, I’m happy making the trade-off for the added precision.&lt;/p&gt;

&lt;p&gt;We also saw another trade-off earlier.  If you use &lt;code class=&quot;highlighter-rouge&quot;&gt;try!()&lt;/code&gt; in a function that doesn’t return a Result, you get an incomprehensible error message.  But once you know what’s going on, you can use it with confidence.&lt;/p&gt;
</description>
				<pubDate>Wed, 04 Nov 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/11/learning-to-try-things-in-rust.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/11/learning-to-try-things-in-rust.html</guid>
			</item>
		
			<item>
				<title>Telling the truth in code, function signatures and transparency</title>
        <description>&lt;p&gt;When people talk about reasons to use a type system, there are always a couple usual suspects: error checking, documentation, and if you’re an IDE person like me, tooling/editor tricks that use type information, like auto-complete.&lt;/p&gt;

&lt;p&gt;But there’s another aspect to the types of function signatures that’s related to documentation but is perhaps stands on its own: transparency.&lt;/p&gt;

&lt;h1 id=&quot;what-is-transparency&quot;&gt;What is transparency?&lt;/h1&gt;

&lt;p&gt;For this post, transparency helps us answer a few questions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;What does this function require?&lt;/li&gt;
  &lt;li&gt;What does this function return?&lt;/li&gt;
  &lt;li&gt;What is this function going to do with what I give it?
    &lt;ul&gt;
      &lt;li&gt;Can it modify it?&lt;/li&gt;
      &lt;li&gt;Can it delete it?&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Can this function fail?  If so, how?&lt;/li&gt;
  &lt;li&gt;Does this function do anything besides use its value?
    &lt;ul&gt;
      &lt;li&gt;ie) does this function “change the world” in some way?&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;why-is-transparency-important&quot;&gt;Why is transparency important?&lt;/h1&gt;

&lt;p&gt;A way most of us can relate to transparency is in the relationships you have in your life.  When you’re not transparent with another person – keeping all of your thoughts to yourself, never saying when you’re angry, etc – how does the other person ever know how to react to you?&lt;/p&gt;

&lt;p&gt;Transparency in code works similarly.  When a function is transparent, you know what you need to do when the function is called, and you know how to react when the function is called.  Let’s look at a few examples.  In each example, we’re going to talk about a function that takes in an employee name and writes that name to a file. 
Examples&lt;/p&gt;

&lt;h2 id=&quot;python&quot;&gt;Python&lt;/h2&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;writeToFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# write out to the file&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We’ll start with the simplest form of transparency: minimal transparency.  Looking at what we have it’s tempting to say we don’t know anything at all, but that’s not quite true.  We do know the function name and that it takes a single parameter.&lt;/p&gt;

&lt;p&gt;Things we don’t know:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;What kind of thing does it take?&lt;/li&gt;
  &lt;li&gt;Can it modify the thing we give it?&lt;/li&gt;
  &lt;li&gt;Can it delete what we give it?&lt;/li&gt;
  &lt;li&gt;Does it return anything?&lt;/li&gt;
  &lt;li&gt;Does it throw any exceptions?&lt;/li&gt;
  &lt;li&gt;Does it have any permanent effect on our system
    &lt;ul&gt;
      &lt;li&gt;eg) send files over the network, add to a database, launch the missiles?&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Without this knowledge, we resort to aggressively testing, commenting, and using naming and coding conventions to get the idea across.&lt;/p&gt;

&lt;h2 id=&quot;c&quot;&gt;C&lt;/h2&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;writeToFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; 
    &lt;span class=&quot;cm&quot;&gt;/* write out to the file */&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Moving into C, we start to see a bit more information popping out.  We know that it takes in a &lt;code class=&quot;highlighter-rouge&quot;&gt;char*&lt;/code&gt; for the name.  Since this also isn’t &lt;code class=&quot;highlighter-rouge&quot;&gt;const&lt;/code&gt;, we know that it’s allowed to change the contents of the string we pass in.  We also know it returns an &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt;, likely for error codes.&lt;/p&gt;

&lt;p&gt;We are starting to see into what the function can do, but there’s still quite a bit we don’t know:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Can this function change our system?&lt;/li&gt;
  &lt;li&gt;Can the &lt;code class=&quot;highlighter-rouge&quot;&gt;name&lt;/code&gt; value be deleted?&lt;/li&gt;
  &lt;li&gt;Can the function raise a signal (a C-flavored way of exceptions/events)?&lt;/li&gt;
  &lt;li&gt;And what about those error codes?
    &lt;ul&gt;
      &lt;li&gt;How do we know the &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt; is for error codes, and not returning the length of data written?&lt;/li&gt;
      &lt;li&gt;If it is for error codes, how do we know which ones it supports?&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We’ve improved some, but we still lean heavily on conventions, code comments, and testing to ensure that this function behaves correctly.  As an aside: one interesting point of C is that it doesn’t have exceptions, like many languages, so you’re almost encouraged to have a more value-based programming style, though it lacks many common features that help fill out the value-based story (pattern matching, algebraic data types, etc).&lt;/p&gt;

&lt;h2 id=&quot;rust&quot;&gt;Rust&lt;/h2&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;writeToFile&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;// write out to the file&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Above is a simple Rust version.  If you’ve never seen Rust before, let’s quickly break down it says:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;fn&lt;/code&gt; keyword creates our function&lt;/li&gt;
  &lt;li&gt;Next, we give the function a name: writeToFile&lt;/li&gt;
  &lt;li&gt;Our function gets one argument called ‘name’ which has the type &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;str&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;str&lt;/code&gt; is a type in two parts:
        &lt;ul&gt;
          &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;str&lt;/code&gt; is the simple string type&lt;/li&gt;
          &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;&lt;/code&gt; meaning that this value is being borrowed and is owned by someone else (aka you’re not allowed to delete it)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Finally, we return something of type &lt;code class=&quot;highlighter-rouge&quot;&gt;Result&amp;lt;()&amp;gt;&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Result&amp;lt;()&amp;gt;&lt;/code&gt; is the Rust way of saying I can return either:
        &lt;ul&gt;
          &lt;li&gt;a) successfully, without a value (the () above)&lt;/li&gt;
          &lt;li&gt;b) an error&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The Rust example tells a bit more of the story than the C version.  In Rust, everything is immutable by default, so we know from looking at the signature that what we pass in can’t be changed.  It also won’t be deleted, because what is passed is ‘borrowed’ rather than us giving ownership over to this function.  Rust is similar to C in that we don’t have exceptions and instead use return values to denote success or failure (read more in Rust Error Handling).  Rust encodes the success or failure in the return value, requiring the caller to code defensively around possible errors.  This has the effect of encouraging code to be more robust by handling both success and failure where they can occur.&lt;/p&gt;

&lt;p&gt;An improvement over where we were in C, but we still have a lingering question: does this function have any permanent effect on the system?  To be able to answer that question, we go one example deeper down the rabbit hole.&lt;/p&gt;

&lt;h2 id=&quot;haskell&quot;&gt;Haskell&lt;/h2&gt;

&lt;div class=&quot;language-haskell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;writeToFile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;IO&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;writeToFile&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;do&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since this might be unfamiliar let’s take a second to breakdown what we’re seeing:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;We start by declaring the type (which isn’t terribly dissimilar from a forward declaration in C)&lt;/li&gt;
  &lt;li&gt;The type has two parts:
    &lt;ul&gt;
      &lt;li&gt;We take one argument that has a type &lt;code class=&quot;highlighter-rouge&quot;&gt;String&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;We return an &lt;code class=&quot;highlighter-rouge&quot;&gt;IO ()&lt;/code&gt; [see below]&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;After the type, we write out the actual implementation of the function&lt;/li&gt;
  &lt;li&gt;Just as in Rust, Haskell is immutable by default.  When we say we pass in a String, we’re also implying that this string can’t be changed or deleted.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Also similar to Rust, in Haskell there are no exceptions, so you must handle all possible values when you call the function.  By saying &lt;code class=&quot;highlighter-rouge&quot;&gt;IO ()&lt;/code&gt;, this might at first seem similar to the &lt;code class=&quot;highlighter-rouge&quot;&gt;Result&amp;lt;()&amp;gt;&lt;/code&gt;.  In some sense, it is, in that IO carries along any possible errors.&lt;/p&gt;

&lt;p&gt;It also goes a bit further.  In essence, it says: “I’m going to go change the world, and when I come back you need to carry that truth on.”  In Haskell, if you call a function that performs I/O like our writeToFile function, you must also carry on that fact in your own return type.  You have to be fully transparent all the way through the call stack of who is changing the world, even indirectly.  This lets you clearly document who is modifying the world and who isn’t.&lt;/p&gt;

&lt;h1 id=&quot;dark-side-of-transparency&quot;&gt;Dark side of transparency&lt;/h1&gt;

&lt;p&gt;But, it can’t be all roses, right?  Let’s look at what I see as the dark side of transparency: encapsulation (or its lack thereof).&lt;/p&gt;

&lt;p&gt;As good software engineers, we know an important piece of building a system is having good encapsulation.  Any module or object worth its weight exposes only necessary functionality to the world and hides the rest.  This encourages loose coupling, so that components don’t depend on each others’ implementation details.&lt;/p&gt;

&lt;p&gt;In a way, transparency in the type runs counter to information hiding in that it encourages more coupling in the code.  Some of this is natural.  For example, in the C code, we have to remember what the return values are.  If we add a new one, we may have to change the code handling the call as well.  Likewise, in Python, if we change the types of parameters we allow, we may have to go update the callers.&lt;/p&gt;

&lt;p&gt;On the other hand, knowing that a function may fail may be sufficient.  In the Rust case, code that handles the call may need to be updated if you change how the function fails, even if it only cares about if it fails.&lt;/p&gt;

&lt;p&gt;Likewise, in Haskell you may want to drop some probe into your system to catch the result of a function while you’re debugging.  Such changes can have a ripple effect in your codebase as this probe may change a series of function calls to reflect that I/O has been performed.  (Not withstanding workarounds with fun names like &lt;code class=&quot;highlighter-rouge&quot;&gt;unsafePerformIO&lt;/code&gt;)&lt;/p&gt;

&lt;h1 id=&quot;all-a-balance&quot;&gt;All a balance&lt;/h1&gt;

&lt;p&gt;Types are there to help.  Leaning on them not enough means encoding more information in your tests and code comments.  Leaning on them too much may mean tightly coupling parts of your system.  What the right balance is may change from project to project, or developer to developer.&lt;/p&gt;

&lt;p&gt;Just as in our relationships with other people, it makes sense to not tell everyone we meet everything about us.  It’s a balance.  Finding the right amount of transparency that encourages flexible, resilient systems is an art.&lt;/p&gt;

&lt;p&gt;In the last few weeks, in playing with Rust more I’ve grown to appreciate its pragmatic set of trade-offs.  Yes, you don’t get to know if the system was changed, but if something can impact the rest of the program, you’re encouraged to handle it.  Not that there aren’t workarounds or ways to easily opt-out, but just as in life, it’s all a balance.&lt;/p&gt;
</description>
				<pubDate>Wed, 28 Oct 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/10/telling-truth-in-code-function.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/10/telling-truth-in-code-function.html</guid>
			</item>
		
			<item>
				<title>Lessons from the first 12 Euler problems in Rust</title>
        <description>&lt;p&gt;&lt;strong&gt;!! Spoiler Alert !!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;I’m going to be talking about solutions to select problems from the first 12 Euler problems.  If you haven’t solved these for yourself yet, I highly recommend taking the time to solve them on your own first.&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&quot;background&quot;&gt;Background&lt;/h1&gt;

&lt;p&gt;Before I went to Microsoft for a &lt;a href=&quot;http://www.typescriptlang.org/&quot;&gt;stint in JavaScript&lt;/a&gt;, I did my fair share of systems programming in C++.  I’ve built compilers, head-tracking software, signal processing software, and emulators and even did some of my first programming language projects in it and &lt;a href=&quot;http://chaiscript.com/&quot;&gt;for it&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So when word got out four years ago about a new systems language called &lt;a href=&quot;https://www.rust-lang.org/&quot;&gt;Rust&lt;/a&gt;, I was intrigued.  I mean, it was &lt;em&gt;new&lt;/em&gt; and it was called &lt;em&gt;rust&lt;/em&gt;.  Obviously there was some cheekiness involved :)&lt;/p&gt;

&lt;p&gt;While I’ve dabbled with it before, this week was the first time I really gave it some dedicated time to learn it.  &lt;strong&gt;TL;DR:&lt;/strong&gt; hey, this is kinda neat!&lt;/p&gt;

&lt;p&gt;In this post I talk through solving some of the Euler problems in Rust, both de-rusting my programming skills and learning what this Rust thing was all about.&lt;/p&gt;

&lt;p&gt;If you’re interested, you can grab the &lt;a href=&quot;https://github.com/jonathandturner/rustnewbie&quot;&gt;source code to my solutions&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;problem-1&quot;&gt;Problem 1&lt;/h1&gt;

&lt;p&gt;“sum of all multiples of 3 or 5 below 1000”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
 
    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My solution to problem 1 is pretty straightforward, but you can already start to see some of the characteristic earmarks of Rust.  On &lt;strong&gt;line 2&lt;/strong&gt;, there’s a let keyword which creates a variable.  After that is the mut keyword for saying that the variable we’re creating is mutable, as variables are immutable by default.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 4&lt;/strong&gt; shows off using an iterator.  Rust’s iterators are lazy, meaning they generate values only as needed.  This gives them some cool properties, which we’ll see later, but it has the property of being relatively cheap to iterate over them, since we don’t generate a full range before iteration starts.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 5&lt;/strong&gt; reminds us that we’re not in C.  The if doesn’t require parens around its condition.  Indeed, if you put them there, the compiler warns you that you don’t need them.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 13&lt;/strong&gt; shows how to print out a value.  Note the ‘!’ after println.  If you’re like me, you’re bound to leave this off once or twice and get an incomprehensible error message.  Similar to C and many other languages, you pass println! a format string.  Here, we just use “{}”.  The {} part means to use a default output of the argument we pass in, which in our case just writes out the number.&lt;/p&gt;

&lt;h1 id=&quot;problem-2&quot;&gt;Problem 2&lt;/h1&gt;

&lt;p&gt;“sum of even fibonacci below 4,000,000”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Fibonacci&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// Implement 'Iterator' for 'Fibonacci'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Iterator&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Fibonacci&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Item&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// The 'Iterator' trait only requires the 'next' method to be defined. The&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// return type is 'Option&amp;lt;T&amp;gt;', 'None' is returned when the 'Iterator' is&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;// over, otherwise the next value is returned wrapped in 'Some'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.curr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.curr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;c&quot;&gt;// 'Some' is always returned, this is an infinite value generator&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.curr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;// Returns a fibonacci sequence generator&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fibonacci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Fibonacci&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Fibonacci&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fibonacci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.take_while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(|&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sum: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lest you think that I somehow jumped from beginner level to advanced in a few minutes, rest assured that I used the tried and true method of the &lt;a href=&quot;http://rustbyexample.com/trait/iter.html&quot;&gt;copy/paste&lt;/a&gt;.  In trying to find out how to make an iterator so I could iterate over a fibonacci sequence, I found the source to do just that.  Ah, the internet.&lt;/p&gt;

&lt;p&gt;There’s a fair bit going on here, so let’s break it down by line.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Lines 1-4:&lt;/strong&gt; Create a simple struct to hold the current value to be returned as well as the next value.  Fibonacci needs at least these two values to continue to calculate each iteration.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 7:&lt;/strong&gt; Now Rust is showing off the fancy.  What is going on here?  In Rust, a type, like our Fibonacci struct from lines 1-4, can implement a trait.  What’s a trait?  Think of it as a small contract with the compiler.  If you can show how your type satisfies all the requirements of the contract, then wherever that trait is required, the compiler knows how to use your type.  In this example, we want to use our type in the &lt;code class=&quot;highlighter-rouge&quot;&gt;for..in&lt;/code&gt; language feature.  In some languages, this wouldn’t be possible.  In Rust, if we can satisfy the Iterator trait, the compiler has enough information to allow that type to be used in the &lt;code class=&quot;highlighter-rouge&quot;&gt;for..in&lt;/code&gt; feature.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 8:&lt;/strong&gt; Ah the problem with copy/paste.  As I started writing this blog post, I had no idea what that line was doing.  Docs to the rescue.  It turns out that this line is saying what the ‘associated type’ is.  With some traits, there’s going to be both a) the type that is implementing the trait (here: our Fibonacci struct) and b) an additional type that needs to be known to get the rest of the story.  For us, since we’re creating an iterator over the fibonacci sequence, we need to let Rust know what the type of each “turn of the crank” on the iterator will output.  Each fibonacci number will be a 64-bit unsigned integer, so we use the Rust short-hand type &lt;code class=&quot;highlighter-rouge&quot;&gt;u64&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Lines 12-20:&lt;/strong&gt; Here’s where we describe how to turn the crank for each step of our iterator.  We calculate what the next turn will output and then return the current value.  This allows us to keep one in reserve ready to be used to calculate the next value, and so on.  You can see on line 19 that instead of just returning a &lt;code class=&quot;highlighter-rouge&quot;&gt;u64&lt;/code&gt; directly, we instead say that it’s optionally a &lt;code class=&quot;highlighter-rouge&quot;&gt;u64&lt;/code&gt;.  While in our case we iterate forever, using &lt;code class=&quot;highlighter-rouge&quot;&gt;Option&lt;/code&gt; here gives us a way to shut off the valve and finish the iterator if we ever wanted to.&lt;/p&gt;

&lt;p&gt;Notice, too, on &lt;strong&gt;line 19&lt;/strong&gt; the value is said last and the return statement is elided.  This is just shorthand for returning a value from the function.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Lines 24-26:&lt;/strong&gt; Create a simple function to give us our starting value to begin our fibonacci sequence.  You can see a couple Rust-isms here, too.  As before, a value by itself is an implied return value.  It also shows how to create an instance of the struct without a constructor.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 30:&lt;/strong&gt; We’re finally in the main!  I’ve forgotten what problem we were solving by now.  Ah right, “find the sum of even fibonacci numbers less than 4,000,000”.  Let’s look at the solution.  Since there’s a lot going on in this fluent-style approach, let’s break it up into steps:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;fibonacci()&lt;/code&gt; - we call our function and get out the default value to start iterating with.  Since we already told Rust how to use values of this type as iterators, it gets all the capabilities that iterators have.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;.take_while(|&amp;amp;x| x &amp;lt; 4000000)&lt;/code&gt; - that didn’t take long, we’re already jumping in and using the functionality of the iterator to check each turn of the crank, and if we exceed 4,000,000 stop.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;|&amp;amp;x| x &amp;lt; 4000000&lt;/code&gt; is a simple function that takes in a reference to each element we bind to x, and then we check the value we’re handed in the body of our function.  If you’re coming from C++, this reference style might look a little strange.  Aren’t you risking someone updating the value?  Turns out Rust’s references are &lt;a href=&quot;http://doc.rust-lang.org/book/references-and-borrowing.html#borrowing&quot;&gt;immutable by default&lt;/a&gt;.  The reference here also shows us the performance characteristics of &lt;code class=&quot;highlighter-rouge&quot;&gt;.take_while&lt;/code&gt;.  By this I mean, when we look at the &lt;code class=&quot;highlighter-rouge&quot;&gt;.take_while&lt;/code&gt; call, we see it will only pass references, so know ahead of time if we’re iterating over big structures, we’re not paying the price of copying each one with each step of the iterator.&lt;/p&gt;

&lt;p&gt;Speaking of performance, it may look like .take_while is going to be exceedingly expensive.  Is it consuming all of our fibonacci sequence until we have all the items we need to get to 4,000,000?  Luckily, it isn’t.  Instead, &lt;code class=&quot;highlighter-rouge&quot;&gt;.take_while&lt;/code&gt; itself returns an iterator that you can continue your fluent calls on.  I think of it like a series of machines in a factory:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-&amp;gt; [  ] -&amp;gt; [  ] -&amp;gt; [  ] -&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I start the conveyor up and I pull from the right hand, I’m moving whatever was on the far left all the way through the system.  In our case, we’re starting up the fibonacci iterator and getting that machine running.  It spits out a single fibonacci-shaped number for us.  This number chugs along and enters the next machine, which is our machine that checks if it’s too big.  If it’s not, the conveyor chugs along and out drops a single fibonacci-shaped number of the acceptable size.&lt;/p&gt;

&lt;p&gt;As these machines work in lock-step, we’re getting just what we need when we need it rather than trying to run ahead and doing a bunch of work in advance.  This allows you compose a lot of steps together and still stay efficient.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;.filter(|&amp;amp;x| x % 2 == 0)&lt;/code&gt; -  Just like &lt;code class=&quot;highlighter-rouge&quot;&gt;.take_while&lt;/code&gt; above, this one checks each number as it passes through.  This time, it only lets the number through if it’s divisible by 2, and hence even.&lt;/p&gt;

&lt;p&gt;Now we have all the steps in place, each time we turn the crank of the whole iterator, only fibonacci numbers that are less than 4,000,000 and even will pop out.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 31:&lt;/strong&gt; We’ve already done all the hard work.  Now we just have to sum those numbers together.&lt;/p&gt;

&lt;p&gt;With that, we’re done.  While it was quite a mouthful, we can see the compositional nature of Rust, a bit of the type system, and how iterators work in more detail.&lt;/p&gt;

&lt;h1 id=&quot;problem-3&quot;&gt;Problem 3&lt;/h1&gt;

&lt;p&gt;“highest prime factor of 600851475143”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;is_prime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;    

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Prime&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Iterator&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Prime&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Item&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.curr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;is_prime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;new_next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.curr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;nf&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;.curr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;// Returns the primes&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;primes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Prime&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Prime&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;600851475143&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;highest_prime_factor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;primes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;highest_prime_factor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;num: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;highest_prime_factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Very similar to Problem #2 above, I create an implementation of Iterator, so I can use it later.  This time, rather than creating a stream of fibonacci values, I create a stream of prime numbers.&lt;/p&gt;

&lt;p&gt;Just like we had a struct for Fibonacci in Problem #2, I create one here for Prime numbers.  Since we don’t need the previous one to calculate the next one, I only keep the current value around and then start with that number + 1 when trying to find the next prime.&lt;/p&gt;

&lt;p&gt;Once we have our iterator, we take each prime, and then try to divide out all its multiples from our give number.  What’s left should be our highest prime factor.  Easy peasy.&lt;/p&gt;

&lt;p&gt;PS: I know it’s probably already too late, but I should have warned you to avert your eyes from my inefficient prime number skills :)&lt;/p&gt;

&lt;h1 id=&quot;problem-4&quot;&gt;Problem 4&lt;/h1&gt;

&lt;p&gt;“largest palindrome product of two 3-digit numbers”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;is_palindrome&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.zip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.rev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;999&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;999&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;is_palindrome&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Largest: {}, {} x {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Problem #4 also uses some iterators to find the palindrome product (&lt;strong&gt;line 13&lt;/strong&gt; and &lt;strong&gt;line 14&lt;/strong&gt;).  If it finds a palindrome product, and that new product is larger than what it saw before, it replaces it with the new one.&lt;/p&gt;

&lt;p&gt;There’s one fun trick in this solution on &lt;strong&gt;line 3&lt;/strong&gt;.  We need to check if the number is a palindrome.  While you can do this &lt;a href=&quot;http://stackoverflow.com/questions/199184/how-do-i-check-if-a-number-is-a-palindrome&quot;&gt;numerically&lt;/a&gt;, I couldn’t help but use some more iterators.  This time, after converting the number to a string, we create an iterator over the characters in the string (using &lt;code class=&quot;highlighter-rouge&quot;&gt;.chars()&lt;/code&gt;).  We want to see if the number is a palindrome, so one way to test this is that if we reverse the string and if still get the same value, we know we’ve got one.&lt;/p&gt;

&lt;p&gt;That’s exactly what we do.  Here, I use &lt;code class=&quot;highlighter-rouge&quot;&gt;.zip(s.chars().rev())&lt;/code&gt; to combine the iterator that goes forward over the characters with one that goes in reverse.  The &lt;code class=&quot;highlighter-rouge&quot;&gt;.zip()&lt;/code&gt; call brings both iterators together and iterates over both iterators for us, returning a pair (or tuple) of values.  Think of it running both machines side by side, and with each turn of the crank one value pops out of each and zip returns both values tied together with a bow.&lt;/p&gt;

&lt;p&gt;Now that we have a single pair, we immediately use it.  At the beginning of line 3, you can see the for &lt;code class=&quot;highlighter-rouge&quot;&gt;(i1, i2)&lt;/code&gt; in part of the line.  Just as before &lt;code class=&quot;highlighter-rouge&quot;&gt;for..in&lt;/code&gt; will run over the iterator.  We know that the iterator is going to be outputting pairs of values.  We could have just grabbed the pair as a single value and used it later, but here I go one step further by taking the pair the iterator gives me and pulling it apart so I can use it.  This pulling apart, called destructuring, is a handy way of working with structured data when you’re interested in its constituent parts rather than the structure itself.  In this case, this lets me more easily compare the left side to the right side, so I destructure the pair into two values: &lt;code class=&quot;highlighter-rouge&quot;&gt;i1&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;i2&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;problems-5-through-7&quot;&gt;Problems 5 through 7&lt;/h1&gt;

&lt;p&gt;Problems &lt;a href=&quot;https://github.com/jonathandturner/rustnewbie/blob/master/euler/src/ex5.rs&quot;&gt;#5&lt;/a&gt;, &lt;a href=&quot;https://github.com/jonathandturner/rustnewbie/blob/master/euler/src/ex6.rs&quot;&gt;#6&lt;/a&gt;, and &lt;a href=&quot;https://github.com/jonathandturner/rustnewbie/blob/master/euler/src/ex7.rs&quot;&gt;#7&lt;/a&gt; are all straightforward and don’t show off anything new in the language.  Let’s jump ahead to the next interesting one.&lt;/p&gt;

&lt;h1 id=&quot;problem-8&quot;&gt;Problem 8&lt;/h1&gt;

&lt;p&gt;“largest product of 13 adjacent digits”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 
        &lt;span class=&quot;s&quot;&gt;&quot;73167176531330624919225119674426574742355349194934&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        96983520312774506326239578318016984801869478851843&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        85861560789112949495459501737958331952853208805511&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        12540698747158523863050715693290963295227443043557&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        66896648950445244523161731856403098711121722383113&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        62229893423380308135336276614282806444486645238749&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        30358907296290491560440772390713810515859307960866&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        70172427121883998797908792274921901699720888093776&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        65727333001053367881220235421809751254540594752243&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        52584907711670556013604839586446706324415722155397&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        53697817977846174064955149290862569321978468622482&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        83972241375657056057490261407972968652414535100474&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        82166370484403199890008895243450658541227588666881&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        16427171479924442928230863465674813919123162824586&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        17866458359124566529476545682848912883142607690042&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        24219022671055626321111109370544217506941658960408&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        07198403850962455444362981230987879927244284909188&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        84580156166097919133875499200524063689912560717606&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        05886116467109405077541002256983155200055935729725&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
        71636269561882670428252483600823257530420752963450&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input_bytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.as_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;span_width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input_bytes&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;span_width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;span_width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;largest_string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;span_width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Largest: {} is {:?}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;largest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;from_utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;largest_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In Problem #8, we see an example of working with strings, this time using a new feature called a ‘slice’.  We start with the block from &lt;strong&gt;line 3&lt;/strong&gt; to &lt;strong&gt;line 22&lt;/strong&gt; that gives us this giant input string.  Notice that I use the backslash ‘' to continue the line to the next line.  Rust is smart enough to let us indent without introducing new whitespace into the string.&lt;/p&gt;

&lt;p&gt;Now that we have our string, on &lt;strong&gt;line 25&lt;/strong&gt; we turn it into a array of bytes we can search through.  Notice we didn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;.chars()&lt;/code&gt; this time.  Recall that &lt;code class=&quot;highlighter-rouge&quot;&gt;.chars()&lt;/code&gt; gave us an iterator.  Rather than iterating over one value at a time here, we want the flexibility to look across spans in our string.  To do that, we use &lt;code class=&quot;highlighter-rouge&quot;&gt;.as_bytes()&lt;/code&gt; to get an array (technically, a byte slice).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Line 26&lt;/strong&gt; introduces the slice we’ll use.  A slice is a window into values in memory.  Since we want to look at a span of values, we create a holder for this slice.  We’ll later set it to spans of our 13 adjacent digits.  PS: you’ll notice I set it to a dummy default value, which I later throw away.  This is to get around the compiler warning about uninitialized values.&lt;/p&gt;

&lt;p&gt;The rest of the search follows fairly naturally.  We do an iterator over the indices in our input, stopping short of the length of the span.  We use that index to calculate the product at that span (&lt;strong&gt;line 32&lt;/strong&gt; to &lt;strong&gt;line 34&lt;/strong&gt;).  Once we find a match, we save it off, using a slice to save off the winning span (&lt;strong&gt;line 37&lt;/strong&gt;).&lt;/p&gt;

&lt;p&gt;Finally, we use another format string &lt;code class=&quot;highlighter-rouge&quot;&gt;{:?}&lt;/code&gt;, which can print out our winning span for us using the debug formatter.  The &lt;code class=&quot;highlighter-rouge&quot;&gt;{:?}&lt;/code&gt; format is a handy builtin which can handle a wider range of types with a default formatter.&lt;/p&gt;

&lt;h1 id=&quot;problem-9&quot;&gt;Problem 9&lt;/h1&gt;

&lt;p&gt;Problem &lt;a href=&quot;https://github.com/jonathandturner/rustnewbie/blob/master/euler/src/ex9.rs&quot;&gt;#9&lt;/a&gt; is another solution that’s simple and doesn’t show off any new features.  Moving on.&lt;/p&gt;

&lt;h1 id=&quot;problem-10&quot;&gt;Problem 10&lt;/h1&gt;

&lt;p&gt;“sum of all primes below 2 million”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;usize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;slots&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;slots&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;slots&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c&quot;&gt;// We calculate the primes using a simple stride and marking off multiples &lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stride&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SIZE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stride&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SIZE&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stride&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stride&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;slots&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;slots&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.into_iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.enumerate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sum: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reading the problem description, you might have guessed that I would use the iterator solution from earlier.  The astute reader probably already noticed that doing so would be. very. slow.  Especially, as we look at primes above a million, where each step is itself taking hundreds of thousands, if not millions, of calculations.  While I could let it run and heat up my apartment, it’s better to do a more direct approach.&lt;/p&gt;

&lt;p&gt;We trade space for time.&lt;/p&gt;

&lt;p&gt;On &lt;strong&gt;line 4&lt;/strong&gt;, I create my first fixed size array that will hold whether or not the number in that position is prime.  Once we have the variable, it’s initialized using another cool shorthand: &lt;code class=&quot;highlighter-rouge&quot;&gt;[true; SIZE]&lt;/code&gt;.  This creates an array of boolean true values of the size given on the right of the ‘;’, here the SIZE constant I defined.  For example, you can create a 500-element array of zeros using &lt;code class=&quot;highlighter-rouge&quot;&gt;[0; 500]&lt;/code&gt;.  Neat.&lt;/p&gt;

&lt;p&gt;Once we have our slots, we loop over them using any possible multiple and check that off the list by setting that position to false.  Once we’re done, we have an array that tells us where the primes are.&lt;/p&gt;

&lt;p&gt;The only trick remaining is how to get the numbers back out again.  To do this, we use the iterator on &lt;strong&gt;line 17&lt;/strong&gt;.  Similar to our fluent iterators before, this time we turn our array of slots into an iterator, and then call &lt;code class=&quot;highlighter-rouge&quot;&gt;.enumerate()&lt;/code&gt;.  The &lt;code class=&quot;highlighter-rouge&quot;&gt;.enumerate()&lt;/code&gt; call is a special kind of zip that gives us the index at that point in the iteration paired with the actual value.  Just as before, we destructure the index and the boolean that indicates if it’s a prime number separately.&lt;/p&gt;

&lt;p&gt;On &lt;strong&gt;line 18&lt;/strong&gt;, we check if the number is prime, and if so we add it to our sum.  You’ll notice the &lt;code class=&quot;highlighter-rouge&quot;&gt;*pr&lt;/code&gt; call here.  Just as in C, this lets me dereference and get at the value at that location in memory.  I could have instead written for &lt;code class=&quot;highlighter-rouge&quot;&gt;(idx, &amp;amp;pr)&lt;/code&gt; in and just gotten to the value that way, using destructuring instead of dereferencing.  With that change, the line would have been &lt;code class=&quot;highlighter-rouge&quot;&gt;if pr { ... }&lt;/code&gt;, and I could get at the value &lt;code class=&quot;highlighter-rouge&quot;&gt;pr&lt;/code&gt; without needing to dereference.&lt;/p&gt;

&lt;h1 id=&quot;problem-11&quot;&gt;Problem 11&lt;/h1&gt;

&lt;p&gt;“find the largest product in a grid”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    08 02 22 97 38 15 00 40 00 75 04 05 07 78 52 12 50 77 91 08 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    49 49 99 40 17 81 18 57 60 87 17 40 98 43 69 48 04 56 62 00 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    81 49 31 73 55 79 14 29 93 71 40 67 53 88 30 03 49 13 36 65 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    52 70 95 23 04 60 11 42 69 24 68 56 01 32 56 71 37 02 36 91 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    22 31 16 71 51 67 63 89 41 92 36 54 22 40 40 28 66 33 13 80 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    24 47 32 60 99 03 45 02 44 75 33 53 78 36 84 20 35 17 12 50 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    32 98 81 28 64 23 67 10 26 38 40 67 59 54 70 66 18 38 64 70 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    67 26 20 68 02 62 12 20 95 63 94 39 63 08 40 91 66 49 94 21 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    24 55 58 05 66 73 99 26 97 17 78 78 96 83 14 88 34 89 63 72 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    21 36 23 09 75 00 76 44 20 45 35 14 00 61 33 97 34 31 33 95 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    78 17 53 28 22 75 31 67 15 94 03 80 04 62 16 14 09 53 56 92 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    16 39 05 42 96 35 31 47 55 58 88 24 00 17 54 24 36 29 85 57 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    86 56 00 48 35 71 89 07 05 44 44 37 44 60 21 58 51 54 17 58 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    19 80 81 68 05 94 47 69 28 73 92 13 86 52 17 77 04 89 55 40 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    04 52 08 83 97 35 99 16 07 97 57 32 16 26 26 79 33 27 98 66 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    88 36 68 87 57 62 20 72 03 46 33 67 46 55 12 32 63 93 53 69 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    04 42 16 73 38 25 39 11 24 94 72 18 08 46 29 32 40 62 76 36 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    20 69 36 41 72 30 23 88 34 62 99 69 82 67 59 85 74 04 36 16 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    20 73 35 29 78 31 90 01 74 31 49 71 48 86 81 16 23 57 05 54 &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;
    01 70 54 71 83 51 54 69 16 92 33 48 61 43 52 01 89 19 67 48&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input_split&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.split_whitespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input_as_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input_split&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 
    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;from_str_radix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Garbage in input: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.collect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I’m only showing the interesting part of the solution since it’s a bit long, but you can read the &lt;a href=&quot;https://github.com/jonathandturner/rustnewbie/blob/master/euler/src/ex11.rs&quot;&gt;whole solution&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here we do a bit more string manipulation using some new methods.  The &lt;code class=&quot;highlighter-rouge&quot;&gt;.split_whitespace()&lt;/code&gt; method on &lt;strong&gt;line 23&lt;/strong&gt; lets us turn our input string into an iterator of strings, splitting at any whitespace.&lt;/p&gt;

&lt;p&gt;Once we have this iterator, &lt;strong&gt;line 24&lt;/strong&gt; takes this iterator and maps a function over it.  This function attempts to convert each substring to a signed 32-bit integer &lt;code class=&quot;highlighter-rouge&quot;&gt;i32&lt;/code&gt; using the &lt;code class=&quot;highlighter-rouge&quot;&gt;.from_str_radix(x, 10)&lt;/code&gt; call.  This call returns a &lt;code class=&quot;highlighter-rouge&quot;&gt;Result&lt;/code&gt;, a way of handling either a success or failure condition of an action that might fail.  As is the case with converting from strings to numbers, if you happen to pass in something that can’t be converted to a number, there needs to be a way to signal back out that the conversion failed.  Some languages do this through exceptions, which break out of normal execution and give you an error you can handle.  Rust uses a simpler, more functional approach and treats errors as just any other value.  With this method, the type system encourages us to be vigilant and always have code available to handle errors.&lt;/p&gt;

&lt;p&gt;To see which of success/failure is returned, we use the match keyword.  Just as in other languages with pattern matching, the match keyword lets us ask which of the possible values is in the Result: &lt;code class=&quot;highlighter-rouge&quot;&gt;Ok&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;Err&lt;/code&gt;.  Pattern matching lets us destructure and find the success value or error message.&lt;/p&gt;

&lt;p&gt;Finally, on &lt;strong&gt;line 29&lt;/strong&gt;, we use the &lt;code class=&quot;highlighter-rouge&quot;&gt;.collect()&lt;/code&gt; method to run through the iterator and create a vector of &lt;code class=&quot;highlighter-rouge&quot;&gt;i32&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;problem-12&quot;&gt;Problem 12&lt;/h1&gt;

&lt;p&gt;“triangle number with over 500 divisors”&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;// Cache the primes we'll be using&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;first_primes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;primes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.take&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.collect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000000u64&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_div&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_primes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num_tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;exponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;num_tmp&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;num_div&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num_div&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;num: {}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Again we’ll trim down to the interesting parts, since we’ve seen the prime iterator before, but you can read the &lt;a href=&quot;https://github.com/jonathandturner/rustnewbie/blob/master/euler/src/ex12.rs&quot;&gt;full file&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This looks pretty familiar.  On &lt;strong&gt;line 5&lt;/strong&gt;, we run our primes iterator, take enough to use later, and turn that into a &lt;code class=&quot;highlighter-rouge&quot;&gt;Vec&amp;lt;u64&amp;gt;&lt;/code&gt; we can use a bunch of times.&lt;/p&gt;

&lt;p&gt;The other interesting line is &lt;strong&gt;line 13&lt;/strong&gt;.  If you’ve played with vectors in Rust before, you know that you can iterate over them, like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span class=&quot;k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.collect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;But if we try to do this in our Euler problem, we get a new error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;error: use of moved value: `first_primes`
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What is a &lt;em&gt;moved value&lt;/em&gt;?&lt;/p&gt;

&lt;p&gt;It turns out that a moved value is part of Rust’s ownership system.  Just like the first time a programmer sees a pointer in C or a monad in Haskell, ownership in Rust is one of those things that’s so uniquely Rust that it takes getting used to.  Once you begin to understand it, you’ll be able to see how the type system is trying to help you describe your intentions a bit more clearly.&lt;/p&gt;

&lt;p&gt;If you’re scratching your head, here’s an example: imagine malloc’ing an array in C and then passing that malloc’ed array into a function.  Who is responsible for cleaning up that memory, the function you called or the function that created the array?  In C, you don’t know by looking at the code, you only know as the writer of the code what your intention was.  Maybe the function is called ‘cleanup’ at which case, yes, you do want it to free that memory.  Or maybe the function is called ‘inspect’ and you decidedly &lt;em&gt;don’t&lt;/em&gt; want it to free the memory.  This is why Rust makes this very explicit.  By looking at the code, you can follow who is responsible for what.  The set of checks that do this make up Rust’s ownership system.&lt;/p&gt;

&lt;p&gt;There are a lot of &lt;a href=&quot;https://doc.rust-lang.org/book/references-and-borrowing.html&quot;&gt;resources&lt;/a&gt; to understand ownership,which do a good job of explaining ownership in detail.  For us, ownership is like trying to answer questions like “who is responsible for this thing?” and “when does this thing get removed?”  Ownership can be passed from variable to variable, and its strictly checked by the compiler.&lt;/p&gt;

&lt;p&gt;When you first encounter the above error, if you haven’t already read about ownership, you might be in for a few hours of reading to get caught up.  But we have some hints here that we can get started with to help figure out what’s happening.&lt;/p&gt;

&lt;p&gt;In our small example, we could iterate over a vector and all was well.  When did things start to go wrong in the Euler problem?&lt;/p&gt;

&lt;p&gt;On &lt;strong&gt;line 13&lt;/strong&gt;, we want to loop over a vector, and when we look out to &lt;strong&gt;line 7&lt;/strong&gt;, we see this is actually an inner loop being used by an outer loop.  That means that if the inner loop takes control of our vector, the next time around the outer loop we’ve lost the ownership.&lt;/p&gt;

&lt;p&gt;We don’t want the inner loop to take ownership and then lose the ability to use the vector again in the next iteration of the loop, so we have to ‘borrow’ ownership.  As the name implies, by borrowing, we’re only taking temporary ownership for a time, and we have to follow all the rules stated when we borrow.  With that in mind, let’s look at &lt;strong&gt;line 13&lt;/strong&gt; again:&lt;/p&gt;

&lt;div class=&quot;language-rust highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_primes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We borrow &lt;code class=&quot;highlighter-rouge&quot;&gt;first_primes&lt;/code&gt; instead of taking permanent ownership using the &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;&lt;/code&gt; operator.  This operator says “I would like to borrow first_primes, and I can not edit the contents”.  The compiler will then be able to check that we’re using what we’ve borrowed correctly.  You might be curious borrowing and also being able to mutate.  To do that, we could’ve used the &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;mut&lt;/code&gt; operator assuming the original vector was mutable.&lt;/p&gt;

&lt;p&gt;Finally, we use the same destructure trick we did earlier to get at the values of &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;PS:&lt;/strong&gt; In this example, since all we were doing was iterating, we could have used the &lt;code class=&quot;highlighter-rouge&quot;&gt;.iter()&lt;/code&gt; rather than borrowing, though that won’t always be the case in other examples that need more direct interaction with the vector.&lt;/p&gt;

&lt;h1 id=&quot;cargo&quot;&gt;Cargo&lt;/h1&gt;

&lt;p&gt;After I got enough of these problems together that I got tired of building them by hand, I moved over to using Cargo.  Cargo is Rust’s build/package tool that is quite handy.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[package]

name = &quot;eulerinrust&quot;
version = &quot;0.1.0&quot;

[[bin]]
name = &quot;ex1&quot;
path = &quot;src/ex1.rs&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;An example of Cargo.toml&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Cargo lets you describe dependencies that your project needs, which it fetches from crates.io.  You can also control whether you’re doing a release or debug build, and quite a bit more.  I’ll no doubt start directly with Cargo for any future Rust projects.&lt;/p&gt;

&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;

&lt;p&gt;These are just tiny examples created while playing around in a fairly simple set of problems, and yet there’s actually quite a lot of Rust’s richness shining through.  Rust has a powerful iterator story that feels composable and clear.  Rust’s error checking is keeping us vigilant about handling error cases, matching types, and remembering who is responsible for values in the system.  Overall, it feels like a very well thought-out language that holds together well.&lt;/p&gt;
</description>
				<pubDate>Fri, 09 Oct 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/10/lessons-from-first-12-euler-problems-in.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/10/lessons-from-first-12-euler-problems-in.html</guid>
			</item>
		
			<item>
				<title>Off to new adventures</title>
        <description>&lt;p&gt;A few weeks ago I posted about moving teams inside of Microsoft.  As sometimes happens when you make a change, you realize that you actually need to make a bigger change.  A few weeks into the new team, and I could tell that it was time for me to move onto new adventures.&lt;/p&gt;

&lt;p&gt;Microsoft has been a great place for me to “grow up” as a program manager.  When I started as an intern, I was mentored by some of the most capable PMs I’ve ever met.  They took a keen interest in me, and I benefited greatly from their years of experience and patience.&lt;/p&gt;

&lt;p&gt;From a little bird of a PM, I grew to being able to lead the great TypeScript team.  I got to meet countless numbers of people and make some good friends along the way.  It was a wild adventure to be on the team, and I’m excited to see what they come up with next.&lt;/p&gt;

&lt;p&gt;But as little birds grow, there comes a time to leave the nest and to take more risks. There are many adventures to be had, and to have them, you have to ride out the storms in search of the blue skies.&lt;/p&gt;

&lt;p&gt;My first step will be to take some time to travel the world and see friends I haven’t seen in years.  My goal: recharge, explore, and take stock.  After that, who knows.&lt;/p&gt;

&lt;p&gt;Part of the adventure is not seeing the way ahead and going anyway.&lt;/p&gt;
</description>
				<pubDate>Mon, 05 Oct 2015 00:00:00 +1300</pubDate>
				<link>http://localhost:4000/2015/10/off-to-new-adventures.html</link>
				<guid isPermaLink="true">http://localhost:4000/2015/10/off-to-new-adventures.html</guid>
			</item>
		
	</channel>
</rss>
